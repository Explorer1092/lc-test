<p align="center">
    <img src="./dino@2x.png" height="130">
</p>
<p align="center">
    <a href="#">
        <img src="https://img.shields.io/badge/version-v1.1.9-green.svg" alt="version">
    </a>
</p>

# [egret-dino.js](https://code.vipkid.com.cn/vfe/learning-center/pet/blob/master/dist/egretDino.js)

## 这是基于egret.js封装的宠物sdk


## 目录介绍

```
.
├── libs 使用到的egret库
├── dist 编译产出代码
├── resource 项目开发使用到的资源
├── src 源代码目录
└── README.md 
```

## 使用者指南

### 安装
```
npm install http://npm.vipkid.com.cn/egret-dino/-/egret-dino-1.1.9.tgz //1.1.9为版本号
// 或
npm install --registry http://npm.vipkid.com.cn  --save-dev egret-dino
```
### 引入sdk
```
import DinoAnim from 'egret-dino'

// 由于sdk体积大 推荐异步按需引入方式 
let getDinoSdk = (cb) => {
  import('egret-dino').then(() => {
    !cb || cb()
  }
)}
// 在引入条件满足时候调用getDinoSdk   
getDinoSdk(() => {
  // 资源引入结束，此时可以实例化dinoAnim
})
```
### 使用

#### 场景会挂载到config中你传入的el容器内，你可以在config的positionConfig上设置舞台相对与el或el的父级的位置，层级
```
var dinoAnim = new DinoAnim(config)
```

##### config 配置内容说明

```
{
  height: number //舞台高
  width: number  //舞台宽
  el: Element //要挂载的元素
  resources: Array 或 String //预加载资源路径 数组形式是网络资源加载，字符串是本地资源加载
  resRootPath: string   //预加载资源根路径
  complete: Function    //dino初始化完成回调 函数参数是个初始化成功或失败的标识。成功true，失败false
  showLoading: boolean //是否显示加载动画 (可选)
  isAgreeClick: boolean //是否允许点击 默认不允许 禁止后没有点击和左右滑动的动作(可选)
  scale: number //缩放比例 大于0小于1，默认是0.3(可选)
  centrePoint: Array //中心点位置 [x,y] 默认是在舞台中心(可选)
  errorHandle: Function  //错误处理回调 参数为错误内容
  initAnimNames: Object //场景动作
  //初始化默认皮肤（可选)
  initSkinData: { 
  //部位名称：'HEAD_PARTS', 'FACE_PARTS', 'HAND_PARTS', 'BODY_PARTS', 'LEG_PARTS'
    HAND_PARTS: [
      // 资源详情
      { 
        name: string
        type: string
        url: string
      }
    ]
  } 
  dragonboneName: string  //骨骼动画名称（可选)
  turnRound: boolean //是否左右翻转（可选)
  // 容器在页面的样式 （可选）
  positionConfig?: { 
    'z-index': number
    left: string
    top: string
    right: string
    bottom: string
  } 
  tapHandle?: Function  //点击回调 isAgreeClick为 true，会在回调里边区分头部和身体，左滑右滑； isAgreeClick为 false 只会返回 click；  回调参数：（click, moveToLeft, moveToRight, clickHead, clickBody）
}
```
#### 动作初始化 initAnimNames 配置内容说明
```
{
  pushMsgAnim: string //推送消息动作名称（选填）
  enterAnim: string //进场动作名称（选填）
  normalAnim: string //静止状态动作
  loopAnim: string //无消息情况下的循环动作 10s动作一次 （选填）
  clickHeadAnim: string //点击头部动作名称
  clickBodyAnim: string //点击身体动作名称
  toLeftAnim: string  //向左划动动作名称
  toRightAnim: string //向右滑动作名称
}
```
#### 使用举例：
```
let dinoAnim = new DinoAnim({
  width: 400,
  height: 620,
  scale: 0.4,
  el: window.document.querySelector('body')
  positionConfig: {
    'z-index': 2,
    left: '100px',
    top: '20px'
  },
  centrePoint: [110, 160],
  initAnimNames: {
    pushMsgAnim: 'global_grumble_announce',
    enterAnim: 'global_warm_welcome_run',
    normalAnim: 'global_standard',
    loopAnim: 'global_normal_1',
    clickHeadAnim: 'cabin_activity_tap_head',
    clickBodyAnim: 'cabin_activity_tap_body',
    toLeftAnim: 'cabin_activity_tap_head_blowkiss',
    toRightAnim: 'global_warm_welcome_magic',
  },
  isAgreeClick: false,
  turnRound: false,
  initSkinData: {
    'HAND_PARTS': [
      {
        "name": "hand_json",
        "type": "json",
        "url": "https://vos-media.vipkid-qa.com.cn/hand_R_caster_tex.json"
      },
      {
        "name": "hand_png",
        "type": "image",
        "url": "https://vos-media.vipkid-qa.com.cn/hand_R_caster_tex.png"
      },
      {
        "name": "hand_bin",
        "type": "bin",
        "url": "https://vos-media.vipkid-qa.com.cn/hand_R_caster_ske.json"
      }
    ],
    'LEG_PARTS': [
      {
        "name": "leg_json",
        "type": "json",
        "url": "https://vos-media.vipkid-qa.com.cn/foot_R_caster_tex.json"
      },
      {
        "name": "leg_png",
        "type": "image",
        "url": "https://vos-media.vipkid-qa.com.cn/foot_R_caster_tex.png"
      },
      {
        "name": "leg_bin",
        "type": "bin",
        "url": "https://vos-media.vipkid-qa.com.cn/foot_R_caster_ske.json"
      }
    ]
  },
  resources: [
    {
      "name": 'dino_json',
      "type": 'json',
      "url": 'https://vos-media.vipkid-qa.com.cn/learning/1537529122487Dino1_tex.json'
    },
    {
      "name": 'dino_bin',
      "type": 'bin',
      "url": 'https://vos-media.vipkid-qa.com.cn/learning/1537528738797Dino1_ske.dbbin'
    },
    {
      "name": 'dino_image',
      "type": 'image',
      "url": 'https://vos-media.vipkid-qa.com.cn/learning/1537529179688Dino1_tex.png'
    }
  ],
  resRootPath: 'https://vos-media.vipkid-qa.com.cn/',
  showLoading: true,
  tapHandle: function(msg) {
    console.log(msg, '1')
  },
  errorHandle: (err) => {
    console.log(err)
  },
  complete: function () {
    console.log('开始1')
    dinoAnim.showDino()
    dinoAnim.play('global_standard')
    //dinoAnim.playAnimationOnce('global_warm_welcome_run', function() {
    //  console.log('动作结束：global_warm_welcome_run')
    //  dinoAnim.playAnimationOnce('global_grumble_welcome', function () {
    //    console.log('动作结束：global_grumble_welcome')
    //    dinoAnim.removeSkin(['HAND_PARTS'])
    //  })
    //})
  }
})

```
#### 使用动作方法必须在初始化完成之后
##### 显示场景
```
dinoAnim.showDino()
```
##### 隐藏场景
```
dinoAnim.hideDino()
```
##### 单动作调用，会一直循环调用
```
// 'global_warm_welcome_run': 动作名称(必填)
dinoAnim.play('global_warm_welcome_run')
```
##### 单动作调用
```
// 'global_warm_welcome_run': 动作名称(必填);  3000: 动作执行时间(可选，单位：毫秒，如果设为0或不设置，动作执行时间就是执行一次用时)。回调函数将在动作执行完毕后触发（可选）
dinoAnim.playAnimationOnce('global_warm_welcome_run', function() {
  //动作结束
}, 3000)
```
##### 多动作调用
```
//该方法传两个参数，第一个是动作列表（必填）；第二个是每个动作结束后的回调函数（可选，返回参数是该动作设置参数）；动作执行顺序按照动作列表的先后顺序依次执行。动作列表项包含：animName（必填，动作名称），delayTime（选填，动作延迟时间，即该动作执行结束后，多少毫秒后执行下个动作），runTime(可选，单位：毫秒，如果设为0或不设置，动作执行时间就是执行一次用时)
dinoAnim.playAnimationList([
  {
    animName: 'global_warm_welcome_run',
    delayTime: 1500,
    runTime: 3000
  }, 
  {
    animName: 'global_grumble_welcome',
    runTime: 3000
  },
  {
    animName: 'global_grumble_announce',
    delayTime: 2000
  },
  {
    animName: 'global_normal_Caster'
  }], function(name) {
    console.log('动作结束', name)
  })
```
##### 循环调用一个动作，只能设置一个循环动作
```
// 该方法传两个参数，第一个是动作名（必填）；第二个循环时间（必填，单位是毫秒）
dinoAnim.loopRandomAnim('global_grumble_announce', 10000)
```
##### 关闭循环调用
```
dinoAnim.clearLoopRandomAnim()
```
##### 停止播放动作，回到正常状态
```
dinoAnim.clearAnim()
```
##### 更换皮肤
```
dinoAnim.replaceSkin({
    'HAND_PARTS': [
      {
        "name": "hand_json",
        "type": "json",
        "url": "https://vos-media.vipkid-qa.com.cn/hand_R_caster_tex.json"
      },
      {
        "name": "hand_png",
        "type": "image",
        "url": "https://vos-media.vipkid-qa.com.cn/hand_R_caster_tex.png"
      },
      {
        "name": "hand_bin",
        "type": "bin",
        "url": "https://vos-media.vipkid-qa.com.cn/hand_R_caster_ske.json"
      }
    ],
    'LEG_PARTS': [
      {
        "name": "leg_json",
        "type": "json",
        "url": "https://vos-media.vipkid-qa.com.cn/foot_R_caster_tex.json"
      },
      {
        "name": "leg_png",
        "type": "image",
        "url": "https://vos-media.vipkid-qa.com.cn/foot_R_caster_tex.png"
      },
      {
        "name": "leg_bin",
        "type": "bin",
        "url": "https://vos-media.vipkid-qa.com.cn/foot_R_caster_ske.json"
      }
    ]
  }, ()=> {
  //更换完毕
}) 
```
##### 去除指定部位皮肤
```
// 数组里可以指定多个部位
dinoAnim.removeSkin(['HAND_PARTS','LEG_PARTS'])
```
##### 去除所有皮肤
```
dinoAnim.removeAllSkins()
```