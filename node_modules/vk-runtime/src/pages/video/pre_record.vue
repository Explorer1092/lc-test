<template lang="jade">
  //- pro:project
  .pro-content
    .pro-back(@click="$router.back()")
    .pro-title
      h1 {{title}}
    .pro-panel
      .pro-video
        over-video(v-if="videoSrc&&(!canRecord)", :autoPlay="autoPlay", :videoSrc="videoSrc", :materialId="materialId_", :source="source_")
        record-video(v-if="videoSrc&&(canRecord)", :autoPlay="autoPlay", :videoSrc="videoSrc", :materialId="materialId_", :source="source_",:recordInfo="recordInfo")
    transition(enter-active-class="animated bounceInDown",leave-active-class="animated bounceOutUp")
      downApp(v-show="isShow",:tripsContent="downAppText")
</template>
<script>
import Velocity from 'velocity-animate'
import axios from 'axios'
import cookies from 'cookies-js'

import dragonUtils from '../../utils/_dragon.js'

import overVideo from '../common/vk_video.vue'
import recordVideo from './components/record_video.vue'
import downApp from '../common/vk_down_app.vue'

export default {
  data: function () {
    return {
      downAppText:'电脑客户端支持边看视频边录音哟～',
      isShow:false,
      title: '',
      level: 1,
      unit: 1,
      lesson: 1,
      videoSrc: false,
      autoPlay: true,
      unitId: this.$route.params.id,
      type: this.$route.params.type, //1主题歌，2预习视频
      curriculumVersion:this.$route.params.curriculum_version,
      source_: '',
      materialId_: '',
      canRecord:false,
      canMock:false
    }
  },
  components: {
    overVideo,
    recordVideo,
    downApp
  },
  mounted() {
    this.autoPlay = true
    this.getRecordInfo()
    this.source_ = 'pre_video'
  },

  methods: {
    //获取预习视频的资料  
    getRecordInfo() {
      if(this.curriculumVersion =="undefined"){
        this.curriculumVersion = 1
      }
      const onlineUrl = "/rest/learninggw/api/pc/material/preClassVideo/getRecordInfo"
      axios.get(onlineUrl,{
        params:{
          studentId:cookies.get('studentId'),
          lessonId:this.unitId,
          curriculumVersion: this.curriculumVersion
        }
      }).then((res)=>{
        this.title = res.data.data.title
        this.videoSrc = res.data.data.url
        this.materialId_ = res.data.data.materialId.toString()
        //如果是IPCV那么可以进行视频录音
        if(res.data.data.type == 'IPCV'){
          this.isShow = true
          sa.track('learning_click',{
            'click_id':'pc_learning_pre_vedio_can_record_not_in_pc_client'
          })
        }
        if(res.data.data.type == "IPCV" && dragonUtils.isOnDragonClient()){
          this.canRecord = true
          this.recordInfo = res.data.data.detail.recordVideos
          sa.track('learning_click', {
            'click_id': 'pc_learning_pre_vedio_can_record_in_pc_client'
          })
        } else {
          this.canRecord = false
          sa.track('learning_click', {
            'click_id': 'pc_learning_pre_vedio_can_not_record'
          })
        }
      })
    }
  }
}
</script>

<style lang="stylus" scoped>
  *
    box-sizing border-box
    -moz-user-select none
    -webkit-user-select none
    -ms-user-select none
    -khtml-user-select none
    user-select none
    -webkit-font-smoothing antialiased

  .pro-back
    position absolute
    height 58px
    width 58px
    top 20px
    left 40px
    cursor pointer
    z-index 11
    background url("../../img/common/back.png") no-repeat center
    &:hover
      background url("../../img/common/back-hover.png") no-repeat center
    &:active
      background url("../../img/common/back-pressed.png") no-repeat center

  .pro-content
    height 100%
    width 100%
    scroll-padding-top: 200px
    padding 139px 250px 61px 250px
    transition: scrollTop 1s
    overflow hidden
    .pro-title
      position: absolute
      text-align: center
      width: 100%
      top: 20px
      left: 0
      color #FFFFFF
      z-index 10
      h1
        font-size: 34px
    .pro-panel
      height 100%
      width 100%
      .pro-video
        float left
        width 100%
        height 100%

</style>
