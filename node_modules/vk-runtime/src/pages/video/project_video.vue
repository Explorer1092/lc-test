<template lang="jade">
  //- pro:project
  .pro-content
    .pro-back(@click="$router.back()")
    .pro-title
      h1 {{title}}
      h2 {{level}} {{unit}}
    .pro-upload(v-if="isShowProjectDemoUploadButton", @click="openUploadDialog")
      | 上传我的project
    .pro-panel
      .pro-video
        over-video(:autoPlay="autoPlay", :videoSrc="videoSrc", :materialId = "materialId_", :source = "'project_video'", :videoPauseTriger="videoPauseSetter")
      .pro-list
        .pro-list-content(ref="listContent",@scroll="listScrollListener")
          .pro-list-title Options
          .pro-list-item(v-for="(option,index) in options",@click="selectedVideo($event)")
            img(src="../../img/project-pinSmall.png",:style="{top:'10px',left:'10px'}")
            img(src="../../img/project-pinSmall.png",:style="{top:'10px',right:'10px'}")
            img(src="../../img/project-pinSmall.png",:style="{bottom:'10px',left:'10px'}")
            img(src="../../img/project-pinSmall.png",:style="{bottom:'10px',right:'10px'}")
            .pli-question {{option.name}}
            .pli-answer
              p(v-html="option.content")
        .pro-list-top
          .pro-list-top-in(@click="topClick",v-show="topShow")
            img(src="../../img/major_extension/list-top.png")
        .pro-list-bottom
          .pro-list-bottom-in(@click="bottomClick",v-show="bottomShow")
            img(src="../../img/major_extension/list-bottom.png")
    upload(v-if="isShowUpload", @closeUploadDialogEvent = "closeUploadDialog", :unitId = "this.$route.params.unitId", :canUploadImg = "!lesson12AsScheduled")
</template>
<script>
  import axios from 'axios'
  import cookies from 'cookies-js'
  import overVideo from '../common/vk_video.vue'
  import upload from '../common/vk_upload.vue'

  import Velocity from 'velocity-animate'
  export default {
    data: function () {
      return {
        $listContent: null,
        topShow: true,
        bottomShow: true,
        listScrollTop: 0,
        sliTopShow: false,
        title: '',
        level: '',
        unit: '',
        videoSrc: "",
        id: null,
        autoPlay: false,
        projectData: null,
        options: [],
        materialId_: '',
        isShowUpload: false,
        lesson12AsScheduled: false,
        isShowProjectDemoUploadButton: false,
        videoPauseSetter: 0
      }
    },
    components: {
      overVideo,upload
    },
    created() {
      this.id = this.$route.params.unitId
      this.autoPlay = true
    },
    mounted() {
      this.projectDemoImgUploadGrey()
      this.$listContent = this.$refs.listContent
      if (this.$listContent.scrollTop == 0) {
        this.topShow = false
      }
      if (this.$listContent.scrollHeight - this.$listContent.scrollTop == this.$listContent.clientHeight) {
        this.bottomShow = false
      }
      this.getoptions()
    },

    methods: {
      projectDemoImgUploadGrey() {
        axios.get('/rest/learninggw/api/pc/grey/getProjectDemoGrey', {
          params: {
            studentId: cookies.get("studentId")
          }
        }).then((res) => {
          if(res.data.code == 200){
            this.isShowProjectDemoUploadButton = res.data.data
          } else {
            this.isShowProjectDemoUploadButton = true
          }
        })
      },
      openUploadDialog() {
        sa.track('learning_click', {'click_id': 'pc_learning_major_course_project_upload'})
        this.videoPauseSetter++
        this.isShowUpload = true
      },
      closeUploadDialog() {
        this.isShowUpload = false
      },
      getoptions() {
        axios.get('/rest/learninggw/api/pc/path/projectDemo/getProjectDemo', {
          params: {
            studentId: cookies.get("studentId"),
            unitId: this.id
          }
        }).then((res) => {
          if (res.data.data != null) {
            this.projectData = res.data.data
            this.lesson12AsScheduled = this.projectData.lesson12AsScheduled
            this.options = this.projectData.options
            this.videoSrc = this.projectData.url
            this.materialId_ = this.projectData.materialId + ''
            this.unit = this.projectData.unitNumber
            this.level = 'Level ' + this.projectData.levelName.match(/\d+/g)[0]
            this.title = this.projectData.showNameEN + ' ' + this.projectData.showNameCH
          }
        }).catch((res) => {
          if (res.response && res.response.status == 403) {
            this.$router.push("/403")
          }
        })
      },
      
      selectedVideo(e) {
        const c = this.$listContent.getBoundingClientRect().top + this.$listContent.clientHeight / 2 - e.target.getBoundingClientRect().top
        Velocity(this.$listContent, "scroll", {
          container: this.$listContent, duration: 500, offset: -c, mobileHA: false
        })
      },
      listScrollListener() {
        if (this.$listContent.scrollTop == 0) {
          this.topShow = false
        } else {
          this.topShow = true
        }
        if (this.$listContent.scrollHeight - this.$listContent.scrollTop == this.$listContent.clientHeight) {
          this.bottomShow = false
        } else {
          this.bottomShow = true
        }
      },
      topClick() {
        Velocity(this.$listContent, "scroll", {
          container: this.$listContent, duration: 500, mobileHA: false, offset: -400, complete: () => {
            if (this.$listContent.scrollTop == 0) {
              this.topShow = false
            } else {
              this.topShow = true
            }
            if (this.$listContent.scrollHeight - this.$listContent.scrollTop == this.$listContent.clientHeight) {
              this.bottomShow = false
            } else {
              this.bottomShow = true
            }
          }
        })
      },
      bottomClick() {
        Velocity(this.$listContent, "scroll", {
          container: this.$listContent, duration: 500, mobileHA: false, offset: 400, complete: () => {
            if (this.$listContent.scrollHeight - this.$listContent.scrollTop == this.$listContent.clientHeight) {
              this.bottomShow = false
            } else {
              this.bottomShow = true
            }
            if (this.$listContent.scrollTop == 0) {
              this.topShow = false
            } else {
              this.topShow = true
            }
          }
        })
      }
    }
  }
</script>

<style lang="stylus" scoped>
  *
    box-sizing border-box
    font-family PingFangSC
    -moz-user-select none
    -webkit-user-select none
    -ms-user-select none
    -khtml-user-select none
    user-select none
    -webkit-font-smoothing antialiased

  .pro-back
    position absolute
    height 58px
    width 58px
    top 20px
    left 40px
    cursor pointer
    z-index 11
    background url("../../img/common/back.png") no-repeat center
    &:hover
      background url("../../img/common/back-hover.png") no-repeat center
    &:active
      background url("../../img/common/back-pressed.png") no-repeat center

  .pro-content
    height: 100%
    width: 100%
    scroll-padding-top: 200px
    padding: 139px 120px 61px 120px
    transition: scrollTop 1s
    overflow: hidden
    .pro-upload
      position: fixed
      top: 20px
      right: 40px
      z-index: 11
      width: 210px
      height: 52px
      font-size: 20px
      font-weight: 500
      line-height: 47px
      text-align: right
      padding-right: 10px
      color: #FFFFFF
      cursor: pointer
      border-radius: 100px
      background: rgb(133, 97, 237) url("../../img/major_extension/project_upload.png") no-repeat 15px 9px
      background-size: 32px
      box-shadow: inset 0 -6px 0 0 rgb(107, 75, 199)
    .pro-title
      position: absolute
      text-align: center
      width: 100%
      top: 20px
      left: 0
      color: #FFFFFF
      z-index: 10
      h1
        font-size: 34px
      h2
        font-size: 24px
    .sli-tip
      position: absolute
      z-index: 999
      height: 75px
      width: 240px
      padding: 9px 21px 22px 21px
      background url("../../img/major_extension/tip_bg.png") no-repeat center
    .pro-panel
      height: 100%
      width: 100%
      .pro-video
        float: left
        width: 100%
        height: 100%
        margin-right: -320px
        padding-right: 320px
      .pro-list
        position: relative
        float: left
        height: 100%
        width: 307px
        margin-left: 10px
        border-radius: 25px
        border: solid 4px #8561ed
        background-color: #4e2c8d
        overflow: hidden
        .pro-list-title
          text-align: center
          color: #ffffff
          font-size: 24px
          margin-top: 20px
        .pro-list-content
          position: absolute
          overflow-y: scroll
          padding: 15px
          bottom: 10px
          top: 10px
          .pro-list-title
            text-align: center
            color: #ffffff
            font-size: 24px
            margin-top: 20px
          .pro-list-item-selected
            background url("../../img/major_extension/unit-selected.png") no-repeat center
          .pro-list-item
            position: relative
            width: 270px
            margin-top: 20px
            border-radius: 20px
            background-color: #ece7ff
            padding: 22px
            cursor: pointer
            font-size: 20px
            box-shadow: 3px 3px 0 0 #e0dcf0, 0 -3px 0 0 #f4f1ff
            img
              position: absolute
            .pli-question
              text-align: center
              border-radius: 17px
              background-color: #ffffff
              padding: 8px
              color: #321b70
            .pli-answer
              color: #555555
              margin-top: 10px
              p
                margin-top: 10px
        .pro-list-top
          position: absolute
          top: 0
          height: 46px
          width: 100%
          text-align: center
          background: rgba(78, 44, 141, 0.0)
          background: -moz-linear-gradient(top, #4e2c8d, rgba(78, 44, 141, 0.0))
          background: -webkit-gradient(linear, 0 0, 0 bottom, from(#4e2c8d), to(rgba(78, 44, 141, 0.0)))
          background: -o-linear-gradient(top, #4e2c8d, rgba(78, 44, 141, 0.0))
          background: linear-gradient(to bottom, #4e2c8d, rgba(78, 44, 141, 0.0))
          border-radius: 23px 23px 0px 0px
          .pro-list-top-in
            height: 46px
            width: 92px
            border-radius: 0 0 46px 46px
            background-color: rgba(255, 255, 255, 0.1)
            margin: auto
            cursor: pointer
            text-align: center
            &:hover
              background-color: rgba(255, 255, 255, 0.3)
            img
              margin: 10px auto
        .pro-list-bottom
          position: absolute
          bottom: 0
          height: 46px
          width: 100%
          text-align: center
          background: rgba(78, 44, 141, 0.0)
          background: -moz-linear-gradient(bottom, #4e2c8d, rgba(78, 44, 141, 0.0))
          background: -webkit-gradient(linear, 0 0, 0 bottom, from(rgba(78, 44, 141, 0.0)), to(#4e2c8d))
          background: -o-linear-gradient(bottom, #4e2c8d, rgba(78, 44, 141, 0.0))
          background: linear-gradient(to top, #4e2c8d, rgba(78, 44, 141, 0.0))
          border-radius: 0px 0px 23px 23px
          .pro-list-bottom-in
            margin: auto
            height: 46px
            width: 92px
            border-radius: 46px 46px 0 0
            background-color: rgba(255, 255, 255, 0.1)
            cursor: pointer
            text-align: center
            &:hover
              background-color: rgba(255, 255, 255, 0.3)
            img
              margin: 20px auto

</style>
