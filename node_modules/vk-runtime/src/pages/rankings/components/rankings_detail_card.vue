<template lang="jade">
.rankings-detail-card(@click.stop="")
  .triangle.isNormal(ref="triangle", v-if="isNormal")
  .triangle(ref="triangle", v-if="!isNormal")
  .card-detail-box
    .detail-title(v-if="isSelf") 每周最佳3节课
    //他人详情列表
    .detail-list(v-if="!isSelf")
      .detail-other-title {{studentInfo.studentName}}的总分
      .detail-user-info.flex-between
        .user-age.flex-center
          .age-icon
          span {{studentInfo.ageGroup}}
        .user-location.flex-center
          .location-icon
          span {{studentInfo.city}}
      .detail-other-item
        .level-info {{studentInfo.levelTitle ? studentInfo.levelTitle: 'Ta本周还没有上课'}}
        .subject-catalog.flex-between
          span.flex-left 课中表现
          span.flex-middle 课前预习
          span.flex-right 课后作业
        .user-score.flex-between
          span.flex-left(v-if="datalist[0].classroomScore || !studentInfo.hasClass") {{datalist[0].classroomScore}}分
          //已经上过课了，但是0分
          span.flex-left.statistics(v-if="!datalist[0].classroomScore && studentInfo.hasClass") 统计中预计一天
          span.flex-middle {{datalist[0].doPreviewScore}}分
          span.flex-right {{datalist[0].doHomeworkScore}}分
    //本人详情列表  
    .detail-list.detail-list-padding(v-if="isSelf")
      .detail-self-item(v-if="isSelf", v-for="item in datalist", :class="{'disabled-style': !item.goToClass}")
        .level-info.flex-between
          .level-title {{item.goToClass ? item.unitName : "level - unit -"}}
          .timer(v-if="item.goToClass") {{item.timer}}
        .detail-self-item-bottom 
          .subject-catalog.flex-between
            span.flex-left 课中表现
            span.flex-middle 课前预习
            span.flex-right 课后作业
          .user-expression.flex-between(v-if="item.goToClass && item.classroomScore")
            span 开口时长{{item.expressionResult}}秒
          .user-expression.flex-between(v-if="item.goToClass && item.classroomScore")
            span 对话次数{{item.interactionResult}}次  
          .user-score.flex-between
            span.flex-left(v-if="item.classroomScore || !item.goToClass") {{item.goToClass ? item.classroomScore : "- -"}}分
            span.flex-left.statistics(v-if="item.goToClass && !item.classroomScore") 统计中预计一天
            span.flex-middle.flex-middle {{item.goToClass ? item.doPreviewScore : "- -"}}分
            span.flex-right {{item.goToClass ? item.doHomeworkScore : "- -"}}分

</template>
<script>
  import untils from '../../../utils/_untils.js'
  export default {
    props: {
      studentInfo: {
        type: Object,
        default() {
          return {}
        }
      },
      isSelf: {
        type: Boolean,
        default: false
      },
      isNormal: {
        type: Boolean,
        default: true
      },
      detailList: {
        type: Array,
        default() {
          return []
        }
      }
    },
    computed: {
      datalist() {
        let arr = []
        if (this.isSelf) {
          for (let i = 0; i < 3; i++) {
            if (this.detailList[i]) {
              arr.push({
                goToClass: true,
                unitName: this.detailList[i].unitName || '',
                timer: untils.timeFormatAll(this.detailList[i].scheduledDateTime).split('-').join('.'),
                expressionResult: this.detailList[i].expressionResult || 0,
                interactionResult: this.detailList[i].interactionResult || 0,
                doHomeworkScore: this.detailList[i].doHomeworkScore + this.detailList[i].homeworkCorrectRateScore || 0,
                doPreviewScore: this.detailList[i].doPreviewScore || 0,
                classroomScore: this.detailList[i].expressionScore + this.detailList[i].interactionScore
              })
            } else {
              //未进行的课程
              arr.push({
                goToClass: false
              })
            }
          }
        } else {
          arr.push({
            doHomeworkScore: this.detailList[0].doHomeworkScore || 0,
            doPreviewScore: this.detailList[0].doPreviewScore || 0,
            classroomScore: this.detailList[0].classroomScore || 0
          })
        }
        return arr
      }
    },
    mounted() {
      this.setTriangleSite()
    },
    methods: {
      //设置三角位置
      setTriangleSite() {
        if (this.isNormal) {
          this.$refs.triangle.setAttribute('style', `top: ${this.$el.clientHeight / 2 - 23}px`)
        } else {
          this.$refs.triangle.setAttribute('style', `top: ${this.$el.clientHeight / 2 - 23}px; right:-17px`)
        }
      }
    }
  }
</script>
<style lang="stylus" scoped>
.disabled-style
  opacity: 0.5

.flex-center
  display: flex
  display: -webkit-flex
  align-items: center
  justify-content: center
  -webkit-align-items: center
  -webkit-justify-content: center

.flex-between
  display: flex
  display: -webkit-flex
  align-items: center
  justify-content: space-between
  -webkit-align-items: center
  -webkit-justify-content: space-between
  padding: 0 12px
  color: #745EBF
  font-size: 14px
  margin: 0 auto

.flex-left
  flex: 1
  -webkit-flex: 1

.flex-middle
  flex: 1
  -webkit-flex: 1
  text-align: center

.flex-right
  flex: 1
  -webkit-flex: 1
  text-align: end

.rankings-detail-card
  display: flex
  display: -webkit-flex
  justify-content: center
  align-items: center
  -webkit-justify-content: center
  -webkit-align-items: center
  position: relative
  
  .triangle
    position: absolute
    top: 0
    width: 26px
    height: 46px
    background-image: url('../../../img/rankings/more-left@2x.png')
    background-repeat: no-repeat
    background-size: 100% 100%

  .isNormal
    background-image: url('../../../img/rankings/triangle@2x.png')
    background-repeat: no-repeat
    background-size: 100% 100%
    left: -17px

  .card-detail-box
    width: 336px
    background: #7254DB
    box-shadow: 4px 7px 9px 0px rgba(67,5,166,0.6)
    border-radius: 20px
    box-sizing: border-box
    padding: 6px 
    
    .detail-title
      height: 25px
      font-size: 18px
      color: #fff
      line-height: 25px
      text-align: center
      margin-bottom: 4px
    
    .detail-list-padding
      padding-bottom: 20px

    .detail-list
      background: #fff
      border-radius: 20px
      border: 1px solid transparent

      .detail-other-title
        color: #745EBF
        width: 300px
        box-sizing: border-box
        margin: 0 auto
        height: 33px
        font-size: 24px
        line-height: 33px
        margin: 20px auto 5px
        padding-left: 12px

      .detail-user-info
        width: 300px
        box-sizing: border-box
        margin: 4px auto 16px

        .age-icon
          width: 18px
          height: 18px
          margin-right: 4px
          background-image: url("../../../img/rankings/age@2x.png")
          background-repeat: no-repeat
          background-size: 100% 100%

        .location-icon
          width: 18px
          height: 18px
          margin-right: 4px
          background-image: url("../../../img/rankings/location@2x.png")
          background-repeat: no-repeat
          background-size: 100% 100%

      .detail-other-item
        width: 300px
        margin: 0 auto
        background:rgba(111,80,215,0.1)
        border-radius: 10px
        margin-bottom: 12px
        overflow: hidden
        
        .level-info
          height: 24px
          background: rgba(114,84,219,0.8)
          font-size: 14px
          line-height: 24px
          color: #ffffff
          padding-left: 12px

        .subject-catalog
          margin-top: 12px
          font-size: 12px

        .user-score
          margin: 6px 0 16px

        .statistics
          font-size: 12px
          color: #666  

      .detail-self-item
        margin-top: 20px
        font-size: 12px
        .level-info
          width: 300px
          box-sizing: border-box
          padding: 0

          .level-title
            color: #ffffff
            width: 118px
            height: 20px
            font-size: 14px
            line-height: 20px
            padding-left: 12px
            background-image: url("../../../img/rankings/levelbg@2x.png")
            background-repeat: no-repeat
            background-size: 100% 100%

          .timer
            font-size: 12px
            padding-right: 12px

        .detail-self-item-bottom
          width: 300px
          margin: 0 auto
          background: rgba(111,80,215,0.1)
          border-radius: 0px 10px 10px 10px
          padding: 8px 0 6px

          .subject-catalog
            margin-bottom: 6px
            font-size: 12px

          .user-expression
            margin-bottom: 6px
            font-size: 12px
          
          .statistics
            color: #666
            font-size: 12px
</style>

