<template lang="jade">
  canvas.rankings-gift-bg
</template>
<script>
  export default {
    mounted(){
      this.init()
    },
    methods: {
      init() {
        let canvas = this.$el
        let context = canvas.getContext("2d")
        let width = this.$el.parentNode.offsetWidth || 740
        canvas.width = width
        let height = this.$el.parentNode.offsetHeight - 30 || 413
        canvas.height = height

        // création d'un tableau
        let particle = []
        let particleCount = 0
        let gravity = 1
        let colors = [
          '#76FFE8', '#768AFF', '#FFD376', '#A9FF76', '#F8E71C', '#E77885', '#7678FF', '#A876FF', '#1C93F8', '#FF76AA'
        ]
        let count = 0
        let paperCards = 50 //纸片个数
        for (var i = 0; i < paperCards; i++) {

          particle.push({
            x: width / 2,
            y: height / 2,
            boxW: 16,
            boxH: 16,
            size: randomRange(2, 8),

            spikeran: randomRange(3, 5),

            velX: randomRange(-8, 8),
            velY: randomRange(-15, -1),

            angle: convertToRadians(randomRange(0, 360)),
            color: colors[Math.floor(Math.random() * colors.length)],
            anglespin: randomRange(-0.2, 0.2),

            draw: function () {
              context.save()
              context.translate(this.x, this.y)
              context.rotate(this.angle)
              context.fillStyle = this.color
              context.beginPath()
              context.fillRect(this.boxW / 2 * -1, this.boxH / 2 * -1, this.boxW, this.boxH)
              context.fill()
              context.closePath()
              context.restore()
              this.angle += this.anglespin
              this.velY *= 0.999
              this.velY += 0.3

              this.x += this.velX
              this.y += this.velY
              if (this.y < 0) {
                this.velY *= -0.2
                this.velX *= 0.9
              }
              if (this.y > height) {
                this.anglespin = 0
                this.y = height + 100 //隐藏底部
                this.velY *= -0.2
                this.velX *= 0.9
                this.draw = null
                count++
              }
              if (this.x > width || this.x < 0) {
                this.velX *= -0.5
              }
            }
          })
        }

        function drawScreen() {
          context.globalAlpha = 1
          for (var i = 0; i < particle.length; i++) {
            if (particle[i].draw) {
              particle[i].draw()
            }
          }
        }

        function update() {
          if (count >= paperCards) { 
            context.clearRect(0, 0, width, height)
            return
          }
          context.clearRect(0, 0, width, height)
          drawScreen()
          //重绘之后执行一个动画
          requestAnimationFrame(update)
        }

        update()

        //产生两数之间的随机数
        function randomRange(min, max) {
          return min + Math.random() * (max - min)
        }
        function convertToRadians(degree) {
          return degree * (Math.PI / 180)
        }
      }
    }
  }
</script>
<style lang="stylus" scoped>
.rankings-gift-bg
  position: absolute
  left: 0
  top: 0
  z-index: 0

</style>

