<template lang="jade">
  .dino-comics-wrapper
    top-part(:isAbsoluteFix="true", :ifShow="false", v-if="notId")
    error(v-if="notId")
    birth(v-if="pageId === '0' && showPage", @adoptPetError="adoptPetError")
</template>
<script>
  import birth from './components/birth.vue'
  import TopPart from '../common/top_part.vue'
  import error from '../common/error_404.vue'
  import utils from '../../utils/_untils.js'
  import axios from 'axios'
  import cookies from 'cookies-js'
  export default {
    data: function () {
      return {
        pageId: '',
        showPage: false
      }
    },
    props: {
    },
    computed: {
      notId() {
        return ['0'].indexOf(this.pageId) === -1
      }
    },
    components: {
      birth,
      TopPart,
      error
    },
    created () {
      this.getRouteId()
    },
    beforeRouteEnter (to, from, next) {
      let paths = ['/hot_activity', '/']
      if (paths.indexOf(from.path) !== -1) {
        if (from.path === '/hot_activity' && Vm.dinoBirthFrom === '/') {
          utils.gotoFirstPage()
          return
        }
        Vm.dinoBirthFrom = from.path
      } else if (!Vm.dinoBirthFrom){
        Vm.dinoBirthFrom = '/'
      } else if (Vm.dinoBirthFrom === '/hot_activity') {
        Vm.dinoBirthFrom = '/'
        next('/hot_activity')
      } else {
        utils.gotoFirstPage()
        return
      }
      next()
    },
    methods: {
      getRouteId() {
        this.pageId = this.$route.params.id + ''
        axios
          .get("/rest/learninggw/api/pet/pet/detail", {
            params: {
              studentId: cookies.get("studentId")
            }
          })
          .then(res => {
            if (res.data.code == "200" && res.data.data.petSwitch == "ON", res.data.data.growUpStatus =='EGG') { 
              this.showPage = true
            } else {
              if (Vm.dinoBirthFrom === '/hot_activity') {
                this.$router.push('/hot_activity')
              } else {
                utils.gotoFirstPage()
              }
            }
          })
      },
      adoptPetError() {
        this.pageId = ''
      }
    }
  }
</script>


<style lang="stylus" scoped>
  .dino-comics-wrapper
    width: 100%
    height: 100%
</style>
