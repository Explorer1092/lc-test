<template lang="jade">
  .outside-wrapper
    .island-entry-wrapper#j-scroll(ref="islandWrapper", @mousewheel="userSrollDown($event)", @DOMMouseScroll="userSrollDown($event)")
      top-part(:title_cn = "title_chinese", :title_eng = "title_english", :gobackurl="'/major_course_catalog'")
      arrow(@arrowClick="windowScoll", :leftEnd = "isAtLeftEnd", :rightEnd = "isAtRightEnd")
      island(@courseDetailLayerTriger = "openCourseDetail", @setTitleEvent = 'setTitle')
      course-detail(:isCourseDetailShow = "isCourseDetailChildShow", @courseDetailLayerTriger  = "closeCourseDetail", :courseDetailDataProp = "courseDetailData")
      course-switch(@openSwitch="courseSwitchOpen", @closeSwitch="courseSwitchClose")
      move-background
</template>
<script>
  import TopPart from '../common/top_part.vue'
  import arrow from '../common/arrow.vue'
  import Velocity from 'velocity-animate'
  import courseDetail from '../common/course_detail.vue'
  import moveBackground from '../common/move_background.vue'
  import island from './components/major_island.vue'
  import courseSwitch from './components/major_course_switch.vue'
  import Vue from 'vue'
  export default {
    data: function () {
      return {
        title_chinese: '',
        title_english: '',
        isAtLeftEnd: true,
        isAtRightEnd: false,
        isCourseDetailChildShow: false,
        courseDetailData: {},
        forbiddenHorizontalScroll: false //禁止鼠标滚轮操纵横向滚动
      }
    },
    components: {
      TopPart,
      arrow,
      island,
      moveBackground,
      courseDetail,
      courseSwitch
    },
    mounted() {
    },
    methods: {
      setTitle(courseNameCh, courseNameEn) {
        this.title_chinese = courseNameCh ? courseNameCh : '主修课程'
        this.title_english = courseNameEn ? courseNameEn : 'Major Course'
      },
      courseSwitchOpen() {
        this.forbiddenHorizontalScroll = true
      },
      courseSwitchClose() {
        this.forbiddenHorizontalScroll = false
      },
      openCourseDetail(courseDetailData) {
        this.forbiddenHorizontalScroll = true
        this.isCourseDetailChildShow = true
        this.courseDetailData = courseDetailData
      },
      closeCourseDetail() {
        this.forbiddenHorizontalScroll = false
        this.isCourseDetailChildShow = false
      },
      userSrollDown(e) {
        if (!this.forbiddenHorizontalScroll) {
          document.getElementById('j-scroll').scrollLeft += e.deltaY || e.detail * 5
        }
      },
      windowScoll(direction) {
        var nextPosition, moveD
        var that = this
        var currPositon = document.getElementById('j-scroll').scrollLeft
        var maxScollPostion = document.getElementById('j-island-con').clientWidth - window.innerWidth
        var moveDistance = window.innerWidth / 2 //每次移动50%视窗宽度
        if (!this.isScolling) {
          //滚动动画停止时执行
          this.isScolling = true
          if (direction == 'right') {
            nextPosition = currPositon + moveDistance
          }
          if (direction == 'left') {
            nextPosition = currPositon - moveDistance
          }
          Velocity(this.$refs.islandWrapper, "scroll", {
            axis: "x",
            container: this.$refs.islandWrapper,
            duration: 300,
            offset: direction == 'right' ? moveDistance : 0 - moveDistance,
            mobileHA: false,
            complete: scrollEnd
          })
        }
        function scrollEnd() {
          //滚动动画回调
          that.isScolling = false
        }
      }
    }
  }
</script>
<style lang="stylus" scoped>
  .outside-wrapper
    position: relative
    height: 100%
    overflow: hidden
    .island-entry-wrapper
      position: relative
      height: 100%
      overflow-y: hidden
      overflow-x: scroll
</style>
