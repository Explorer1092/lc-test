<template lang="jade">
  .switch-course
    .switch-layer-wrapper(v-visible="isThisLayerShow")
      .black-mirror(@click.stop="closeThisLayer")
      .switch-planet-box
        .close-btn(@click.stop="closeThisLayer")
        .planet-shelter
          .planet-btn.planet-right(@click.stop="planetScrollToRight($event)", v-if="isPlanetRightBtnShow")
            .click-feedback(@click.stop="")
          .planet-btn.planet-left(@click.stop="planetScrollToLeft($event)", v-if="isPlanetLeftBtnShow")
            .click-feedback(@click.stop="")
          .switch-planet-wrapper(ref="planetWrap", v-gscroll="", @scroll="onScroll")
            .switch-planet-item-box
              .switch-planet-item(v-for="item, index in planetList", @click.stop="switchCourse(item.planetNumber)", :class="[{active: currentPlanetNumber ? item.planetNumber === currentPlanetNumber : item.isSelect}, ui.planetClassList[item.planetNumber-1]]", v-if="item.isHas")
                img(:src="item.imageUrl")
                .switch-course-type-title-holder
                  p.cn {{item.chName}}
                  p.en {{item.enName}}
        .switch-wrapper
          .switch-container(v-for="(itemPlanetList, indexPlanetList) in planetList", v-show="currentPlanetNumber ? itemPlanetList.planetNumber === currentPlanetNumber : itemPlanetList.isSelect")
            .switch-tabs(v-if="itemPlanetList.frames")
              .switch-tab-item(v-for="(tabItem, tabIndex) in itemPlanetList.frames", @click.stop="switchTab(itemPlanetList.planetNumber, tabIndex)", :class="[{active: currentTab(itemPlanetList.planetNumber, tabIndex, tabItem.isSelect) }, ui.planetClassList[itemPlanetList.planetNumber-1]]")
                p {{tabItem.chName}}
                slide-text(:text="tabItem.enName")
            .switch-box(v-if="itemPlanetList.frames", v-gscroll="", :class="ui.planetClassList[itemPlanetList.planetNumber-1]")
              .switch-box-item-container(v-for="(itemFrame, indexFrame) in itemPlanetList.frames", v-show="currentTab(itemPlanetList.planetNumber, indexFrame, itemFrame.isSelect)")
                .switch-box-item(v-for="(itemUnit, indexUnit) in itemFrame.tabs", @click.stop="jumpTo(itemPlanetList.planetNumber, itemPlanetList.minorType, itemUnit.curriculumId, itemUnit.curriculumType)" )
                  img(v-if="itemUnit.imageUrl", :src="itemUnit.imageUrl")
                  img(v-else, src="../../img/summercamp_Beginning@2x.png")
                  p {{itemUnit.chName}}
            .switch-box(v-else, v-gscroll="", :class="ui.planetClassList[itemPlanetList.planetNumber-1]")
              .switch-box-item-container
                .switch-box-item(v-for="(itemTab, indexO) in itemPlanetList.tabs", @click.stop="jumpTo(itemPlanetList.planetNumber, itemPlanetList.minorType, itemTab.curriculumId, itemTab.curriculumType)" )
                  img(v-if="itemTab.imageUrl", :src="itemTab.imageUrl")
                  img(v-else, src="../../img/summercamp_Beginning@2x.png")
                  p {{itemTab.chName}}
    .change-level(@click.stop="openThisLayer")
      p 切换课程
      img(src="../../img/change-level-next@2x.png")
</template>
<script>
  import Vue from 'vue'
  import axios from 'axios'
  import cookies from 'cookies-js'
  import utils from '../../utils/_untils.js'
  import Velocity from 'velocity-animate'
  import slideText from '../common/vk_slide_text.vue'
  import VerticalScroll from '../common/plugins/VerticalScroll'
  Vue.use(VerticalScroll)
  export default {
    data() {
      return {
        isThisLayerShow: false,
        unitBoxMoving: false,
        unitBoxTranslateX: null,
        unitBox: null,
        isLeftButtonShow: false,
        isRightButtonShow: false,
        currUnitItemBoxWidth: null,
        //重构字段
        isPlanetRightBtnShow: false,
        isPlanetLeftBtnShow: false,
        tabIndex: 0,
        tabMark: [],
        planetList: [],
        currentPlanetNumber: null,
        ui:{
          planetClassList:[
            'public', //1
            'toefl', //2
            'winter', //3
            'summer', //4
            'others', //5
            'phonics', //6
            'pronun', //7
            'vov', //8
            'freetalk', //9
            '', //10
            '', //11
            '', //12
            'conservation', //13
            '', //14
            '', //15
            'interact', //16
            'mvp_red', //17
            'mvp_orange', //18
            'beats', //19
            'fruit', //20
            'design', //21
            'grammar' // 22
          ]
        }
      }
    },
    props: [],
    mounted() {
      this.getSwitchData()
    },
    directives: {
      visible(el, binding) {
        if (binding.value) el.style.visibility = 'visible'
        else el.style.visibility = 'hidden'
      }
    },
    watch: {
    },
    components: {
      slideText
    },
    methods: {
      planetScrollToRight(e) {
        this.planetScroll('right')
      },
      planetScrollToLeft(e) {
        this.planetScroll('left')
      },
      planetScroll(direction) {
        Velocity(this.$refs.planetWrap, "scroll", {
          axis: "x",
          container: this.$refs.planetWrap,
          duration: 300,
          offset: direction == 'right' ? 150 : 0 - 400 //gys尚未解决该问题
        })
      },
      onScroll(e) {
        if (e.target.scrollLeft == 0) {
          this.isPlanetLeftBtnShow = false
        } else {
          this.isPlanetLeftBtnShow = true
        }
        if (e.target.scrollLeft == e.target.scrollWidth - e.target.clientWidth) {
          this.isPlanetRightBtnShow = false
        } else {
          this.isPlanetRightBtnShow = true
        }
      },
      jumpTo(planetNumber, minorType, curriculumId, curriculumType) {
        window.location.href = `/island/${planetNumber}/${curriculumId}/${curriculumType}/${minorType}`
      },
      currentTab: function (planetNumber, tabIndex, isSelect) {
        //切换标签，并且不影响非当前星球的标签。
        if( this.tabMark.length == 0 ) {
          return isSelect
        } else if( this.tabMark[0] == planetNumber ) {
          if( this.tabMark[1] == tabIndex ) {
            return true
          } else {
            return false
          }
        } else {
          return isSelect
        }
      },
      getSwitchData() {
        axios.get('/rest/learninggw/api/pc/path/minor/getMinorTree', {
          params: {
            studentId: cookies.get("studentId"),
            planetNumber: this.$route.params.planetNum,
            curriculumId: this.$route.params.curriculumId ? this.$route.params.curriculumId : ''
          }
        }).then((res) => {
          let totalPlanetCount = 0
          let distance = 0
          this.planetList = res.data.data
          for (let i = 0; i < this.planetList.length; i++) {
            if (this.planetList[i].isHas === true) {
              totalPlanetCount++
              if(this.planetList[i].isSelect) {
                distance = totalPlanetCount * 140
              }
            }
          }
          if (totalPlanetCount > 4) {
            this.isPlanetRightBtnShow = true
            this.$nextTick(() => {
              this.$refs.planetWrap.scrollLeft = distance - this.$refs.planetWrap.clientWidth
            })
          }
        })
      },
      switchTab( planetNumber, tabIndex ) {
        this.tabMark = []
        this.tabMark.push(planetNumber)
        this.tabMark.push(tabIndex)
      },
      openThisLayer() {
        this.isThisLayerShow = true
      },
      switchCourse( flag ) {
        this.currentPlanetNumber = flag
      },
      closeThisLayer() {
        this.isThisLayerShow = false
      }
    }
  }
</script>
<style lang="stylus" scoped>
  .switch-course
    .switch-layer-wrapper
      position: fixed
      top: 0
      left: 0
      right: 0
      bottom: 0
      z-index: 22
      .black-mirror
        position: fixed
        top: 0
        bottom: 0
        left: 0
        right: 0
        z-index: 22
        width: 100%
        height: 100%
        background-color: rgba(0, 0, 0, 0.7)
      .switch-planet-box
        position: absolute
        z-index: 22
        top: 50%
        left: 50%
        margin-top: -255px
        margin-left: -405px
        display: inline-block
        width: 810px
        height: 510px
        box-sizing: border-box
        background-color: #19388a
        background-image: url("../../img/switch_course_bg@2x.png")
        border-radius: 18px
        box-shadow: 3px 2px 14px 0 #36185c
        .close-btn
          position: absolute
          top: -10px
          right: -10px
          display: inline-block
          z-index: 22
          width: 40px
          height: 40px
          background-image: url("../../img/summercamp_button_collection.png")
          background-repeat: no-repeat
          background-position: -80px -220px
          background-size: 400px
          cursor: pointer
          &:hover
            background-position: 0 -220px
          &:active
            background-position: -40px -220px
        .planet-shelter
          overflow: hidden
          height: 175px
          .planet-btn
            position: absolute
            height: 140px
            width: 111px
            top: 34px
            background-color: transparent
            background-repeat: no-repeat
            cursor: pointer
            overflow: hidden
            &:hover
              opacity: 0.7
            &.planet-right
              background-image: url('../../img/extension/planet_next.png')
              background-position: center left
              right: 0
            &.planet-left
              background-image: url('../../img/extension/planet_last.png')
              background-position: center right
              left: 0
            .click-feedback
              width: 4px
              height: 4px
              border-radius: 99px
              background-color: #a18ee3
              position: absolute
              opacity: 0
              &.move
                animation: Click-Feedback 0.4s ease-out
          .switch-planet-wrapper
            width: 566px
            box-sizing: border-box
            padding: 35px 0 0 0
            margin: 0 auto
            text-align: center
            overflow: auto
            &::-webkit-scrollbar
              height: 5px
            &::-webkit-scrollbar-thumb
              border-radius: 999px
              background: rgba(0, 0, 0, 0.2)
            .switch-planet-item-box
              white-space: nowrap
              .switch-planet-item
                position: relative
                display: inline-block
                width: 140px
                height: 140px
                cursor: pointer
                &.winter.active
                  background-image: url('../../img/extension/selected-summer-camp@2x.png')
                  background-repeat: no-repeat
                  background-size: 140px
                  background-position: center 67px
                  margin: 0
                &.public.active
                  background-image: url('../../img/selected-open-class@2x.png')
                  background-repeat: no-repeat
                  background-size: 140px
                  background-position: center 67px
                &.summer.active
                  background-image: url('../../img/selected-summer-camp@2x.png')
                  background-repeat: no-repeat
                  background-size: 140px
                  background-position: center 67px
                &.others.active
                  background-image: url('../../img/selected-other-course@2x.png')
                  background-repeat: no-repeat
                  background-size: 140px
                  background-position: center 67px
                &.toefl.active
                  background-image: url('../../img/selected-toefl.png')
                  background-repeat: no-repeat
                  background-size: 140px
                  background-position: center 67px
                &.phonics.active
                  background-image: url('../../img/extension/phonics_switch_active.png')
                  background-repeat: no-repeat
                  background-size: 140px
                  background-position: center 67px
                &.pronun.active
                  background-image: url('../../img/extension/pronun_switch_active.png')
                  background-repeat: no-repeat
                  background-size: 140px
                  background-position: center 67px
                &.vov.active
                  background-image: url('../../img/extension/vov_switch_active.png')
                  background-repeat: no-repeat
                  background-size: 140px
                  background-position: center 67px
                &.freetalk.active
                  background-image: url('../../img/extension/freetalk_switch_active.png')
                  background-repeat: no-repeat
                  background-size: 140px
                  background-position: center 67px
                // 互动课堂
                &.interact.active
                  background-image: url('../../img/selected_interact_class_2x.png')
                  background-repeat: no-repeat
                  background-size: 140px
                  background-position: center 67px
                // mvp test course 1
                &.mvp_red.active
                  background-image: url('../../img/selected_mvp_red_2x.png')
                  background-repeat: no-repeat
                  background-size: 140px
                  background-position: center 67px
                // mvp test course 2
                &.mvp_orange.active
                  background-image: url('../../img/selected_mvp_orange_2x.png')
                  background-repeat: no-repeat
                  background-size: 140px
                  background-position: center 67px
                // 濒危动物小使者
                &.conservation.active
                  background-image: url('../../img/selected_conservation_@2x.png')
                  background-repeat: no-repeat
                  background-size: 140px
                  background-position: center 67px
                // 创作你的节奏
                &.beats.active
                  background-image: url('../../img/selected_beats_by_kids_@2x.png')
                  background-repeat: no-repeat
                  background-size: 140px
                  background-position: center 67px
                // 水果家族的秘密
                &.fruit.active
                  background-image: url('../../img/selected_fruit_family_@2x.png')
                  background-repeat: no-repeat
                  background-size: 140px
                  background-position: center 67px
                // 开启你的游戏创意
                &.design.active
                  background-image: url('../../img/selected_design_game_@2x.png')
                  background-repeat: no-repeat
                  background-size: 140px
                  background-position: center 67px
                &.grammar.active
                  background-image: url('../../img/extension/selected-grammar@2x.png')
                  background-repeat: no-repeat
                  background-size: 140px
                  background-position: center 67px
                img
                  width: 100px
                  vertical-align: middle
                .switch-course-type-title-holder
                  color: #fff
                  font-size: 12px
                  font-weight: 300
                  line-height: 15px
                  position: relative
                  top: 3px
        .switch-wrapper
          margin-top: 40px
          .switch-container
            position: relative
            .switch-tabs
              position: relative
              top: 1px
              left: 3px
              z-index: 1
              width: 756px
              margin: 0 auto
              .switch-tab-item
                display: inline-block
                vertical-align: middle
                width: 153px
                height: 40px
                opacity: 1
                border-radius: 10px
                margin-right: 5px
                border-top-left-radius: 10px
                border-top-right-radius: 10px
                border-bottom-left-radius: 0
                border-bottom-right-radius: 0
                background-color: #ba8b52
                box-shadow: inset 2px 1px 0 0 #eab975
                color: #d5b998
                text-align: center
                font-size: 14px
                line-height: 18px
                box-sizing: border-box
                padding: 3px 12px 0 12px
                cursor: pointer
                &.active
                  color: #ffffff
                  background-color: #ffaf3b
                  box-shadow: inset 2px 1px 0 0 #ffce85
                &.winter
                  color: #9cb9e0
                  background-color: #5a88c7
                  box-shadow: inset 2px 1px 0 0 #c1e0ff
                  &.active
                    color: #ffffff
                    background-color: #98c9f9
                    box-shadow: inset 2px 1px 0 0 #c1e0ff
                &.toefl
                  color: #ac90dc
                  background-color: #7E4CD6
                  box-shadow: inset 2px 1px 0 0 #9F87FF
                  &.active
                    color: #ffffff
                    background-color: #9F87FF
                    box-shadow: inset 2px 1px 0 0 #C2B5F9

                &.phonics
                  color: #DECBAF
                  background-color: #BD985F
                  box-shadow: inset 2px 1px 0 0 #D0B78F
                  &.active
                    color: #ffffff
                    background-color: #DED79C
                    box-shadow: inset 2px 1px 0 0 #EBE7C3
                &.pronun
                  color: #9AC1DC
                  background-color: #3683B9
                  box-shadow: inset 2px 1px 0 0 #72A8CE
                  &.active
                    color: #ffffff
                    background-color: #A5D1FA
                    box-shadow: inset 2px 1px 0 0 #C9E3FC
                &.vov
                  color: #A7CDC3
                  background-color: #4F9C88
                  box-shadow: inset 2px 1px 0 0 #84B9AB
                  &.active
                    color: #ffffff
                    background-color: #74CDA9
                    box-shadow: inset 2px 1px 0 0 #ABE1CB
                &.freetalk
                  color: #D5ADAB
                  background-color: #AF635E
                  box-shadow: inset 2px 1px 0 0 #C38A87
                  &.active
                    color: #ffffff
                    background-color: #CC7A6E
                    box-shadow: inset 2px 1px 0 0 #DDA69E
                // 互动课堂
                &.interact
                  color: #ffffff
                  background-color: #00A0B3
                  box-shadow: inset 2px 1px 0 0 rgba(255,255,255,0.3)
                  &.active
                    color: #ffffff
                    background-color: #51E0ED
                    box-shadow: inset 2px 1px 0px 0px rgba(255,255,255,0.4)
                // mvp test course 1
                &.mvp_red
                  color: #ffffff
                  background-color: #AA3438
                  box-shadow: inset 2px 1px 0 0 #C37174;
                  &.active
                    color: #ffffff
                    background-color: #EC7169
                    box-shadow: inset 2px 1px 0px 0px #F3A9A5;
                // mvp test course 2
                &.mvp_orange
                  color: #ffffff
                  background-color: #BE5E1C
                  box-shadow: inset 2px 1px 0 0 #D18E60;
                  &.active
                    color: #ffffff
                    background-color: #EC9769
                    box-shadow: inset 2px 1px 0px 0px #F2BA9B;
                // 濒危动物小使者
                &.conservation
                  color: #ffffff
                  background-color: #6D7AFF
                  box-shadow: inset 2px 1px 0 0 #99A2FF
                  &.active
                    color: #ffffff
                    background-color: #98ADFF
                    box-shadow: inset 2px 1px 0px 0px #BAC8FF
                // 创作你的节奏
                &.beats
                  color: #ffffff
                  background-color: #9C50C0
                  box-shadow: inset 2px 1px 0 0 #B984D3
                  &.active
                    color: #ffffff
                    background-color: #C881E9
                    box-shadow: inset 2px 1px 0px 0px #DEB3F1
                // 水果家族的秘密
                &.fruit
                  color: #ffffff
                  background-color: #CE5B43
                  box-shadow: inset 2px 1px 0 0 #DA8472
                  &.active
                    color: #ffffff
                    background-color: #EC9769
                    box-shadow: inset 2px 1px 0px 0px #F2BA9B
                // 开启你的游戏创意
                &.design
                  color: #ffffff
                  background-color: #348B5F
                  box-shadow: inset 2px 1px 0 0 #71AE8F
                  &.active
                    color: #ffffff
                    background-color: #5FC452
                    box-shadow: inset 2px 1px 0px 0px #94D78C
                &.grammar
                  color: #7CB7AF
                  background-color: #007364
                  box-shadow: inset 2px 1px 0 0 #4D9D92
                  width: 120px
                  &.active
                    color: #ffffff
                    background-color: #2EA887
                    box-shadow: inset 2px 1px 0 0 #74C5AF
            .switch-box
              position: relative
              width: 780px
              height: 244px
              border-radius: 20px
              margin: 0 auto 0 auto
              background-repeat: no-repeat
              background-size: cover
              background-image: url("../../img/summer-camp-bg.png")
              border: solid 5px #ffaf3b
              z-index: 2
              box-sizing: border-box
              overflow: auto
              &::-webkit-scrollbar
                height: 7px
              &::-webkit-scrollbar-thumb
                border-radius: 999px
                background: rgba(0, 0, 0, 0.4)
              &.public
                height: 284px
                background-image: url("../../img/background-openclass.png")
                border: solid 5px #c5c2d1
              &.others
                height: 284px
                background-image: url("../../img/background-others-2-x-3-x.png")
                border: solid 5px #a790fa
              &.winter
                background-image: url("../../img/extension/wintercamp-bg@2x.png")
                border: solid 5px #98c9f9
              &.toefl
                background-image: url("../../img/extension/toefl_switch_bg.png")
                border: solid 5px #9F87FF
              &.phonics
                background-image: url("../../img/extension/phonics_unit_bg.png")
                border: solid 5px #DED79C
              &.pronun
                background-image: url("../../img/extension/pronun_unit_bg.png")
                border: solid 5px #A5D1FA
              &.vov
                background-image: url("../../img/extension/vov_unit_bg.png")
                border: solid 5px #74CDA9
              &.freetalk
                background-image: url("../../img/extension/freetalk_unit_bg.png")
                border: solid 5px #CC7A6E
              // 互动课堂
              &.interact
                background-image: url("../../img/background_interact_class_2x.png")
                background-position: center
                border: solid 5px #51E0ED
              // mvp test course 1
              &.mvp_red
                background-image: url("../../img/background_mvp_red_2x.png")
                background-position: center
                border: solid 5px #EC7169
              // mvp test course 2
              &.mvp_orange
                background-image: url("../../img/background_mvp_orange_2x.png")
                background-position: center
                border: solid 5px #EC9769
              // 濒危动物小使者
              &.conservation
                background-image: url("../../img/background_conservation_@2x.png")
                background-position: center
                border: solid 5px #98ADFF
              // 创作你的节奏
              &.beats
                background-image: url("../../img/background_beats_by_kids_@2x.png")
                background-position: center
                border: solid 5px #C881E9
              // 水果家族的秘密
              &.fruit
                background-image: url("../../img/background_fruit_family_@2x.png")
                background-position: center
                border: solid 5px #EC9769
              // 开启你的游戏创意
              &.design
                background-image: url("../../img/background_design_game_@2x.png")
                background-position: center
                border: solid 5px #5FC452
              // 语法课
              &.grammar
                background-image: url("../../img/extension/grammar-bg@2x.png")
                background-position: center
                border: solid 5px #2EA887
              .switch-box-item-container
                white-space: nowrap
                width: 100%
                height: 100%
                text-align: center
                .switch-box-item
                  display: inline-block
                  text-align: center
                  color: white
                  font-size: 14px
                  cursor: pointer
                  margin: 64px 20px 0px 20px
                  text-decoration: none
                  img
                    width: 100px
                    height: 100px
                    margin-bottom: 11px
    .change-level
      position: fixed
      top: 0
      right: 22px
      color: #fff
      font-size: 18px
      background: url("../../img/change-level@2x.png")
      background-size: contain
      width: 156px
      height: 73px
      cursor: pointer
      z-index: 9
      &:hover img
        transform: scale(1.2)
        -ms-transform: scale(1.2)
        -moz-transform: scale(1.2)
        -webkit-transform: scale(1.2)
        -o-transform: scale(1.2)
      p
        position: absolute
        top: 40px
        left: 26px
        line-height: 1em
      img
        position: absolute
        top: 39px
        right: 27px
        width: 20px
        transition: all 0.2s
        -moz-transition: all 0.2s
        -webkit-transition: all 0.2s
        -o-transition: all 0.2s
@keyframes Click-Feedback
  0%
    opacity: 0
    transform: scale(1)
  30%
    opacity: 0.5
    transform: scale(25)
  to
    opacity: 0
    transform: scale(50)
</style>