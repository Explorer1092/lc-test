<template lang="jade">
  .ad-container
    .enter
    .headzone
      top-part(title_eng="Galaxy Store",title_cn="星星商店")
      .student
        .star-region
          .star.icon-star
          span.count(v-text="stars")
    .nexus-wrap
      .top
      .nexus
        nav.nav
          ul
            li.nav-item.nav-item-1(@click="switchSpace",:class="{'nav-item-1-active' : currentType==0}")
              p.nwc 飞船基地
              p.nwe Spaceship Base
            li.nav-item.nav-item-2(@click="switchPet",:class="{'nav-item-2-active': currentType==1}")
              p.nwc 宠物中心
              p.nwe Pet Center
        img.promotion-in(v-if="isShowPromotion",src="../../img/star_store/dino_in_the_ship_small@2x.png",@click="goToPromotion")
        detail(:type="currentType",:showLottery="getResult",:currentStar="stars",:starRefresh="fetchUserInfo")
    .lottery-animation(v-if="isShowLottery")
      .top
      img.egg-pic(src='../../img/gif/eggShow.gif')
    transition(leave-active-class="result-leave")
      .lottery-result(v-if="isShowResult",@click="hideResult")
        .top
        .mid
          img.result-bg(src="../../img/star_store/light_yellow.png")
          img.result-pic(:src="resultImg")
</template>
<script>
  import axios from 'axios'
  import cookies from 'cookies-js'
  import topPart from '../common/top_part.vue'
  import formUrlencoded from 'form-urlencoded'
  import detail from './detail.vue'
  export default {
    data() {
      return {
        currentType: 0,
        stars: 0,
        isShowLottery: false,
        isShowResult: false,
        resultImg: "",
        isShowPromotion: false
      }
    },
    components: {
      topPart, detail
    },
    created() {
      this.fetchUserInfo()
    },
    mounted(){
      this.showPromotion()
    },
    methods: {
      showPromotion(){
        return axios.get('/rest/learninggw/api/pc/service/arbor/isArborActivityOpen', {
          params: {
            studentId: cookies.get("studentId")
          }
        }).then((res) => {
          if (res.data.code == 200) {
            if (res.data.data) {
              this.isShowPromotion = true
            }
          }
        }
        )
      },
      goToPromotion(){
        sa.track('learning_click', {
          'click_id': 'pc_learning_star_store_enter_promotion_star_lottery'
        })
        this.$playSound("click")
        window.location.href = "/games/index.html"
      },
      hideResult(){
        this.isShowResult = false
      },
      getResult(src){
        this.resultImg = src
        this.isShowLottery = true
        setTimeout(() => {
          this.isShowLottery = false
          this.isShowResult = true
          setTimeout(() => {
            this.isShowResult = false
          }, 2000)
        }, 2000)
      },
      switchSpace() {
        this.currentType = 0
      },
      switchPet() {
        this.currentType = 1
      },
      fetchUserInfo() {
        axios.get('/rest/learninggw/api/pc/service/studentstar/findByStudentId', {
          params: {
            t: new Date().getTime(),
            studentId: cookies.get("studentId")
          }
        }).then(res => {
          if (res.data.data) {
            this.stars = res.data.data.leftStars
          }
        })
      }
    }
  }
</script>
<style lang="stylus" scoped>
  .ad-container
    height: 100%

  .backtohome
    width: 60px
    height: 60px
    position: absolute
    top: 18px
    left: 18px
    background-image: url('../../img/common/back.png')
    background-repeat: no-repeat
    &:hover
      background-image: url('../../img/common/back-hover.png')
      cursor: pointer

  .headzone
    position: absolute
    top: 0
    width: 100%

  .student
    position: absolute
    top: 29px
    right: 40px
    padding: 5px 24px
    border-radius: 20px
    background: rgba(255, 255, 255, .2)

  .star-region
    font-size: 16px
    color: #fff
    text-align: center

  .star
    display: inline-block
    width: 27px
    height: 27px
    background-size: 363px 243px
    background-position: 0 -68px
    margin-right: 5px

  .count
    font-size: 22px
    vertical-align: top

  .nexus-wrap
    height: 100%
    text-align: center

  .nexus
    position: relative
    margin: -270px auto 0 auto
    width: 1040px
    .nav
      width: 926px
      height: 60px
      margin: 0 auto
      color: #fff
      position: relative
      top: 2px
      ul
        list-style: none
        .nav-item
          float: left
          width: 180px
          height: 60px
          font-size: 14px
          text-align: center
          margin-right: 10px
          cursor: pointer
          border-top-left-radius: 16px
          border-top-right-radius: 16px
          opacity: 0.4
        .nav-item-1
          background-image: url('../../img/star_store/tab-ac.png')
          &:hover
            opacity: 1
        .nav-item-2
          background-image: url('../../img/star_store/tab-pe.png')
          &:hover
            opacity: 1
        .nav-item-1-active
          opacity: 1
        .nav-item-2-active
          opacity: 1

  .promotion-in
    position: absolute
    top: -25px
    height: 100px
    width: auto
    right: 10px
    animation: dinoKey 3s infinite
    cursor: pointer
    z-index: 2

  .top
    height: 50%

  .nwc
    font-size: 20px
    margin: 0
    padding-top: 6px
    text-decoration: none

  .nwe
    margin: 0
    line-height: 22px
    font-size: 12px

  .lottery-animation, .lottery-result
    position: absolute
    top: 0
    left: 0
    bottom: 0
    right: 0
    text-align: center
    background-color: rgba(0, 0, 0, 0.9)
    .top
      height: 50%
    .egg-pic
      margin-top: -290px

  .result-bg
    animation: resultBg 3s linear infinite

  .mid
    position: relative
    width: 500px
    height: 500px
    margin: -300px auto 0 auto
    .result-bg
      position: absolute
      top: 0
      left: 0
      width: 500px
      height: 500px
    .result-pic
      position: absolute
      top: 100px
      left: 100px
      width: 300px

  .result-leave
    animation: hideKey 0.5s

  @keyframes useCircle
    0%
      border: solid rgba(255, 255, 255, 0.6) 1px
    50%
      border: solid rgba(255, 255, 255, 0.2) 1px
    100%
      border: solid rgba(255, 255, 255, 0.6) 1px

  @keyframes resultBg
    0%
      transform: rotate(0) scale(1)
      opacity: 1
    50%
      transform: rotate(180deg) scale(0.8)
      opacity: 0.5
    100%
      transform: rotate(360deg) scale(1)
      opacity: 1

  @keyframes hideKey
    from
      transform: scale(1)
      opacity: 1
    to
      transform: scale(0)
      opacity: 0

  @keyframes dinoKey
    0%
      transform: translateY(0)
    50%
      transform: translateY(-10%)
    100%
      transform: translateY(0)

</style>
