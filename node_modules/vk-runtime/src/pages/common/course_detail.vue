<template lang="jade">
  .course-detail(v-show="isThisLayerShow")
    .black-mirror(v-show="isThisLayerShow", @click="closeThisLayer")
    .toast-con(v-if="isMaskShow")
      .black-mask(v-if="isMaskShow")
      transition(enter-active-class="animated bounceIn", leave-active-class="animated bounceOut")
        .toast(src="../../../../img/common/toast_x2.png", v-if="isToastShow")
          | 啊哦，教室创建失败，<br>建议联系约课老师重新安排哦
    .course-detail-box
      .close-btn(@click="closeThisLayer")
      template(v-if="planetNumProp_ == courseTypeConst.OTHERCOURSE || planetNumProp_ == courseTypeConst.OPENCOURSE")
        .course-detail-box-title {{courseDetailDataProp.detailTitle}}
      template(v-else)
        .course-detail-box-title {{courseDetailDataProp.lessonNumber}} - {{courseDetailDataProp.detailTitle}}
      .white-board
        .course-info-hd
          img(v-if="courseDetailDataProp.detailAvatar", :src="courseDetailDataProp.detailAvatar")
          img(v-else, src="../../img/user-imag@2x.png")
          .course-info-content
            p.course-time {{lessonDate}}
            p.course-teacher {{courseDetailDataProp.detailName}}
          .course-info-btn-wrap
            template(v-for="item in courseDetailDataProp.detailButtonList")
              .course-info-btn.mar-r.grey(v-if="item.buttonStatus === 'GRAY'") {{item.buttonText}}
              .course-info-btn.mar-r.grey-alert(v-else-if="item.buttonStatus === 'GRAY_ALERT'", @click.stop="popAlert(item.buttonExtra.alertText)") {{item.buttonText}}
              .course-info-btn.mar-r.normal(v-else-if="['READ_BOOK'].indexOf(item.buttonFunction) > -1", @click="goBookDetail(item.buttonExtra.bookId, item.buttonExtra.bookCode)") {{item.buttonText}}
              .course-info-btn.mar-r.normal(v-else, @click.stop="courseButtonHandler(item)") {{item.buttonText}}
        .course-desc-holder
          .course-info-pin.pin1
          .course-info-pin.pin2
          .course-info-pin.pin3
          .course-info-pin.pin4
          .course-desc-container
            .course-desc-container-scroll-border
              .course-desc-label 我的成就 My Achievement
              .course-state-wrap
                template(v-for="item in courseDetailDataProp.detailAchievementList")
                  .ketang-achieve(v-if="item.achievementType == 'STAR'")
                    span.ketang-achi-label 课堂成就
                    .course-state-star(:class="'star-' + item.star")
                  .pre-score(v-if="item.achievementType == 'COLORTEXT'")
                    span.label {{ item.title }}
                    span.score {{ item.status == 1 ? item.colorText : '--' }}
                  .yuxi-achieve(v-if="item.achievementType == 'HOMEWORK'")
                    span.yuxi-achi-label {{ item.title }}
                      template(v-if="item.status == 0")
                        .check-icon.right-grey
                        span -
                        .check-icon.mar-l.wrong-grey
                        span -
                      template(v-else)
                        .check-icon.right
                        span {{ item.homeworkRight }}
                        .check-icon.mar-l.wrong
                        span {{ item.homeworkWrong }}

              .course-desc-label 课程介绍 Course Introduction
              .course-intro-wrap
                template(v-for="item in courseDetailDataProp.detailIntroductionList")
                  .course-intro-label(v-if="item.title && item.content != 'N/A'") {{item.title}}
                  .course-intro-detail(v-show="item.content && item.content != 'N/A'", v-html="item.content")
</template>

<script>
  import axios from 'axios'
  import cookies from 'cookies-js'
  import utils from '../../utils/_untils.js'
  import Course from '../common/course/Course.js'

  export default {
    data() {
      return {
        isMaskShow: false,
        isToastShow: false,
        isThisLayerShow: this.isCourseDetailShow,
        lessonDate: '',
        planetNumProp_: this.planetNumProp,
        courseTypeConst: {
          MAJOR: 'major',
          OPENCOURSE: 1,
          TOEFL: 2,
          WINTERCAMP: 3,
          SUMMERCAMP: 4,
          OTHERCOURSE: 5,
          PHONICS: 6,
          PRONUNCIATION: 7,
          VOV: 8,
          FREETALK: 9
        }
      }
    },
    props: ['isCourseDetailShow', 'courseDetailDataProp', 'planetNumProp'],
    components: {},
    mounted() {
    },
    watch: {
      isCourseDetailShow(curVal, oldVal) {
        this.isThisLayerShow = curVal
        this.lessonDate = utils.formatDate(this.courseDetailDataProp.detailTime)
      }
    },
    methods: {
      courseButtonHandler(buttonData) {
        Course.courseButtonClick({
          type: buttonData.buttonFunction,
          clickId: buttonData.clickId + '_path_detail',
          buttonExtra: buttonData.buttonExtra,
          onlineClassId: this.courseDetailDataProp.onlineClassId,
          lessonId: this.courseDetailDataProp.lessonId,
          courseId: this.courseDetailDataProp.courseId, 
          curriculumVersion: this.courseDetailDataProp.curriculumVersion,
          lessonNum: this.courseDetailDataProp.lessonNumber.match(/\d+/g)[0],
          bookType: this.courseDetailDataProp.bookType
        })
      },
      goBookDetail(bookId, bookCode) {
        this.$router.push({path: `/dgl/digitalLibrary/detail/${bookId}/${bookCode}`})
      },
      doNothing() {
        return
      },
      // gray_alert 按钮弹出提示方法
      popAlert(alertText) {
        this.$showToast(alertText)
      },
      closeThisLayer() {
        this.isThisLayerShow = false
        this.$emit("courseDetailLayerTriger")
      }
    }
  }
</script>

<style lang="stylus" scoped>
  BUTTON_COLLECTION_WIDTH = 400px
  .toast-con
    width: 100%
    height: 100%
    position: fixed
    top: 0
    left: 0
    z-index: 222
    .black-mask
      width: 100%
      height: 100%
      position: absolute
      top: 0
      left: 0
      background-color: rgba(0, 0, 0, 0.6)
    .toast
      position: absolute
      top: 50%
      left: 50%
      width: 322px
      height: 110px
      margin-top: -76px
      margin-left: -185px
      background-image: url('../../img/common/toast_x2.png')
      background-size: contain
      background-repeat: no-repeat
      padding: 29px 0 0 83px
      color: #666
      font-size: 16px
      text-align: center
      box-sizing: border-box

  .course-detail
    position: fixed
    top: 0
    left: 0
    right: 0
    bottom: 0
    z-index: 22
    .black-mirror
      position: fixed
      top: 0
      bottom: 0
      left: 0
      right: 0
      z-index: 20
      width: 100%
      height: 100%
      background-color: rgba(0, 0, 0, 0.7)
    .course-detail-box
      position: absolute
      z-index: 22
      top: 50%
      left: 50%
      margin-top: -255px
      margin-left: -405px
      display: inline-block
      width: 810px
      height: 550px
      box-sizing: border-box
      background-color: #a18ee3
      border-radius: 18px
      box-shadow: 3px 2px 14px 0 #36185c
      text-align: center
      .close-btn
        position: absolute
        top: -10px
        right: -10px
        display: inline-block
        width: 40px
        height: 40px
        background-image: url("../../img/summercamp_button_collection.png")
        background-repeat: no-repeat
        background-position: -80px -220px
        background-size: BUTTON_COLLECTION_WIDTH
        cursor: pointer
        &:hover
          background-position: 0 -220px
        &:active
          background-position: -40px -220px

      .course-detail-box-title
        width: 93%
        height: 25px
        line-height: 25px
        margin: 17px auto 16px auto
        text-align: center
        font-size: 20px
        color: #ffffff
        overflow: hidden
        white-space: nowrap
        text-overflow: ellipsis
      .white-board
        width: 780px
        height: 480px
        border-radius: 18px
        background-color: #ffffff
        display: inline-block
        text-align: left
        .course-info-hd
          margin: 15px auto 18px auto
          width: 734px
          height: 111px
          img
            position: absolute
            top: 86px
            left: 40px
            width: 90px
            height: 90px
            display: inline-block
            vertical-align: middle
            border-radius: 50%
          .course-info-content
            display: inline-block
            vertical-align: middle
            width: 426px
            height: 75px
            color: #555555
            font-size: 18px
            margin-left: 10px
            overflow: hidden
            position: absolute
            top: 65px
            left: 144px
            p.course-time
              margin-top: 20px
            p.course-teacher
              margin-top: 5px
          .course-info-btn-wrap
            display: inline-block
            vertical-align: middle
            width: 640px
            position: absolute
            top: 150px
            left: 151px
            .course-info-btn
              display: inline-block
              color: #fff
              vertical-align: middle
              width: 100px
              height: 34px
              background-image: url("../../img/summercamp_button_collection.png")
              background-size: BUTTON_COLLECTION_WIDTH
              background-repeat: no-repeat
              cursor: pointer
              text-align: center
              line-height: 34px
              font-size: 16px
              text-decoration: none
              &.mar-r
                margin-right: 8px
              &.normal
                background-position: -104px -485px
                &:hover
                  background-position: -208px -485px
                &:active
                  background-position: 0 -485px
              &.grey
                background-position: 0px -520px
                cursor: not-allowed
              &.grey-alert
                background-position: 0px -520px
                cursor: default
        .course-desc-holder
          position: relative
          width: 734px
          height: 313px
          border-radius: 20px
          background-color: #ece7ff
          box-shadow: 3px 3px 0 0 #e0dcf0, 0 -3px 0 0 #f4f1ff
          text-align: left
          margin: 0 auto
          .course-desc-container
            box-sizing: border-box;
            padding: 19px 6px 19px 15px
            width: 100%
            height: 100%
            .course-desc-container-scroll-border
              overflow-y: scroll
              overflow-x: hidden;
              width: 100%
              height: 100%
              &::-webkit-scrollbar
                width: 5px
              &::-webkit-scrollbar-thumb
                border-radius: 999px;
                background: rgba(0, 0, 0, 0.2);
          .course-info-pin
            position: absolute
            width: 10px
            height: 10px
            background-image: url("../../img/summercamp_button_collection.png")
            background-size: BUTTON_COLLECTION_WIDTH
            background-repeat: no-repeat
            background-position: 0 -470px
            &.pin1
              top: 5px
              left: 8px
            &.pin2
              top: 7px
              right: 5px
            &.pin3
              bottom: 7px
              left: 8px
            &.pin4
              bottom: 7px
              right: 5px
          .course-desc-label
            width: 704px
            height: 44px
            line-height: 44px
            border-radius: 21px
            background-color: #dad0ff
            box-shadow: 1px 2px 0 0 #e5deff
            box-sizing: border-box
            padding: 0 0 0 10px
            font-size: 18px
            color: #555
            margin: 5px auto 0 auto;
          .course-state-wrap
            width: 644px
            margin: 16px auto 26px auto
            white-space: nowrap
            .pre-score
              display: inline-block
              vertical-align: middle
              color: #555
              height: 24px
              margin-right: 103px
              line-height: 24px
              .label
                margin-right: 8px
              .score
                color: #FAA215
            .after-score
              display: inline-block
              vertical-align: middle
              color: #555
              height: 24px
              margin-right: 40px
              margin-left: 51px
              line-height: 24px
              .label
                margin-right: 8px
              .score
                color: #FAA215
            .yuxi-achieve
              display: inline-block
              vertical-align: middle
              color: #555555
              height: 24px
              line-height: 24px
              margin-right: 40px
              .yuxi-achi-label
                margin-right: 10px
              span
                display: inline-block
                vertical-align: middle
                height: 24px
                line-height: 24px
              .check-icon
                display: inline-block
                vertical-align: middle
                width: 23px
                height: 22px
                background-image: url("../../img/summercamp_button_collection.png")
                background-size: BUTTON_COLLECTION_WIDTH
                background-repeat: no-repeat
                margin-right: 4px
                margin-left: 10px
                &.mar-l
                  margin-left: 15px
                &.right
                  background-position: -27px -439px
                &.wrong
                  background-position: -21px -417px
                &.right-grey
                  background-position: 0px -439px
                &.wrong-grey
                  background-position: 0px -417px
            .ketang-achieve
              display: inline-block
              vertical-align: middle
              color: #555555
              height: 24px
              margin-right: 40px
              line-height: 24px
              .ketang-achi-label
                margin-right: 12px
              span
                display: inline-block
                vertical-align: middle
                height: 24px
                line-height: 24px
              .course-state-star
                display: inline-block
                vertical-align: middle
                width: 132px
                height: 21px
                background-image: url("../../img/card_collection.png")
                background-size: 549px
                background-repeat: no-repeat
                &.star-5
                  background-position: 0 -261px
                &.star-4
                  background-position: 0 -283px
                &.star-3
                  background-position: 0 -305px
                &.star-2
                  background-position: 0 -328px
                &.star-1
                  background-position: 0 -350px
                &.star-0
                  background-position: 0 -372px
            .zuoye-achieve
              display: inline-block
              vertical-align: middle
              color: #555555
              height: 24px
              line-height: 24px
              span
                display: inline-block
                vertical-align: middle
                height: 24px
                line-height: 24px
              .check-icon
                display: inline-block
                vertical-align: middle
                width: 23px
                height: 22px
                background-image: url("../../img/summercamp_button_collection.png")
                background-size: BUTTON_COLLECTION_WIDTH
                background-repeat: no-repeat
                margin-left: 10px
                margin-right: 5px
                &.right
                  background-position: -27px -439px
                &.wrong
                  background-position: -21px -417px
                &.right-grey
                  background-position: 0px -439px
                &.wrong-grey
                  background-position: 0px -417px
          .course-intro-wrap
            width: 661px
            margin: 15px auto 0 auto
            .course-intro-label
              display: inline-block
              padding: 0 19px;
              height: 24px
              line-height: 24px
              text-align: center
              font-size: 14px
              border-radius: 99px
              background-color: #f2eeff
              color: #555555
            .course-intro-detail
              font-size: 14px
              color: #777777
              line-height: 1.5em
              padding: 10px 0 15px 12px
</style>
