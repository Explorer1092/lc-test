/**
 * Created by lihongbin on 2017/8/7.
 */
import '../../../lib/soundjs-0.6.2.min'
export default {
  install (Vue, options) {
    let isLoaded = false
    let isPlayed = true

    function loadHandler(event) {
      isLoaded = true
    }

    createjs.Sound.alternateExtensions = ["mp3", "wav"]
    createjs.Sound.on("fileload", loadHandler, this)
    for (var i = 0; i < options.length; i++) {
      createjs.Sound.registerSound(options[i].path, options[i].name)
    }
    //动态添加注册声音文件
    Vue.prototype.$soundPush = (options) => {
      try {
        for (var i = 0; i < options.length; i++) {
          createjs.Sound.registerSound(options[i].path, options[i].name)
        }
      } catch (err) {
        //eslint-disable-next-line no-console
      }
    }
    Vue.prototype.$playSound = (key) => {
      try {
        if (isLoaded && isPlayed) {
          isPlayed = false
          var instance = createjs.Sound.play(key) // 发挥使用ID。也可以使用完整的源路径或event.src。
          instance.on("complete", () => {
            isPlayed = true
          }, this)
          instance.volume = 0.5
        }
      } catch (err) {
        //eslint-disable-next-line no-console
        console.log(err)

      }
    }
  }
}
