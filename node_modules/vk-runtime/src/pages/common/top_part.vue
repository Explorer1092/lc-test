<template lang="jade">
  .header
    //up-to-top 是为了有回退按钮的时候让其处于最上部，以避免ipad下载作业的时候卡死，不能回退
    .back-btn(:class="[{'up-to-top': isOnIpadApp}, backBtnClass]", :style="isOnIpadApp?{top:'18px',left:'18px'}:''", @click="goBack()")
    .title_hd(:class="{absolute_fix: isAbsoluteFix}", v-show="ifShow")
      h1.theme-title.theme-title-ch {{title_cn}}
      h1.theme-title.theme-title-en {{title_eng}}
</template>
<script>
  import cookies from 'cookies-js'
  export default {
    data() {
      return {
        isOnIpadApp: false,
        backBtnClass: 'goback'
      }
    },
    props: {
      title_eng: {
        default: "",
        type: String
      },
      title_cn: {
        default: "",
        type: String
      },
      gobackurl: {
        default: "",
        type: String
      },
      isAbsoluteFix: {
        default: false,
        type: Boolean
      },
      mark: {
        default: "",
        type: String
      },
      ifShow: {
        default: true,
        type: Boolean
      }
    },
    mounted() {
      this.isOnIpadApp = (cookies.get('isFromApp') === '1')
      if (this.gobackurl == '/') {
        this.backBtnClass = 'gohome'
      }
    },
    methods: {
      goBack() {
        this.$playSound("click")
        if (this.mark) {
          sa.track('learning_click', {'click_id': 'pc_learning_digital_' + this.mark + '_return'})
        }
        if (this.isOnIpadApp) {
          if(history.state && this.gobackurl != '/'){
            history.go(-1)
          }else{
            this.loadURL('vkappbridge://history/back')
          }
          return
        }
        if(this.gobackurl){
          if(this.gobackurl.indexOf('http')>-1 || this.gobackurl.indexOf('https')>-1){
            window.location.href = this.gobackurl
            return
          } else {
            if(this.gobackurl.indexOf('//') > -1){
              window.location.href = document.location.protocol + this.gobackurl
              return
            } else {
              this.$router.push(this.gobackurl)
              return
            }
          }
        }
        history.go(-1)
      },
      loadURL(url) {
        var iFrame
        iFrame = document.createElement("iframe")
        iFrame.setAttribute("src", url)
        iFrame.setAttribute("style", "display:none;")
        document.body.appendChild(iFrame)
        //把它从dom上移除掉
        iFrame.parentNode.removeChild(iFrame)
        iFrame = null
      }
    }
  }
</script>
<style lang="stylus" scoped>
  button_collection_width = 400px
  .header
    font-size: 10px
    .back-btn
      width: 58px
      height: 58px
      position: fixed
      top: 20px
      left: 40px
      cursor: pointer
      z-index: 9
      &.goback
        background: url("../../img/summercamp_button_collection.png") no-repeat;
        background-position: -116px -108px
        background-size: button_collection_width
        &:hover
          background-position: -58px -108px
        &:active
          background-position: -174px -108px
        &.up-to-top
          z-index: 999
      &.gohome
        background: url("../../img/common/home@2x.png") no-repeat;
        background-size: 100%
        &:hover
          opacity: 0.8
        &.up-to-top
          z-index: 999
    .title_hd
      position: fixed
      top: 18px
      left: 0
      right: 0
      z-index: 8
      -webkit-font-smoothing: antialiased
      &.absolute_fix
        position: absolute
    .theme-title
      margin: 0
      text-align: center
      color: #fff
      margin-bottom: 5px
    .theme-title-ch
      font-size: 36px
    .theme-title-en
      font-size: 24px
      letter-spacing: 0.1em
      font-weight: 300
</style>
