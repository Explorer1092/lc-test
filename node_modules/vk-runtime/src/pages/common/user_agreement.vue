<template lang="jade">
  .user-agreement(v-if="ifShow")
    .mirror
    .main-box
      .title VIPKID更新后的用户协议和隐私政策
      .white-box
        .content 
          | 感谢您下载VIPKID英语，使用我们的服务。为了更好的为您提供服务，请您仔细阅读更新后的
          strong(@click="show(1)") 《VIPKID用户注册协议》
          | 和
          strong(@click="show(2)") 《VIPKID隐私政策》
          | 。如在阅读中有任何疑问、意见或者建议，您可以通过VIPKID网站（www.vipkid.com.cn）首页的客服热线或者在线咨询与我们联系。
        .for 为了给您提供完善的服务，提升您的用户体验，我们将无法避免地收集和使用您的个人信息，我们将遵循合法正当必要的原则，最小化地收集和使用您的个人信息并采取必要的安保措施。
        .orange(v-if="ifShowWarningText") 您同意后，我们将继续提供完善优质的服务。
        .btn.no(@click="no")
        .btn.yes(@click="yes")
    .sub-layer(v-if="isSignUpAgreementShow")
      img.close-btn(@click="close", src="../../img/common/closed.png")
      .sub-white-box
        iframe(src="//mobile.vipkid.com.cn/parents/registeredlogin/signupagreement/")
    .sub-layer(v-if="isPrivacyAgreementShow")
      img.close-btn(@click="close", src="../../img/common/closed.png")
      .sub-white-box
        iframe(src="//mobile.vipkid.com.cn/parents/registeredlogin/privacyagreement/")

</template>
<style lang="stylus" scoped>
.user-agreement
  position: fixed
  top: 0
  left: 0
  right: 0
  bottom: 0
  z-index: 999
  top: 0
  left: 0
  .mirror
    position: relative
    z-index: 999
    width: 100%
    height: 100%
    background-color: rgba(0, 0, 0, 0.7)
  .main-box
    position: absolute
    top: 50%
    left: 50%
    z-index: 999
    margin: -310px 0 0 -282px
    box-sizing: border-box
    width: 620px
    height: 563px
    background-color: #a18ee3
    border-radius: 20px
    .title
      color: #fff
      font-size: 24px
      text-align: center
      width: 100%
      margin-top: 17px
    .white-box
      position: absolute
      bottom: 15px
      left: 15px
      z-index: 9999
      width: 590px
      height: 483px
      background-color: #fff
      border-radius: 20px
      box-shadow: 0 0 3px 5px #9987d6
      padding: 42px 45px 0 45px
      box-sizing: border-box
      text-align: justify
      font-size: 18px
      color: #777777
      line-height: 1.7em
strong
  color: #F85415
  text-decoration: underline
  cursor: pointer
  &:hover
    opacity: 0.8
.for
  margin-top: 20px
.orange
  margin-top: 20px
  color: #F85415
.btn
  width: 140px
  height: 40px
  background-repeat: no-repeat
  background-size: 100%
  cursor: pointer
  position: absolute
  &:hover
   opacity: 0.9
  &.no
    background-image: url('../../img/index/user_agreement_no.png')
    left: 125px
    bottom: 34px
  &.yes
    background-image: url('../../img/index/user_agreement_yes.png')
    right: 125px
    bottom: 34px
.sub-layer
  position: absolute
  top: 50%
  left: 50%
  z-index: 999
  margin: -330px 0 0 -410px
  box-sizing: border-box
  width: 820px
  height: 663px
  background-color: #a18ee3
  border-radius: 20px
.sub-white-box
  position: absolute
  bottom: 15px
  left: 15px
  z-index: 9999
  width: 790px
  height: 630px
  background-color: #fff
  border-radius: 20px
  box-shadow: 0 0 3px 5px #9987d6
  padding: 30px
  box-sizing: border-box
iframe
  width: 740px
  height: 569px
  border: 1px solid #e4e4e4
.close-btn
  width: 40px
  height: 40px
  position: absolute
  top: -15px
  right: -15px
  cursor: pointer
  &:hover
    opacity: 0.8
</style>

<script>
import axios from 'axios'
import cookies from 'cookies-js'
import formurlencoded from 'form-urlencoded'
import dragonUtils from '../../utils/_dragon.js'

export default{
  data(){
    return {
      ifShow: false,
      ifShowWarningText: false,
      isSignUpAgreementShow: false,
      isPrivacyAgreementShow: false
    }
  },
  mounted() {
    if (dragonUtils.isOnDragonClient()) {
      axios.get('/rest/learninggw/api/pc/studentBehavior/getStudentBasicRulesRecord', {
        params: {
          parentId: cookies.get('parentId')
        }
      }).then((res) => {
        if (res.data.code == 200) {
          if (res.data.data.agree === false) {
            this.ifShow = true
          }
        }
      })
    }
  },
  methods: {
    close() {
      this.isSignUpAgreementShow = false
      this.isPrivacyAgreementShow = false
    },
    show(type) {
      if (type == 1) {
        this.isSignUpAgreementShow = true
        this.isPrivacyAgreementShow = false
      } else if (type == 2) {
        this.isPrivacyAgreementShow = true
        this.isSignUpAgreementShow = false
      }
    },
    no() {
      sa.track('learning_click', {'click_id': 'pc_learning_user_agreement_choose_disagree'})
      this.ifShowWarningText = true
    },
    yes() {
      sa.track('learning_click', {'click_id': 'pc_learning_user_agreement_choose_agree'})
      let dragonClientUA = navigator.userAgent.match(/vipkid\/\d+(\.\d+)*/i)
      axios.post('/rest/learninggw/api/pc/studentBehavior/setStudentBasicRulesRecordAgree', formurlencoded({
        parentId: cookies.get('parentId'),
        studentId: cookies.get('studentId'),
        deviceVersion: dragonClientUA ? dragonClientUA[0].split('/')[1] : '0'
      })).then((res) => {
        if (res.data.code == 200) {
          if (res.data.data.agree === true) {
            this.ifShow = false
          }
        } else {
          this.ifShow = false
        }
      })
        .catch((err) => {
          this.ifShow = false
        })

    }
  }
}
</script>
