<template lang="jade">
    .project_page_wrapper
        top-part(:title_cn="titleCh", :title_eng="titleEn")
        .card_container(v-if="!!buttonList")
            template(v-for="item in buttonList")
                .card
                    .button_area
                        img.button_item(:src="item.image", @click="goToPage(item.routeUrl, item.clickId, item.lockMessage)") 
                    p {{item.name}}
</template>

<script>
    import TopPart from '../common/top_part.vue'
    import dragonUtils from "../../utils/_dragon"
    import cookies from 'cookies-js'
    import axios from 'axios'
    export default {
      data() {
        return {
          isIpadApp: !!cookies.get('isFromApp'),
          isPcApp: dragonUtils.isOnDragonClient(),
          titleCh: '',
          titleEn: 'Project Homework',
          buttonList: []
        }
      },
      props:[],
      components: {
        TopPart
      },
      mounted() {
        // 调用获取按钮函数
        this.getButtons()
      },
      methods: {
        // 获取按钮函数
        getButtons() {
          let url = "/rest/learninggw/api/pc/path/minor/getPDHomeworkList"
          let param = {
            studentId: cookies.get("studentId"),
            courseId: this.$route.params.courseId,
            lessonId: this.$route.params.lessonId,
            // 0为PC 1为PC-APP 2为IPAD
            source: this.isIpadApp ? 2 : (this.isPcApp ? 1 : 0)
          }
                
          axios.get(url, {
            params: param
          }).then((res) => {
            let data = res.data.data
            if(res.data.code != 200) {
              alert("网络有点问题，检查一下网络连接吧")
              return
            }
            // 获取标题
            this.titleCh = data.title
            if (data.subTitle && data.subTitle != "N/A") {
              this.titleEn = data.subTitle
            }
            // 获取按钮数据
            this.buttonList = data.buttons
          })
        },
        // 跳转至相应页
        goToPage(url, clickId, message) {
          // 神策打点
          sa.track('learning_click', {'click_id': clickId})
          // 点击音效
          this.$playSound("click")
          // 有提示的话弹出提示，没有的话跳转
          if (!!message) {
            this.$showToast(message)
          } else {
            this.$router.push(url)  
          }
        }
      }
    }
</script>

<style lang="stylus" scoped>
    .project_page_wrapper
        width: 100%
        background-image: url("../../img/project/project_main_bg_@2x.png")
        background-size: cover
        background-position: bottom center
        .card_container
            position: absolute
            width: 100%
            height: 251px
            top: 0
            bottom: 0
            margin: auto
            text-align: center
            .card
                width: 200px
                height: 251px
                display: inline-block
                margin: auto 80px
                .button_area 
                    height: 200px
                    position: relative
                    background-image: url("../../img/project/project_main_button_bg.png")
                    background-size: cover
                    cursor: pointer
                    .button_item
                        background-size: cover
                        width: 100px
                        height: 100px
                        top: 50px
                        left: 50px
                        position: absolute
                p 
                    margin-top: 21px
                    height: 30px
                    font-size:22px
                    font-weight: 400
                    color: rgba(255,255,255,1)
                    text-align: center
</style>