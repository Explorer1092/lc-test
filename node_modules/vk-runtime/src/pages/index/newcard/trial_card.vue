<template lang="jade">
  .trial-card
    .trial-card-light(v-if="config.isBlink")
      //进教室挂宠物
    img.pet-img(v-if="config.isBlink",:src='petImgSrc')
    .header
      slide-text.lesson(:text="config.typeTitle")
      slide-text.lesson-name(:text="config.mainTitle")
      .date
        span.week {{weekTime()}}
        span.time {{dateTime()}}
      .hand(ref="hand")
        .h-black
        .h-line(ref="handLine")
        .h-circle.icon-hand-circle(ref="cardHand",@click="handClick",@mouseenter="handHover")
    .live-course(:style="{backgroundColor: currentPanelState=='face'?'#ffffff':'#7fd16f'}")
      transition-group(enter-active-class="animated fadeInDown")
        //正面
        .front-face(key="1",v-if="currentPanelState=='face'")
          .mid
            //课前预习视频
            template(v-if="config.cardStyle=='pre_video'")
              img.pre-video-img(:src="config.imageInfo.imageUrl")
            //进教室
            classroom(v-if="config.cardStyle=='classroom'",:classInfo="config.classInfo")
            //flash card
            template(v-if="config.cardStyle=='flash_card'")
              template(v-if="config.homeworkInfo")
                flash-card(:cardConfig="config.homeworkInfo")
              template(v-else)
                flash-card
            //做作业
            template(v-if="config.cardStyle=='homework'")
              template(v-if="config.homeworkInfo")
                homework(:cardConfig="config.homeworkInfo")
              template(v-else)
                homework
          //卡片核心按钮
          vk-btn.star-btn(:type="classBtn",:text="config.bottomButton.buttonText",:clickFun="buttonClick",:alertText="alertText")
          .progress
            vk-progress(:pps="pps")
        //背面
        .back-face(key="2",v-if="currentPanelState=='back'")
          back-card(:config="config")
</template>
<script>
  import slideText from '../../common/vk_slide_text.vue'
  import util from '../../../utils/_untils'
  import vkBtn from '../../common/vk_button.vue'
  import vkProgress from '../components/progress.vue'
  import flashCard from './flash_card.vue'
  import homework from './homework.vue'
  import classroom from './classroom.vue'
  import Velocity from 'velocity-animate'
  import backCard from './back_card.vue'
  import {BUTTON_STYLE_MAP, SMALL_BUTTON_STYLE_MAP} from '../../common/course/courseEnum'
  import Course from "../../common/course/Course"
  import trialDialog from '../../common/vk_dialog_trial.vue'

  export default {
    data: function () {
      return {
        noTeacherImg: require("../../../img/index/teacher_bg.png"),
        isHandAnimationIng: false,
        currentPanelState: "face", //face,back
        //完成状态
        workStatus: {
          undone: 0,//未完成
          done: 1//已经完成
        },
        //底部进度条的状态
        lineStyleMap: {
          "DONTS": "disable",
          "BEDONE": "use",
          "DONE": "used"
        },
        alertText:''
      }
    },
    props: [
      'config', 'petImgSrc'
    ],
    components: {
      slideText, vkBtn, vkProgress, flashCard, homework, classroom, backCard
    },
    computed: {
      //按钮状态
      classBtn: function () {
        if(
          this.config.bottomButton.buttonExtra && 
          this.config.bottomButton.buttonExtra.alertText
        ){
          this.alertText = this.config.bottomButton.buttonExtra.alertText
        }
        //大按钮隐藏：lg-hide ，大按钮可用： lg-enable
        return BUTTON_STYLE_MAP[this.config.bottomButton.buttonStatus]
      },
      //录播课按钮状态
      videoBtn: function () {
        //小按钮隐藏：sl-hide ，小按钮可用： sl-enable
        return SMALL_BUTTON_STYLE_MAP[this.config.aiCourseCard.bottomButton.buttonStatus]
      },
      //底部进度状态
      pps: function () {
        /*
         "scheduleButtonList": [
         {
         "buttonStyle":"BEDONE",
         "buttonText":"预习"
         },
         {
         "buttonStyle":"BEDONE",
         "buttonText":"上课"
         },
         {
         "buttonStyle":"DONTS",
         "buttonText":"做作业"
         }
         ],
         ----------------------------------
         "buttonStyle"的取值有：
         "BEDONE", 进度按钮状态
         "HIDDEN", 隐藏
         "DONTS", 未解锁
         "BEDONE", 已解锁未完成
         "DONE", 已完成
         */
        //disable:灰色 use：可预习 used：预习完
        let result = []
        for (let sbl of this.config.scheduleButtonList) {
          result.push({
            name: sbl.buttonText,
            state: this.lineStyleMap[sbl.buttonStyle]
          })
        }
        return result
      },
      //录播课底部进度状态
      videoPps: function () {
        let result = []
        for (let sbl of this.config.aiCourseCard.scheduleButtonList) {
          result.push({
            name: sbl.buttonText,
            state: this.lineStyleMap[sbl.buttonStyle]
          })
        }
        return result
      }
    },
    methods: {
      buttonClick() {
        Course.courseButtonClick({
          cardType: this.config.cardType,
          type: this.config.bottomButton.buttonFunction,
          onlineClassId: this.config.onlineClassId,
          lessonNum: this.config.lessonNumber,
          lessonId: this.config.lessonId,
          clickId: this.config.bottomButton.clickid + "_front",
          courseId: this.config.courseId,
          curriculumVersion: this.config.curriculumVersion,
          bookType: this.config.bookType,
          buttonStatus: this.config.bottomButton.buttonStatus
        })
      },
      weekTime(){
        return util.weekTime(this.config.scheduledDateTime)
      },
      dateTime(){
        return util.dateTime(this.config.scheduledDateTime)
      },
      // 拉环点击
      handClick(){
        sa.track('learning_click', {
          'click_id': 'pc_learning_homepage_hand_pull'
        })
        if (!this.isHandAnimationIng) {
          this.isHandAnimationIng = true
          Velocity(this.$refs.cardHand, {top: "80px"}, {
            easing: "spring", mobileHA: false,
            duration: 500, complete: () => {
              if (this.currentPanelState == "back") {
                this.currentPanelState = "face"
              } else {
                this.currentPanelState = "back"
              }
              Velocity(this.$refs.cardHand, {top: "30px"}, {
                duration: 500, mobileHA: false,
                complete: () => {
                  this.isHandAnimationIng = false
                }
              })
            }
          })
          Velocity(this.$refs.handLine, {height: "80px"}, {
            easing: "spring",
            duration: 500, complete: () => {
              Velocity(this.$refs.handLine, {height: "30px"}, {
                duration: 500, mobileHA: false
              })
            }
          })
        }
        this.$playSound("click")
      },
      // hand hover state
      handHover(){
        if (this.$refs.hand.style.animation == "none" || this.$refs.hand.style.animation == "") {
          this.$refs.hand.style.animation = "swing 1.5s"
          setTimeout(() => {
            this.$refs.hand.style.animation = "none"
          }, 1500)
        }
      }
    }
  }
</script>

<style lang="stylus" scoped>
  .trial-card
    width: 300px
    height: 460px
    .live-course
      position: absolute
      width: 300px
      height: 330px
      top: 130px
      left: 0
      background: #fff
      overflow: hidden
      border-radius: 0 0 35px 35px
      transition: background-color 0.5s

  .trial-card-light
    position: absolute
    width: 360px
    height: 490px
    left: -30px
    animation: cardFade 1s infinite alternate
    background: url("../../../img/index/major_card_light.png") center no-repeat
    background-repeat: no-repeat
    background-size: 95% 96%

  // hand css
  .hand
    position: absolute
    width: 44px
    top: 115px
    right: 15px
    text-align: center
    z-index: 100
    .h-black
      height: 8px
      width: 8px
      margin: auto
      background-color: #421f66
      border-radius: 50%
      opacity: 0.6
    .h-line
      position: absolute
      width: 2px
      height: 30px
      margin: -4px 21px
      border-radius: 12px
      background-color: #FFFFFF
      box-shadow: 1px 1px 0 0 rgba(0, 0, 0, 0.3)
    .h-circle
      position: absolute
      height: 46px
      width: 44px
      z-index: 100
      cursor: pointer
      top: 33px

  // card's header css
  .header
    position: absolute
    z-index: 2
    width: 100%
    height: 175px
    background: url("../../../img/icon/icon_card.png") -10px -217px
    .lesson-name
      width: 230px
      height: 35px
      text-align: left
      line-height: 35px
      font-size: 18px
      font-weight: 500
      margin-top: 62px
      margin-left: 20px
      border-radius: 20px
      padding-left: 10px
    .date
      margin-top: 7px
      margin-left: 32px
      line-height: 30px
      .week
        font-size: 18px
        font-weight: 500
      .time
        font-size: 14px
        margin-left: 5px
    .video-name
      position: absolute
      right: 40px
      top: 105px
      width: 100px
      text-align: center
    .lesson
      position: absolute
      top: -30px
      left: 156px
      width: 90px
      height: 35px
      text-align: left
      line-height: 35px
      font-size: 18px
      font-weight: 500
      margin-top: 62px
      margin-left: 20px
      border-radius: 20px
      padding-left: 10px

  // front face css and back face of live course card
  .front-face, .back-face
    height: 330px
    .mid
      padding-top: 20px
      text-align: center
    .progress
      margin-top: 15px

  // pre video css
  .pre-video-img, .pre-video-img-disable
    height: 127px
    width: 180px
    border-radius: 20px
    border: solid #ff5c01 5px
    margin: 14px auto
    background: url("../../../img/index/pre_bg.png")
    background-size: 100%

  .pre-video-img-disable
    border: solid #d9d9d9 5px

  // homework css
  .work-img
    height: 120px
    width: 130px
    margin: 5px auto

  .work-img-enable
    background: url("../../../img/icon/icon_header.png") -309px -10px

  .work-img-disable
    background: url("../../../img/icon/icon_header.png") -10px -220px

  // pet css during enter classroom
  .pet-img
    width: 80px
    position: absolute
    bottom: 66px
    // right: 175px
    left: 231px
    z-index: 2
    animation: petMove 2s ease-in-out infinite
    animation-direction: alternate

  @keyframes petMove
    100%
      transform: translateY(20px)

  // record course css
  .record-course
    position: absolute
    height: 282px
    width: 180px
    right: 0
    top: 173px
    background-color: #fff
    border-radius: 0 0 36px 16px
    .video-img, .video-img-disable
      width: 120px
      height: 90px
      border: solid #fc6621 3px
      margin: 50px auto 20px 27px
      border-radius: 15px
      background: url("../../../img/index/pre_bg.png") no-repeat
      background-size: 100% 100%
    .video-img-disable
      border: solid #d9d9d9 3px
    .video-progress
      margin: 15px 0 0 -10px

  @keyframes cardFade
    from
      transform: scale(1.03, 1.03)
      opacity 1
    to
      opacity 0.5
      transform: scale(1, 1)

  @keyframes cardHover
    from
      transform: scale(1, 1)
    to
      transform: scale(1.1, 1.1)

</style>
