<template lang="jade">
  .student-info
    .student-inner.animated.fadeInDown
      .close-btn(@click.stop="close")
      .tab-1(@click.stop="tab0",:style="state==1?'z-index:-1;background-color:#7965bc;':'background-color:#a18ee3;'")
        .t1-text
          | 宝贝信息
      .tab-2(@click.stop="tab1",:style="state==0?'z-index:-1;background-color:#7965bc;':'background-color:#a18ee3;'")
        .t2-text
          | 英语等级
      .si-bg-user
        .user-bg(v-if="state==0")
          img.ding-zi(src="../../../img/project-pinSmall.png",style="top: 125px;left: 25px;height: 15px;")
          img.ding-zi(src="../../../img/project-pinSmall.png",style="top: 125px;right: 25px;height: 15px;")
          img.ding-zi(src="../../../img/project-pinSmall.png",style="top: 462px;left: 25px;height: 15px;")
          img.ding-zi(src="../../../img/project-pinSmall.png",style="top: 462px;right: 25px;height: 15px;")
          .user-actor
            img(src="../../../img/common/avatar/boy_1.png",v-if="!user.avatarUrl && (user.studentAvatar == 'default'|| !user.studentAvatar)")
            img(src="../../../img/common/avatar/boy_1.png",v-if="!user.avatarUrl && user.studentAvatar=='boy_1'")
            img(src="../../../img/common/avatar/boy_2.png",v-if="!user.avatarUrl && user.studentAvatar=='boy_2'")
            img(src="../../../img/common/avatar/boy_3.png",v-if="!user.avatarUrl && user.studentAvatar=='boy_3'")
            img(src="../../../img/common/avatar/boy_4.png",v-if="!user.avatarUrl && user.studentAvatar=='boy_4'")
            img(src="../../../img/common/avatar/girl_1.png",v-if="!user.avatarUrl && user.studentAvatar=='girl_1'")
            img(src="../../../img/common/avatar/girl_2.png",v-if="!user.avatarUrl && user.studentAvatar=='girl_2'")
            img(src="../../../img/common/avatar/girl_3.png",v-if="!user.avatarUrl && user.studentAvatar=='girl_3'")
            img(src="../../../img/common/avatar/girl_4.png",v-if="!user.avatarUrl && user.studentAvatar=='girl_4'")
            // 新增自定义头像
            img(:src="user.avatarUrl",v-if="user.avatarUrl")
          .line
          .ub-name-en
            | {{user.studentName}}
          .ub-name-cn
            | {{user.studentNameCn}}
          .ub-name-six
            .icon-boy.ub-icon(v-if="user.studentSex==1",style="left:365px")
            .icon-girl.ub-icon(v-if="user.studentSex==2",style="left:365px")
            | {{user.studentSex==1?'男孩':'女孩'}}
          .ub-name-birthday
            .icon-birthday.ub-icon(style="left:325px")
            | {{studentBirthday()}}
        .report-bg(v-if="state==1")
          img.ding-zi(src="../../../img/project-pinSmall.png",style="top: 10px;left: 10px;height: 20px;")
          img.ding-zi(src="../../../img/project-pinSmall.png",style="top: 10px;right: 10px;height: 20px;")
          img.ding-zi(src="../../../img/project-pinSmall.png",style="top: 480px;left: 10px;height: 20px;")
          img.ding-zi(src="../../../img/project-pinSmall.png",style="top: 480px;right: 10px;height: 20px;")
          .hava-data(v-if="!isTest")
            img.ding-zi(src="../../../img/project-pinSmall.png",style="top: 80px;left: 25px;height: 15px;")
            img.ding-zi(src="../../../img/project-pinSmall.png",style="top: 80px;right: 18px;height: 15px;")
            img.ding-zi(src="../../../img/project-pinSmall.png",style="top: 447px;left: 25px;height: 15px;")
            img.ding-zi(src="../../../img/project-pinSmall.png",style="top: 447px;right: 18px;height: 15px;")
            table
              thead
                th(style="width:560px;padding-left:15px")
                  | 测试报告
                th(style="width:160px;padding-right:30px")
                  | 测试日期
            .re-body
              table
                tbody
                  tr(v-for="(re,index) in result")
                    td.report(v-if="re.isNew==0",:style="index==0?'border-top: none;':''")
                      | {{re.examCommentDescParant}}
                    td.see-report(v-if="re.isNew==1",:style="index==0?'border-top: none;':''",@click.stop="goToReport(re.examUuid,re.onlineClassId)")
                      | 查看报告详情 >
                    td(:style="index==0?'border-right: none;border-top: none;width:100px;':'border-right: none;width:100px;'")
                      | {{re.endDatetime}}
          .no-data(v-if="isTest")
            img.test-dino(src="../../../img/index/test_dino.png")
            .test-text 快来测测宝贝的英语水平吧~
            test-btn.test-btn(type="lg-enable",text="测一测",:clickFun="startTest")
</template>
<script>
  import axios from 'axios'
  import cookie from 'cookies-js'
  import until from '../../../utils/_untils'
  import testBtn from '../../common/vk_button.vue'
  import cookies from "cookies-js"
  export default {
    data: function () {
      return {
        isTest: false,
        state: 0,
        result: []
      }
    },
    components: {testBtn},
    computed: {},
    mounted () {
    },
    props: ["close", "user"],
    methods: {
      startTest(){
        axios.get('/rest/learninggw/api/pc/homepage/getStudentCtStartExam', {
          params: {
            studentId: cookies.get("studentId")
          }
        }).then((res) => {
          if (res.data.code == 200 && res.data.data.ctEnable && res.data.data.ctUrl) {
            this.close()
            this.$router.push("/test_work")
          } else {
            this.$showToast("没有权限，请联系您的班主任老师，谢谢！")
          }
        }).catch((err) => {
          this.$showToast("没有权限，请联系您的班主任老师，谢谢！")
        })
      },
      studentBirthday(){
        return until.dateTime(this.user.studentBirthday)
      },
      goToReport(uuid, onlineClassId){
        if (!uuid || uuid == "") {
          uuid = 0
        }
        if (!onlineClassId || onlineClassId == "") {
          onlineClassId = 0
        }
        this.$router.push('/test_result/' + uuid + '/' + onlineClassId)
      },
      tab0(){
        this.state = 0
      },
      tab1(){
        this.state = 1
        this.getResult()
      },
      getResult(){
        axios.get('/rest/learninggw/api/pc/homepage/getStudentCtResultList', {
          params: {
            studentId: cookie.get("studentId")
          }
        }).then((res) => {
          const result = res.data.data
          if (result && result != null) {
            this.isTest = false
            for (var i = 0; i < result.length; i++) {
              if (result[i].endDatetime == 0) {
                result[i].endDatetime = "-"
              } else {
                result[i].endDatetime = until.timeFormatAll(result[i].endDatetime)
              }
            }
            this.result = result
          } else {
            this.isTest = true
          }
        })
      }
    }
  }
</script>

<style lang="stylus" scoped>
  .student-info
    position: fixed
    top: 0
    left: 0
    right: 0
    bottom: 0
    background-color: rgba(0, 0, 0, 0.8)
    z-index: 120
    text-align: center
    .close-btn
      position: absolute
      z-index: 10
      right: -15px
      top: -15px
      height: 40px
      width: 40px
      background-image: url("../../../img/common/close-btn-sprite.png")
      background-repeat: no-repeat
      background-position: 0 0
      background-size: 150px
      cursor: pointer
      &:hover
        background-position: -55px 0
      &:active
        background-position: -110px 0
    .tab-1
      position: absolute
      border-radius: 20px
      height: 180px
      width: 120px
      left: -60px
      top: 0
      cursor: pointer
      .t1-text
        width: 20px
        margin: 50px 20px
        color: #ffffff
    .tab-2
      position: absolute
      border-radius: 20px
      height: 180px
      width: 120px
      left: -60px
      top: 190px
      cursor: pointer
      .t2-text
        width: 20px
        margin: 50px 20px
        color: #ffffff
    .top
      height: 50%
      margin-bottom: -280px
    .student-inner
      position: relative
      width: 815px
      margin: auto
      border-radius: 20px
      background-color: rgb(161, 142, 227)
      box-shadow: 3px 2px 16px 0 rgb(55, 24, 92)
      padding: 20px
      top: 50%
      margin-top: -280px
      box-sizing: border-box
      .si-bg-user
        position: relative
        width: 776px
        height: 514px
        border-radius: 20px
        background-color: rgb(255, 255, 255)
        border: solid 5px rgba(0, 0, 0, 0.05)
        box-sizing: border-box
        .user-actor
          position: absolute
          left: 50%
          margin-left: -100px
          border: solid #ffffff 20px
          top: 10px
          width: 164px
          height: 164px
          background-color: #b396ff
          border-radius: 50%
          img
            height: 164px
            border-radius: 50%
        .user-bg
          width: 736px
          height: 372px
          margin: 115px 15px
          border-radius: 20px
          background-color: rgb(236, 231, 255)
          box-shadow: 3px 3px 0 0 rgb(224, 220, 240), 0 -3px 0 0 rgb(244, 241, 255)
          text-align: center
          .line
            width: 100%
            height: 120px
          .ub-name-en
            height: 52px
            font-size: 38px
            line-height: 1.37
            text-align: center
            color: rgb(51, 51, 51)
          .ub-name-cn
            height: 52px
            font-size: 26px
            line-height: 2.0
            text-align: center
            color: rgb(51, 51, 51)
          .ub-name-six
            height: 40px
            margin-top: 40px
            font-size: 22px
            line-height: 40px
            color: rgb(102, 102, 102)
          .ub-name-birthday
            height: 30px
            font-size: 22px
            line-height: 40px
            text-align: center
            color: rgb(102, 102, 102)

    .report-bg
      table
        width: 100%
        margin-top: 30px
      thead
        color: rgba(0, 0, 0, 0.5)
        th
          height: 30px
          text-align: center
      .re-body
        height: 396px
        width: 740px
        background-color: #e0dcf0
        margin: 10px 15px
        color: rgba(51, 51, 51, 0.75)
        border-radius: 10px
        box-shadow: 3px 3px 0 0 rgb(224, 220, 240), 0 -3px 0 0 rgb(244, 241, 255)
        overflow-y: auto
        padding: 15px
        box-sizing: border-box
        &::-webkit-scrollbar
          width: 8px
          height: 8px
          -webkit-border-radius: 4px
          -moz-border-radius: 4px
          border-radius: 4px
        &::-webkit-scrollbar-track
          background: rgba(0, 0, 0, 0)
        &::-webkit-scrollbar-thumb
          background: rgba(0, 0, 0, 0.1)
          border-radius: 4px
        td
          text-align: center
          font-size: 14px
          padding: 15px
          border: solid #cccccc 1px
        .see-report
          color: #8858a6
          cursor: pointer
          width: 410px
        .report
          text-align: left
          width: 410px
          line-height: 22px

    .ub-icon
      position: absolute
      margin-left: -27px
    .no-data
      .test-dino
        margin-top: 60px
      .test-text
        width: 100%
        height: 52px
        font-size: 28px
        text-align: center
        color: rgb(0, 0, 0, 0.75)
      .test-btn
        margin-top: 20px

    .ding-zi
      position: absolute

</style>
