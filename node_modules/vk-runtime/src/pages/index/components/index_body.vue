<template lang="jade">
  .learning-body(ref="learnIndex",onselectstart="return false",:style="{width:configCards.length*360+'px'}")
    //居中占位块
    .top
    .content(ref="learningContent")
      card(v-if="configCards.length==0&&isErrorCardShowConfig",:config="emptyCard")
      transition-group(tag="span",@enter="cardEnterAnimation",name="list",@beforeEnter="cardBeforeEnterAnimation",leaveActiveClass="animated zoomOut")
        template(v-for="(card,index) in configCards")
          .learn-c(:class="index%2==0?'learning-card-up':'learning-card-down'",:key="card.onlineClassId?card.onlineClassId:card.cardType",:data-index="index",:style="{left:card.left+'px'}")
            escalate-card(v-if="card.cardType === 102",:config="card",:petImgSrc = "petImgSrc")
            interact-card(v-else-if="card.cardType === 103",:config="card",:petImgSrc = "petImgSrc") 
            trial-card(v-else-if="card.cardType === 104",:config="card",:petImgSrc = "petImgSrc")
            esl-card(v-else-if="card.cardType === 101",:config="card",:petImgSrc = "petImgSrc")
            task-card(v-else-if="card.cardType === 201", :config="card", :petImgSrc = "petImgSrc" @dialogInfo="dialogInfo")
            card(v-else,:config="card",:petImgSrc = "petImgSrc")
    vk-dialog(v-if="task.showDialog"
      ,:mood="'happy'"
      ,:leftButtonText="'我再想想'"
      ,:rightButtonText="'接受邀请'"
      ,:title="'你的挑战任务'" 
      ,:contentText="task.contentText"
      ,@leftBtnEvent="task.leftBtnEvent"
      ,@rightBtnEvent="task.rightBtnEvent")
</template>
<script>
  import vkDialog from "../../common/vk_dialog_2.vue"
  import Velocity from 'velocity-animate'
  import card from '../card/cards.vue'
  import eslCard from '../newcard/esl_card.vue'
  import escalateCard from '../newcard/escalate_card.vue'
  import trialCard from '../newcard/trial_card.vue'
  import interactCard from '../newcard/interact_card.vue'
  import taskCard from '../newcard/task_card.vue'
  export default {
    data: function () {
      return {
        emptyCard: {
          "cardType": 100,
          "show": true,
          "infoText": "加载失败了",
          "scheduledDateTime": 95617615188732
        },
        task:{
          showDialog:false,
          contentText:'',
          leftBtnEvent:null,
          rightBtnEvent:null
        }
      }
    },
    props: [
      'configCards', 'isErrorCardShowConfig', 'petImgSrc'
    ],
    components: {
      card,
      eslCard,
      escalateCard,
      trialCard,
      interactCard,
      taskCard,
      vkDialog
    },
    methods: {
      //卡动画
      cardEnterAnimation(el){
        let delay = parseInt(el.dataset.index) * 150
        Velocity(el, {
          transform: "scale(1,1)",
          opacity: 1
        }, {
          easing: "spring",
          duration: 2000,
          delay: delay
        })
      },
      cardBeforeEnterAnimation(el){
        el.style.transform = "scale(0, 0)"
        el.style.opacity = 0
      },
      leaveBefore(){
        //销毁所有setinterval clearTimeout
        for (var i = 0; i < this.timeouts.length; i++) {
          clearTimeout(this.timeouts[i])
        }
        for (var i = 0; i < this.intervals.length; i++) {
          clearInterval(this.intervals[i])
        }
      },
      dialogInfo(info){
        Object.assign(this.task, info)
      }
    }
  }
</script>

<style lang="stylus" scoped>

  .top
    height: 50%
    width: 100%
    margin-bottom: -200px

  .content
    clear: both
    position: relative
    height: 500px
    margin-left: 40px

  .learn-c
    position: absolute
    display: inline-block
    vertical-align: top
    transition: all 0.5s
    &:hover
      transform: scale(1.1, 1.1)

  .learn-c-fixed
    position: fixed
    z-index: 2

  .learning-card-up
    animation cardUp 10s linear 1s infinite alternate

  .learning-card-down
    animation cardDown 10s linear 1s infinite alternate

  @keyframes cardUp
    0%
      transform: translate3d(0, 0, 0)
    25%
      transform: translate3d(0, 2%, 0)
    50%
      transform: translate3d(0, 0%, 0)
    75%
      transform: translate3d(0, -2%, 0)
    100%
      transform: translate3d(0, 0, 0)

  @keyframes cardDown
    0%
      transform: translate3d(0, 0, 0)
    25%
      transform: translate3d(0, -2%, 0)
    50%
      transform: translate3d(0, 0%, 0)
    75%
      transform: translate3d(0, 2%, 0)
    100%
      transform: translate3d(0, 0, 0)

  @keyframes bgMove
    from
      background-position: 0 0
    to
      background-position: 100% 0

  @keyframes scaleDiv
    from
      transform: scale(1, 1)
    to
      transform: scale(1.1, 1.1)

  .list-move
    transition: all 1s

  @media screen and (max-height: 768px)
    //高度小于768时  中心卡片变小
    .content
      transform: scale(0.85, 0.85)
      transform-origin: 0 0
</style>
