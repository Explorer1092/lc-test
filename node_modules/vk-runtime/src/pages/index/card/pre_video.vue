<template lang="jade">
  //课前视频的卡片
  .pre-content
    transition-group(enter-active-class="animated fadeInDown",)
      .panel-face(key="1",v-show="currentPanelState=='face'")
        //预习
        img.pre-video(v-if="[15].indexOf(config.cardType)>-1 && [2].indexOf(config.courseCardStatus)>-1", :src="config.afterHomeworkImg+'?imageView2/2/w/127/h/180'", @error="errorImg")
        img.pre-video(v-else, :src="config.preHomeworkImg+'?imageView2/2/w/127/h/180'", @error="errorImg")
        vk-btn.pre-btn(v-if="[15,17,18].indexOf(config.cardType)>-1 && [2].indexOf(config.courseCardStatus)>-1", 
        :type="'lg-'+backButtonState[config.afterHomeworkButton]", :text="config.afterHomeworkButtonText",
        :isNewTab="false",:clickFun="goHomework", clickId="homepage_btn_pre")
        vk-btn.pre-btn(v-else, :type="'lg-'+backButtonState[config.preHomeworkButton]", :text="config.preHomeworkButtonText",
        :isNewTab="false",:clickFun="goHomework", clickId="homepage_btn_pre")
        vk-progress(:pps="pps")
      back-card(key="2", v-if="currentPanelState=='back'", :config="config")
</template>
<script>
  import vkBtn from "../../common/vk_button.vue"
  import backCard from "./back_card.vue"
  import vkProgress from "../components/progress.vue"
  import cookies from "cookies-js"
  var noImg = require("../../../img/index/pre_bg.png")
  export default {
    data: function () {
      return {
        pps: [
          {
            name: "预习",
            state: "use"//disable:灰色 use：可预习 used：预习完
          },
          {
            name: "上课",
            state: "disable"//disable:灰色 use：可预习 used：预习完
          },
          {
            name: "做作业",
            state: "disable"//disable:灰色 use：可预习 used：预习完
          }
        ],
        //        HIDE(0,"不显示"),
        //        LOCK(1,"不可用"),
        //        UNLOCK(2, "可用"),
        //        FINISH_UNLOCK(3, "完成并继续可用"),
        //        FINISH_LOCK(4, "完成但不可用");
        backButtonState: ['hide', 'disable', 'enable', 'enable', 'disable']
      }
    },
    components: {
      vkBtn, vkProgress, backCard
    },
    props: [
      'config', 'currentPanelState'
    ],
    computed: {},
    mounted () {
      this.initState()
    },
    watch: {
      config: function (n, o) {
        this.initState()
      }
    },
    methods: {
      goHomework() {
        this.$getWorkUrl(this.config, this, this.config.courseCardStatus === 0 ? 'PRE' : 'AFTER', 'homepage_btn_homework')
      },
      initState() {
        /*
        * 进度判断逻辑
        * @preHomeworkStatus @afterHomeworkButtonText 这俩字段决定课前课后进度状态是否实心(1实心，2空心)
        * @courseCardStatus 此字段如果为2,代表上课状态为实心
        */
        if (this.config.preHomeworkStatus == 1) {
          this.pps[0].state = "used"
        }
        if (this.config.afterHomeworkButton == 0) {
          this.pps.pop()
        }
        if ([11,15,17,18].indexOf(this.config.cardType) > -1) {
          if (this.config.courseCardStatus == 2) {
            this.pps[1].state = "used"
            this.pps[2].state = "use"
          }
          if (this.config.afterHomeworkStatus == 1) {
            this.pps[2].state = "used"
          }
        }
        if ([15].indexOf(this.config.cardType) > -1) {
          this.pps[2].name = this.config.afterHomeworkScheduleText
        }
      },
      errorImg(e){
        e.target.src = noImg
      }
    }
  }
</script>

<style lang="stylus" scoped>
  .pre-content
    position: relative
    text-align: center
    padding-top: 25px

  .pre-video
    height: 127px
    width: 180px
    border-radius: 20px
    border: solid #ff5c01 5px
    margin: 0 auto
    background: url("../../../img/coursewarefail.png") center no-repeat
    background-size: auto 80%

  .pre-btn
    margin: 20px auto

</style>
