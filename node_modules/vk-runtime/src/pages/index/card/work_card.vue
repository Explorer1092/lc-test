<template lang="jade">
  //做作业的卡片
  .work-content
    transition-group(enter-active-class="animated fadeInDown")
      .panel-face(key="1",v-show="currentPanelState=='face'")
        template(v-if="!isFinishWork")
          .work-img.work-img-disable
          template(v-if="[14].indexOf(this.config.cardType)>-1")
            .prework-text {{blackText}}
            .prework-result-text {{toeflResultText ? toeflResultText : '--'}}
          template(v-else-if="[11].indexOf(this.config.cardType) == -1")
            .work-state.work-state-disable
              .work-state-left
                .ws-right -
                .icon-gray-right
              .work-state-right
                .icon-gray-error
                .ws-error -
        template(v-else)
          .work-img.work-img-enable
          template(v-if="[14].indexOf(this.config.cardType)>-1")
            .prework-text {{blackText}}
            .prework-result-text {{toeflResultText ? toeflResultText : '--'}}
          template(v-else-if="[11].indexOf(this.config.cardType) == -1")
            .work-state
              .work-state-left
                .ws-right {{homeworkRight}}
                .icon-green-right
              .work-state-right
                .icon-green-error
                .ws-error {{homeworkLeft}}
        vk-btn.work-btn(:type="workBtn.type",:text="workBtn.text",:isNewTab="workBtn.isNew",:clickFun="goHomework",clickId="homepage_btn_homework")
        vk-progress(:pps="pps")
      back-card(key="2",v-if="currentPanelState=='back'",:config="config")
</template>
<script>
  import cookies from "cookies-js"
  import vkBtn from "../../common/vk_button.vue"
  import vkProgress from "../components/progress.vue"
  import backCard from "./back_card.vue"
  import dragonUtils from '../../../utils/_dragon.js'
  export default {
    data: function () {
      return {
        toeflResultText: '',
        blackText:'',
        isFinishWork: false,
        homeworkRight: 0,
        homeworkLeft: 0,
        workBtn: {
          type: 'lg-hide',
          text: '',
          link: '#',
          isNew: false
        },
        pps: [
          {
            name: "预习",
            state: "use"//disable:灰色 use：可预习 used：预习完
          },
          {
            name: "上课",
            state: "use"//disable:灰色 use：可预习 used：预习完
          },
          {
            name: "做作业",
            state: "use"//disable:灰色 use：可预习 used：预习完
          }
        ],
        //HIDE(0,"不显示"),
        //LOCK(1,"不可用"),
        //UNLOCK(2, "可用"),
        //FINISH_UNLOCK(3, "完成并继续可用"),
        //FINISH_LOCK(4, "完成但不可用");
        backButtonState: ['hide', 'disable', 'enable', 'enable', 'disable']
      }
    },
    components: {
      vkBtn, vkProgress, backCard
    },
    props: [
      'config', 'currentPanelState'
    ],
    computed: {},
    watch: {
      config: function (n, o) {
        this.initState()
        this.initBtnAndWorkState()
      }
    },
    mounted () {
      this.initState()
      this.initBtnAndWorkState()
    },
    methods: {
      goHomework() {
        this.$getWorkUrl(this.config, this, this.config.courseCardStatus === 0 ? 'PRE' : 'AFTER', 'homepage_btn_homework')
      },
      initState() {
        if (this.config.preHomeworkButton > 2) {
          this.pps[0].state = "used"
        }
        if (this.config.classroomButton > 2) {
          this.pps[1].state = "used"
        }
        if (this.config.afterHomeworkButton > 2) {
          this.pps[2].state = "used"
        }
        if (this.config.afterHomeworkButton == 0) {
          this.pps = [{
            name: "预习",
            state: this.pps[0].state //disable:灰色 use：可预习 used：预习完
          }, {
            name: "上课",
            state: this.pps[1].state //disable:灰色 use：可预习 used：预习完
          }]
        }
      },
      initBtnAndWorkState() {
        //校验curriculumVersion
        this.workBtn.type = "lg-" + this.backButtonState[this.config.afterHomeworkButton]
        this.workBtn.text = this.config.afterHomeworkButtonText

        //是否完成作业了
        if (this.config.afterHomeworkStatus == 0) {
          this.isFinishWork = false
        }
        if (this.config.afterHomeworkStatus == 1) {
          this.isFinishWork = true
        }
        this.homeworkRight = this.config.afterHomeworkRight
        this.homeworkLeft = this.config.afterHomeworkTotal - this.config.afterHomeworkRight

        /*
        * @courseCardStatus 枚举
        * pre: 0 //预习状态
        * on: 1 //上课状态
        * onHomeWork: 2 //做作业状态
        * after: 3 //课程已经完成
        */

        //小学托福
        if( [14].indexOf(this.config.cardType) > -1 ) {

          if( [0].indexOf(this.config.courseCardStatus) > -1 ) {
            //小学托福课前作业
            this.blackText = '预习成绩'
            this.toeflResultText = this.config.preHomeworResultText
            this.pps[1].state = "disable"
            this.pps[2].state = "disable"
            this.workBtn.type = "lg-" + this.backButtonState[this.config.preHomeworkButton]
            this.workBtn.text = this.config.preHomeworkButtonText
          }

          if( [2].indexOf(this.config.courseCardStatus) > -1 ) {
            //小学托福课后作业
            this.blackText = '作业正确率'
            this.toeflResultText = this.config.afterHomeworkResultText
            this.workBtn.type = "lg-" + this.backButtonState[this.config.afterHomeworkButton]
            this.workBtn.text = this.config.afterHomeworkButtonText
          }
          return
        }
         
        //夏令营托福 课前作业
        if ([3].indexOf(this.config.cardType) > -1 && [0].indexOf(this.config.courseCardStatus) > -1) {
          this.pps[1].state = "disable"
          this.pps[2].state = "disable"
          //是否完成作业了
          if (this.config.preHomeworkStatus == 0) {
            this.isFinishWork = false
          }
          if (this.config.preHomeworkStatus == 1) {
            this.isFinishWork = true
          }
          this.workBtn.type = "lg-" + this.backButtonState[this.config.preHomeworkButton]
          this.workBtn.text = this.config.preHomeworkButtonText
          this.homeworkRight = this.config.preHomeworkRight
          this.homeworkLeft = this.config.preHomeworkTotal - this.config.preHomeworkRight
        }
        //夏令营托福 课后作业
        if ([3].indexOf(this.config.cardType) > -1 && [2].indexOf(this.config.courseCardStatus) > -1) {
          this.workBtn.type = "lg-" + this.backButtonState[this.config.afterHomeworkButton]
          this.workBtn.text = this.config.afterHomeworkButtonText
        }
        //ktv
        if([11].indexOf(this.config.cardType) > -1) {
          if ([2].indexOf(this.config.courseCardStatus) > -1) {
            this.workBtn.type = "lg-" + this.backButtonState[this.config.afterHomeworkButton]
            this.workBtn.text = this.config.afterHomeworkButtonText
          }
        }
      }
    }
  }
</script>

<style lang="stylus" scoped>
  .panel-face
    height: 300px
  .prework-text
    color: black
    display: inline-block
    vertical-align: middle
    margin-right: 8px
  .prework-result-text
    color: #FAA215
    display: inline-block
    vertical-align: middle
  .work-content
    position: relative
    text-align: center
    padding-top: 25px

  .work-video
    height: 127px
    width: 180px
    border-radius: 20px
    border: solid #ff5c01 5px
    margin: 0 auto

  .work-btn
    margin: 10px auto 20px auto

  .pb-btn
    margin: 20px auto

  .work-img
    height: 120px
    width: 130px
    margin: 5px auto

  .work-img-enable
    background: url("../../../img/icon/icon_header.png") -309px -10px

  .work-img-disable
    background: url("../../../img/icon/icon_header.png") -10px -220px

  .work-teacher-name
    color: #999999
    font-size: 22px
    text-align: center

  .work-state
    height: 30px
    text-align: center
    color: #555555
    margin-top: 10px
    .work-state-left
      float: left
      width: 50%
      div
        float: right
        margin-right: 5px
    .work-state-right
      width: 50%
      float: left
      div
        float left
        margin-left: 5px

  .work-state-enable
    background: url("../../../img/icon/icon_header.png") -10px -233px

  .panel-back
    padding-top: 20px
</style>
