<template lang="jade">
  //it test
  .it-test-content
    img.it-test(src="../../../img/index/card_icon_it_test.png")
    p.it-test-text {{config.cardText}}
    vk-btn.it-test-btn(:type="'lg-enable'", :text="config.buttonText", :clickFun="clickItTest")
</template>
<script>
  import Vue from 'vue'
  import vkBtn from "../../common/vk_button.vue"
  import model from "../../common/plugins/Model"
  import ittestDialog from '../components/it_test_dialog.vue'
  import cookies from 'cookies-js'
  import {localStorageUtil} from "../../../utils/_untils.js"
  Vue.use(model)

  var noImg = require("../../../img/index/pre_bg.png")
  var projectBg = require("../../../img/index/project_bg.png")
  export default {
    data: function () {
      return {
        localStorageKey: 'home_it_test_msg_box_count_' + cookies.get("studentId")
      }
    },
    components: {
      vkBtn
    },
    props: [
      'config'
    ],
    computed: {},
    mounted() {
      if (this.config.showMessageBox) {
        if (localStorageUtil.get(this.localStorageKey)) {
          let count = parseInt(localStorageUtil.get(this.localStorageKey))
          if (count < this.config.messageMaxAlertTimes) {
            this.showMessageBox()
            localStorageUtil.set(this.localStorageKey, count + 1)
          }
        } else {
          this.showMessageBox()
          localStorageUtil.set(this.localStorageKey, 1)
        }
      } else {
        localStorageUtil.del(this.localStorageKey)
      }
    },
    methods: {
      showMessageBox() {
        //弹窗!
        this.$modelShow({
          model: ittestDialog,
          title: this.config.messageTitle,
          text: this.config.messageText,
          btnText: this.config.buttonText,
          enter: () => {
            this.$modelClose()
            sa.track('learning_click', {'click_id': 'pc_learning_it_test_dialog'})
            window.open(this.config.jumpUrl)
          },
          closeDialog: () => {
            this.$modelClose()
            sa.track('learning_click', {'click_id': 'pc_learning_it_test_dialog_close'})
          }
        })
      },
      clickItTest() {
        sa.track('learning_click', {'click_id': 'pc_learning_it_test_card'})
        window.open(this.config.jumpUrl)
      }
    }
  }
</script>

<style lang="stylus" scoped>
  .it-test-content
    text-align: center
    padding-top: 45px

  .it-test
    width: 134px
    height: 120px
    border-radius: 20px
    margin: 0 auto

  .it-test-btn
    margin: 30px auto

  .it-test-text
    color: #999999
    font-size: 16px
    line-height: 25px
    width: 270px
    margin: 0 auto

</style>
