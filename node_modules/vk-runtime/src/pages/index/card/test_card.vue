<template lang="jade">
  .test-con
    .test-start(v-if="config.doOrResult")
    .test-finish(v-if="!config.doOrResult")
    .tc-title {{config.desc}}
    vk-btn.tc-btn(v-if="!config.doOrResult",type="lg-enable",:text="config.button",:clickFun="linkFun")
    vk-btn.tc-btn(v-if="config.doOrResult",type="lg-enable",:text="config.button",:link="config.ctBeginAddr",:isNewTab="true")

</template>
<script>
  import vkBtn from "../../common/vk_button.vue"
  import testResult from "../components/test_result.vue"
  import Vue from "vue"
  import axios from 'axios'
  import cookies from 'cookies-js'

  export default {
    data: function () {
      return {
        link: "#",
        testResultDialog: null
      }
    },
    components: {
      vkBtn, testResult
    },
    props: ['config'],
    computed: {},
    mounted () {
    },
    methods: {
      linkFun(){
        //做CT
        if (this.config.doCt) {
          sa.track('learning_click', {'click_id': 'pc_learning_homepage_ct_start'})
          //ct:normal newCT:
          switch (this.config.ctType) {
          case "normal":
            this.$router.push("/test_work")
            break
          case "new":
            axios.get('/rest/learninggw/api/pc/homepage/getStudentCtStartExam', {
              params: {
                studentId: cookies.get("studentId")
              }
            }).then((res) => {
              if (res.data.code == 200 && res.data.data.ctEnable) {
                this.$router.push("/test_work")
              } else {
                this.$showToast("没有权限，请联系您的班主任老师，谢谢！")
              }
            })
            break
          case "lexile":
            window.location.href = this.config.ctBeginAddr + "&back_url=" + encodeURIComponent(document.location.href) //@back_url 用于作业端返回
            break
          }
        } else {
          //查看报告
          if (this.config.ctType == "normal") {
            var TestResult = Vue.extend(testResult)
            var vm = new TestResult({propsData: {contents: this.config.content, closeDialog: this.closeDialogFun}})
            this.testResultDialog = vm.$mount().$el
            document.body.appendChild(this.testResultDialog)
            sa.track('learning_click', {'click_id': 'pc_learning_homepage_ct_result_old'})
          } else {
            this.$router.push("/test_result/" + this.config.examUuid + "/0")
            sa.track('learning_click', {'click_id': 'pc_learning_homepage_ct_result_new'})
          }
        }
      },
      closeDialogFun(){
        document.body.removeChild(this.testResultDialog)
      }
    }
  }
</script>

<style lang="stylus" scoped>
  .test-con
    height: 300px
    text-align: center

  .test-start
    background: url('../../../img/icon/icon_header.png') -160px -89px
    height: 120px
    width: 120px
    margin: 45px auto 0 auto

  .test-finish
    background: url('../../../img/icon/icon_header.png') -10px -89px
    height: 120px
    width: 120px
    margin: 45px auto 0 auto

  .tc-btn
    margin: 30px auto

  .tc-title
    color: #999999
    margin-top: 20px


</style>
