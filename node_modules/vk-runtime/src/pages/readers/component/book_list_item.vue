<template lang="jade">
  .book_list_item(@mouseenter="bookNameMouseEnter($event)", @mouseleave="bookNameMouseLeave($event)")
    .book-itself(:class="{'book-shake': isBookShake}", @click="goToDetail(bookDataProp.id, bookDataProp.code)")
      img.book-mask(src="../../../img/library/book_mask.png")
      img.book-face(:src = " bookDataProp.coverResUrl + '?imageView2/2/w/328/h/370' ",@load="loadingImage($event)", @error="loadingImageError")
      img.book-record(src="../../../img/library/dl-can-record-book@2x.png" v-if="bookDataProp.allowRepeat == 1")
      //- img.book-label(src="../../../img/library/test_label_text.png")
    .book-info
      .book-name-wrap(:class="{textellipsis: isOnIpad}", v-if="config.style != 4")
        .book-name(:class="{'wider-margin-top': config.style == 2 || config.style == 5}") {{bookDataProp.name}}
      .book-data-wrap(v-if="config.style != 3 && config.style != 5")
        img.eye(src="../../../img/readers/reader.png")
        span.clickrate {{bookDataProp.clickRate}}
        //- .inventory
        //- span.inventory-text 12332
</template>

<style lang="stylus" scoped>
  SPIRIT_PIC_WIDTH = 1430px / 2
    *
      -moz-user-select: none
      -webkit-user-select: none
      -ms-user-select: none
      -khtml-user-select: none
      user-select: none
      -webkit-font-smoothing: antialiased
      -webkit-touch-callout: none
    .book_list_item
      cursor: pointer
      width: 130px
      .book-itself
        position: relative
        width: 130px
        height: 146px
        border-radius: 6px
        overflow: hidden
        &.book-shake
          position: relative
        img.book-mask
          position: absolute
          top: 0
          left: 0
          right: 0
          z-index: 0
          width: 100%
        img.book-face
          width: 100%
        img.book-record 
           position: absolute
           top: 102px
           left: 85px
           width: 40px 
        img.book-label
          position: absolute
          top: 0px
          left: 5px
          width: 28px
          height: 24px
          z-index: 2
      .book-info
        color: white
        .book-name-wrap
          width: 100%
          overflow: hidden
          white-space: nowrap
          text-overflow: ellipsis
          &.textellipsis
            text-overflow: ellipsis
          .book-name
            font-size: 16px
            margin: 5px 0 0 0
            height: 21px
            white-space: nowrap
            display: inline-block
            &.wider-margin-top
              margin-top: 16px
              
        .book-data-wrap
          color: #bdc5ff
          font-size: 12px
          margin-top: 2px
          img.eye
            width: 20px
            margin-right: 5px
            display: inline-block
            vertical-align: middle
          span.clickrate
            display: inline-block
            vertical-align: middle
      &.text-move
        .book-name
          animation: bookNameMove 5s linear infinite
          -webkit-animation: bookNameMove 5s linear infinite
        .book-name-wrap
          text-overflow: initial

@keyframes bookNameMove
    from
      transform: translate3d(0, 0, 0)
    to
      transform: translate3d(-100%, 0, 0)
@-webkit-keyframes bookNameMove 
  from 
    transform: translate3d(0, 0, 0)
  to
    transform: translate3d(-100%, 0, 0)

</style>

<script>
import myDialog from "../common/dialog.vue"
import utils from '../../../utils/_untils.js'
import Velocity from 'velocity-animate'
import axios from 'axios'

export default {
  data() {
    return {
      isOnIpad: false
    }
  },
  components: {
    myDialog
  },
  props: ['bookDataProp', 'config', 'isBookShake', 'isReplaceUrl', 'bookListLength', 'mark'],
  mounted() {
    this.isOnIpad = utils.isOnIpad()
  },
  watch: {},
  methods: {
    loadingImageError() {
      this.loadingControlByImgState()
    },
    loadingImage() {
      this.loadingControlByImgState()
    },
    loadingControlByImgState() {
      if (this.config.bookListLengthOfCurrPage == 1) {
        setTimeout(() => {
          this.$emit('closeFullPageLoadingEvent')
        }, 300)
      }
      this.config.bookListLengthOfCurrPage--
    },
    goToDetail( id, bookCode ) {
      if(this.config.disableClick) {
        return
      }
      if(this.mark) {
        sa.track('learning_click', {'click_id': 'pc_learning_digital_' + this.mark + '_bookname_id_' + id})
      }
      if( this.isReplaceUrl ) {
        this.$router.replace({path: `/digitalLibrary/detail/${id}/${bookCode}`})
      } else {
        this.$router.push({path: `/digitalLibrary/detail/${id}/${bookCode}`})
      }
    },
    bookNameMouseEnter(event) {
      if (!utils.isOnIpad()) event.target.className += ' text-move'
    },
    bookNameMouseLeave(event) {
      if (!utils.isOnIpad()) utils.removeClass(event.target, 'text-move')
    }

  }
}
</script>
