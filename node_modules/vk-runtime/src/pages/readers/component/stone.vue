<template lang="jade">
  .stone-wrap(@click="jumpToLink('/hot_activity')", v-if="isShowStone", :class="{'stone-wrap-right': showDreamEntry}")
    .stone-box(v-if="state == 0")
      img.stone(v-bind:class="{disabled:disabled}",src="../../../img/library/stone1.png")
      img.light.move(v-bind:class="{disabled:disabled}",src="../../../img/library/stonelight.png")
    .stone-box(v-else-if="state == 1")
      img.stone(v-bind:class="{disabled:disabled}",src="../../../img/library/stone.png")
    .bubble-text(v-if="isShowText",v-bind:class="{disabled:disabled}")
      p {{text}} 
</template>
<style lang="stylus" scoped>
  .disabled
     filter: grayscale(50%);
     cursor not-allowed
  .stone-wrap
    position: absolute
    top: 16px
    right: 149px
    z-index: 10
    color: #ffffff
    cursor: pointer
    width:150px 
    height:140px
    .stone-box
      .stone
        position: absolute
        top: 6px
        left: 10px
        width: 64px
        height: 64px
        z-index: 1
        transition: all 0.2s
        &:hover
          transform: scale(1.1)
      .light
        position: absolute
        top: 0
        left: 0
        width: 80px
        height: 80px
        &.move
          animation: lightMove 20s 
          animation-timing-function: ease-out
    .bubble-text
      width: 150px
      height: 75px
      background-image: url('../../../img/library/bubblebg@2x.png')
      background-size: 100%
      position: absolute
      bottom: 0px
      left: -35px
      font-size: 14px
      line-height: 14px
      color: #8F82BC
      text-align: center
      padding: 20px 15px 0px 15px
      box-sizing: border-box
  .stone-wrap-right
    right: 212px     
@keyframes lightMove
  100%
    transform: rotate(3600deg)
</style>

<script>
import axios from 'axios'
import cookies from 'cookies-js'

export default {
  data() {
    return {
      isShowStone: true,
      textGroup:['宝贝完成Bob Books绘本配音有能量石哦~', '宝贝点击领取能量石吧~', '宝贝明天继续配音得能量石哦~'],
      text: '',
      state: 0, //为0时显示闪光宝石引导学生领取宝石，为1时显示静止玻璃罩宝石。
      isGray:false,
      isShowText:true
    }
  },
  components: {
  },
  computed:{
    disabled(){
      if(this.isGray){
        return true
      } else {
        return false
      }
    }
  },
  props: {
    showDreamEntry: {
      type: Boolean,
      default: false
    }
  },
  mounted() {
    this.getData()
    this.text = this.textGroup[1]
  },
  methods: {
    getData() {
      axios.get("/rest/learninggw/api/pc/service/digitlib/getReadMonthReward", {
        params: {
          studentId: cookies.get("studentId")
        }
      }).then(res => {
        if (res.data.code == 200) {
          let data = res.data.data
          switch(data.readActivityStatus) {
          case 0:
            this.isShowStone = false 
            break
          case 1: //没有宝石可领取
            this.state = 1
            this.text = this.textGroup[0]
            this.isGray = true
            break
          case 2: //已读书，可以领取宝石
            this.state = 0
            this.text = this.textGroup[1]
            this.isGray = false
            break
          case 3: //已读书，已经领取过宝石
            this.state = 1
            this.text = this.textGroup[2]
            this.isGray = true
            this.checkoutIsShowText(data.isLastDay)
            break
          default:
            this.state = 1
            this.text = this.textGroup[0]
            this.isGray = true
          }
        }
      })
    },
    checkoutIsShowText(isLastDay){
      if(isLastDay){
        this.isShowText = false
      }
    },
    jumpToLink( link ) {
      if(!this.isGray){
        this.$router.push({path: link})
      }
    }
  }
}
</script>
