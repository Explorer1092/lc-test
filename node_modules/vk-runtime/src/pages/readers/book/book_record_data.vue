<template lang="jade">
  .recoder-data-bg
    top-part(:title_cn = "title_chinese", :title_eng = "title_english", :isAbsoluteFix = "true", :gobackurl="''", :mark="'book_reocrd_data'")
    my-dialog(:tipText="'网络有点问题，检查一下网络连接吧'", :confirmButton="'刷新页面'", :type="'alert'", title="Notice", isShowTitle = true, @library-dialog-close = "closeDialog()", @library-dialog-cancel="reloadPage", v-if="isBadNetworkAlertShow")
    .recorder-share(@click="showShare()")
    .user-information
      img(src = "../../../img/common/avatar/default.png", v-if = "!userInfo.avatarUrl && (userInfo.studentAvatar == 'default' || !userInfo.studentAvatar)")
      img(src = "../../../img/common/avatar/boy_1.png", v-if = "!userInfo.avatarUrl && userInfo.studentAvatar == 'boy_1'")
      img(src = "../../../img/common/avatar/boy_2.png", v-if = "!userInfo.avatarUrl && userInfo.studentAvatar == 'boy_2'")
      img(src = "../../../img/common/avatar/boy_3.png", v-if = "!userInfo.avatarUrl && userInfo.studentAvatar == 'boy_3'")
      img(src = "../../../img/common/avatar/boy_4.png", v-if = "!userInfo.avatarUrl && userInfo.studentAvatar == 'boy_4'")
      img(src = "../../../img/common/avatar/girl_1.png", v-if = "!userInfo.avatarUrl && userInfo.studentAvatar == 'girl_1'")
      img(src = "../../../img/common/avatar/girl_2.png", v-if = "!userInfo.avatarUrl && userInfo.studentAvatar == 'girl_2'")
      img(src = "../../../img/common/avatar/girl_3.png", v-if = "!userInfo.avatarUrl && userInfo.studentAvatar == 'girl_3'")
      img(src = "../../../img/common/avatar/girl_4.png", v-if = "!userInfo.avatarUrl && userInfo.studentAvatar == 'girl_4'")
      img(:src="userInfo.avatarUrl",v-if="userInfo.avatarUrl")
      .user-name {{userInfo.studentName}}
    .hang-board-postion-control
      .hang-board
        .infinite-part
        .right-end
        p {{bookName}}
    .recoder-data-content
      .recorder-data-sum
        .record-score-text 配音总分
        p.record-socre(v-bind:class="scoreStyle")  {{readerScore}}
      .recorder-data-trips
        p 说明
        p 单词的发音通过颜色标记不同评价分数 分数按照北美标准发音参照给出
      .recorder-data-pet
      .recorder-data-detail
        p.recorder-data-detail-header  绘本配音报告解析
        .recorder-data-flag-body
          .recorder-flag.recorder-bad
          .recorder-flag.recorder-normal
          .recorder-flag.recorder-good
          .recorder-flag.recorder-excellent
        .recorder-data-detail-words-result
          p(v-for="(words,index) in wordsList") {{index + 1}}&nbsp;
            span(
              v-for="word in words.wordScoreMap",
              :class="word.score"
            ) {{word.word}}&nbsp;
    recoderDataShare(:dudSummaryId="dudSummaryId",:bookId="parseInt($route.params.bookCode)" v-if="isShowShare",@closeShareLayer="closeShareLayer")         
</template>
<script>
import axios from 'axios'
import cookies from 'cookies-js'
import TopPart from '../../common/top_part.vue'
import myDialog from "./../common/dialog.vue"
import recoderDataShare from "./../common/share.vue"
export default {
  data:()=>{
    return {
      userInfo:{},
      isBadNetworkAlertShow:false,
      title_chinese:'',
      title_english:'',
      bookName:'',
      readerScore:0,
      wordsList:null,
      dudSummaryId:0,
      isShowShare:false
    }
  },
  computed:{
    scoreStyle:function(){
      return {
        'recorder-bad-color': this.readerScore <56,
        'recorder-normal-color':this.readerScore>=56 && this.readerScore <71,
        'recorder-good-color':this.readerScore>=71 && this.readerScore <=85,
        'recorder-excellent-color':this.readerScore>85
      }
    }
  },
  methods:{
    closeShareLayer(){
      this.isShowShare = false
    },
    showShare(){
      sa.track('learning_click', {'click_id': 'pc_learning_digital_library_book_record_report_share_id_' + this.$route.params.bookCode})
      this.isShowShare = true
    },
    closeDialog(){
      this.isBadNetworkAlertShow = false
    },
    reloadPage(){
      location.reload()
    },
    //获取录音报告
    getRecordData(){
      axios.get('/rest/learninggw/api/pc/service/digitlib/getRecordResultList',{
        params:{
          studentId: cookies.get("studentId"),
          bookId: this.$route.params.bookCode
        }
      }).then((res)=>{
        let data = res.data.data
        this.dudSummaryId = data.dudSummaryId
        this.bookName = data.readerName
        this.readerScore = data.readerScore
        this.formatSCoreList(data.items)
      }).catch((err)=>{
        this.isBadNetworkAlertShow = true
      })
    },
    //将数据的分数对应的样式
    formatSCoreList(items){
      let length = items.length
      for(let i =0; i<length;i++){
        if(Array.isArray(items[i].wordScoreMap)){
          items[i].wordScoreMap = this.formatScoreToStyle(items[i].wordScoreMap)
        } else {
          items[i].wordScoreMap = JSON.parse(items[i].wordScoreMap)
          items[i].wordScoreMap = this.formatScoreToStyle(items[i].wordScoreMap)
        }
      }
      this.wordsList = items
    },
    formatScoreToStyle(wordScoreMap){
      let length = wordScoreMap.length
      for(let i = 0; i< length ;i++) {
        let score = wordScoreMap[i].score
        if(score<56){
          wordScoreMap[i].score = "recorder-bad-color"
        } else if(score<=70){
          wordScoreMap[i].score = "recorder-normal-color"
        } else if(score <=85){
          wordScoreMap[i].score = "recorder-good-color"
        } else {
          wordScoreMap[i].score = "recorder-excellent-color"
        }
      }
      return wordScoreMap
    },
    userInfoData() {
      return axios.get('/rest/learninggw/api/pc/homepage/getStudentInfo', {
        params: {
          studentId: cookies.get("studentId")
        }
      }).then((res) => {
        if (res.data.code == 200) {
          this.userInfo = res.data.data
          this.userInfo.isShow = true
        }
      }
      ).catch((err) => {
        this.isBadNetworkAlertShow = true
      })
    }
  },
  mounted(){
    this.userInfoData()
    this.getRecordData()
  },
  components:{
    myDialog,
    TopPart,
    recoderDataShare
  }
}
</script>
<style lang="stylus" scoped>
  *
    box-sizing: border-box
    -moz-user-select: none
    -webkit-user-select: none
    -ms-user-select: none
    -khtml-user-select: none
    user-select: none
    -webkit-font-smoothing: antialiased
    -webkit-touch-callout: none
    font-weight: 300
  .recoder-data-bg
    background-repeat: no-repeat
    background-position: center
    background-size: 1920px
    background-color: #6D4C9E
    width: 100%
    height: 100%
    background-image: url('../../../img/library/bg-book-1280-1920.png')
    background-size: 1920px
  .recorder-share 
     position:absolute
     top:20px 
     right:40px
     width:66px 
     height:66px 
     background:url(../../../img/library/dl-book-data-share@2x.png) no-repeat
     background-size:66px 66px
     cursor:pointer
     z-index:100
     &:hover 
       opacity:.8 
  .user-information
    top:18px 
    left:122px 
    position:absolute
    width: 220px
    height: 64px 
    background:rgba(0,0,0,0.1996)
    border-radius: 44px
    overflow:hidden
    img 
     left:2px 
     top:2px 
     position:absolute
     width:60px 
     height:60px 
     border-radius:60px
    .user-name
      position:absolute
      left: 72px
      line-height:64px 
      font-size:20px 
      color:#fff
  .hang-board-postion-control
      position: absolute
      top: 0
      left: 0
      right: 0
      text-align: center 
      .hang-board
        display: inline-block
        position: relative
        margin: 0 auto
        line-height: 119px
        font-family:'PingFangSC-Semibold';
        font-size: 24px
        font-weight: 600
        color: #ffffff
        height: 119px
        min-width: 448px
        background-image: url('../../../img/library/top-hang-left-end.png')
        background-position: left
        background-size: 100%
        background-size: contain
        background-repeat: no-repeat
        padding: 0 124px 0 291px
        p
          position: relative
          top: -115px
          left: -82px
        .right-end
          position: absolute
          top: 0
          right: 0
          height: 100%
          width: 124px
          background-image: url('../../../img/library/top-hang-right-end.png')
          background-size: contain
          background-repeat: no-repeat
        .infinite-part
          height: 100%
          width: 100%
          background-image: url('../../../img/library/top-hang-infinite-part.png')
          background-repeat: repeat-x
          background-size: contain
  .recoder-data-content
    position:absolute
    left:50%
    top:50%
    margin-top:-270px
    margin-left:-417px
    width:834px
    height:530px 
  .recorder-data-sum
    position:absolute
    top:40px 
    left:88px 
    width:170px 
    height:170px
    background:url(../../../img/library/dl-book-record-sum.png)
  .record-score-text
    position:absolute
    top:32px 
    font-size:24px
    font-weight:700
    text-align:center
    color:#fff 
    width:100%
  .recorder-data-trips
    padding: 13px 0 16px
    position:absolute
    top:260px
    left:37px
    width:271px 
    height:99px 
    background:url(../../../img/library/dl-book-record-score-trips.png)
    p 
      line-height:20px
      font-size:14px 
      padding:0 17px
      color:#AA7CFF
  .recorder-data-pet
    position:absolute
    left:75px
    bottom:-80px
    width:185px
    height:240px 
    background:url(../../../img/library/dl-book-record-score-pet.png) no-repeat
  .record-socre
    position:absolute
    top:65px 
    width:100% 
    height:100px
    line-height:87px
    text-align:center
    font-family:"PingFangSC-Semibold";
    font-size:72px 
    color:#79DC7D
  .recorder-data-detail
    position:absolute
    right:30px 
    top:30px
    width:470px 
    height:530px
    background:rgb(62,40,117)
    border-radius: 20px
  .recorder-data-detail-header
    margin:30px
    text-align:center
    height:42px 
    line-height:42px 
    font-size:30px
    font-weight:700 
    color:#fff
  .recorder-data-flag-body
    display:flex
    display:-webkit-flex
    justify-content:center
    -webkit-justify-content:center
  .recorder-flag
    width:74px
    height:70px
    &.recorder-bad
      background:url(../../../img/library/dl-bad-score.png) no-repeat
    &.recorder-normal
      margin:0 30px
      background:url(../../../img/library/dl-normal-score.png) no-repeat
    &.recorder-good
      margin-right:30px
      background:url(../../../img/library/dl-good-score.png) no-repeat
    &.recorder-excellent
      background:url(../../../img/library/dl-excllent-score.png) no-repeat
  .recorder-data-detail-words-result
     margin-left:42px 
     margin-top:12px
     height:323px 
     width:386px
     overflow-y:auto
     &::-webkit-scrollbar
       width:6px 
       background:rgba(255,255,255,.1)
       border-radius: 4px
     &::-webkit-scrollbar-thumb
       width:6px
       border-radius:6px
       background-color:#AA7CFF
     p 
       color: #fff;
       font-weight: 700;
       font-family: 'PingFangSC-Semibold';
       font-size: 18px;
       line-height: 25px;
       width: 360px;
       word-wrap: break-word;
       &:first-letter 
          text-transform:capitalize
       span 
        font-weight:700
       
  .recorder-bad-color
          color:#ED6161
  .recorder-normal-color
          color:#FFB600
  .recorder-good-color
          color:#90D0FF
  .recorder-excellent-color
          color:#79DC7D
</style>


