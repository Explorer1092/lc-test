<template lang="jade">
.library_entry
  top-part(:title_cn = "title_chinese", :title_eng = "title_english", :isAbsoluteFix = "true", :gobackurl="'/'")
  .black-mirror(v-if="isGuideShow")
  my-dialog(:tipText="'1.宝贝可以同时借（最多）3个绘本；<br>2.每个绘本借阅的时间为14天，到期后绘本会自动归还哦。'", :type="'alert'", :cancelButton = "'知道了'", :title="'Notice'", isShowTitle = true, @library-dialog-cancel="cancelHowToBorrowDialog", v-if="isShowHowToBorrowDialog")
  .bookshelf-entry-container
    .bookshelf-entry.borrow-1(@click="jumpToMyBookshelf", v-if="numberOfStudentBorrow==1")
      | 我的书架1/3
    .bookshelf-entry.borrow-2(@click="jumpToMyBookshelf", v-else-if="numberOfStudentBorrow==2")
      | 我的书架2/3
    .bookshelf-entry.borrow-3(@click="jumpToMyBookshelf", v-else-if="numberOfStudentBorrow==3")
      | 我的书架3/3
    .bookshelf-entry.no-borrow(v-else)
      | 未借书
    .quesion-button(@click="showHowToBorrowDialog")
  .container
    .placeholder
    .content
      .box(@click="isGuideShow ? '' : goToLink('/digitalLibrary/pb')", :class="{'yes': !isGuideShow }")
        img(:src="pbData.imgUrl")
        p {{pbData.titleEN}}
        p {{pbData.titleCH}}
        img.i-know-btn(src="../../../img/digireader/guide_iknown@2x.png", @click.stop="closeHint", v-if="isGuideShow")
        .hint.pb(v-if="isGuideShow")
          p 喜欢科学，社会学和数学等读物的
          p 宝贝请进入“原版引进”，
          p 这里汇集了世界知名的儿童读物。
      .box(@click="isGuideShow ? '' : goToLink('/digitalLibrary/vo')", :class="{'yes': !isGuideShow }")
        img(:src="voData.imgUrl")
        p {{voData.titleEN}}
        p {{voData.titleCH}}
        .hint.vo(v-if="isGuideShow")
          p VIPKID外教老师特意为宝贝们手绘并撰写有趣的科
          p 幻，奇幻，历史，写实小说，请进入“原创系列”，
          p 让你和外教老师在绘本中再次相遇。
</template>
<script>
import axios from 'axios'
import cookies from 'cookies-js'
import TopPart from '../../common/top_part.vue'
import myDialog from "../common/dialog.vue"

export default {
  data: function() {
    return {
      title_chinese: '数字图书馆',
      title_english: 'Digital Library',
      isGuideShow: false,
      numberOfStudentBorrow: '',
      isShowHowToBorrowDialog: false,
      cn: 'lc_dl_userguide_' + cookies.get('studentId'),
      pbData:{},
      voData:{}
    }
  },
  components: {
    TopPart,
    myDialog
  },
  mounted() {
    this.setStudentBorrowStatus()
    if(!localStorage.getItem(this.cn)) {
      this.isGuideShow = true
    }
    this.getEntryData()
  },
  methods: {
    getEntryData() {
      axios.get('/rest/learninggw/api/pc/service/digitlib/homepage', {})
        .then((res) => {
          this.pbData = res.data.data.originalImports
          this.voData = res.data.data.originalClassic
        })
        .catch((err) => {
        })
    },
    jumpToMyBookshelf() {
      this.$router.push({path: '/myBookshelf'})
    },
    cancelHowToBorrowDialog() {
      this.isShowHowToBorrowDialog = !this.isShowHowToBorrowDialog
    },
    showHowToBorrowDialog() {
      this.isShowHowToBorrowDialog = true
    },
    setStudentBorrowStatus() {
      axios.get(`/rest/learninggw/api/pc/service/digitlib/${cookies.get('studentId')}/myBookShelf`, {})
        .then((res) => {
          this.numberOfStudentBorrow = res.data.data.books.length
        })
        .catch((err) => {
        })
    },
    goToLink(link) {
      sa.track('learning_click', {'click_id': 'pc_learning_go_to_link_' + link + '_digital_library_entry'})
      this.$playSound("click")
      this.$router.push({path: link})
    },
    closeHint() {
      localStorage.setItem(this.cn, '1')
      this.isGuideShow = false
    }
  }
}
</script>
<style lang="stylus" scoped>
*
  box-sizing: border-box
  -moz-user-select: none
  -webkit-user-select: none
  -ms-user-select: none
  -khtml-user-select: none
  user-select: none
  -webkit-font-smoothing: antialiased
  font-weight: 300
  -webkit-touch-callout: none
.library_entry
  background-image: url('../../../img/digireader/digi-entry-bg.png')
  background-size: 100%
  .bookshelf-entry-container
    position: absolute
    top: 24px
    right: 39px
    z-index: 10
    color: #ffffff
    &.user-guide
      z-index: 12
    .guide-mybooks
      position: absolute
      top: 0
      left: 0
      width: 166px
      top: 62px
      left: -90px
      width: 166px
      z-index: 99
    .guide-how-to-borrow
      position: absolute
      top: 63px
      right: -16px
      width: 138px
      z-index: 99
    .bookshelf-entry
      background-color: rgba(0,0,0, 0.2)
      width: 110px
      height: 36px
      border-radius: 60px
      display: inline-block
      vertical-align: middle
      margin-right: 25px
      cursor: pointer
      position: relative
      box-sizing: border-box
      padding: 7px 0 0 16px
      font-size: 15px
      &:before
        content: ""
        width: 36px
        height: 36px
        position: absolute
        top: 0
        left: -24px
        background-image: url('../../../img/digireader/icon-bookshelf@2x.png')
        background-repeat: no-repeat
        background-size: 100% 100%
      &.no-borrow
        padding: 7px 0 0 36px
        cursor: not-allowed
      &.borrow-1
        &:after
          content: ''
          position: absolute
          height: 30px
          width: 40px
          border-radius: 15px
          background-color: #b396ff
          z-index: -1
          top: 3px
          left: 0
      &.borrow-2
        &:after
          content: ''
          position: absolute
          height: 30px
          width: 70px
          border-radius: 15px
          background-color: #b396ff
          z-index: -1
          top: 3px
          left: 0
      &.borrow-3
        &:after
          content: ''
          position: absolute
          height: 30px
          width: 107px
          border-radius: 15px
          background-color: #b396ff
          z-index: -1
          top: 3px
          left: 0
    .quesion-button
      background-image: url('../../../img/digireader/reader_spirit.png')
      background-size: 715px
      background-repeat: no-repeat
      width: 51px
      cursor: pointer
      height: 51px
      display: inline-block
      vertical-align: middle
      background-position: -439px -231px
      &:hover
        background-position: -494px -231px
      &:active
        background-position: -551px -232px
  .black-mirror
    position: fixed
    top: 0
    bottom: 0
    left: 0
    right: 0
    background-color: rgba(0, 0, 0, 0.7)
    z-index: 11
  .container
    height: 100%
    width: 65%
    margin: 0 auto
    .placeholder
      display: inline-block
      vertical-align: middle
      height: 100%
    .content
      display: inline-block
      vertical-align: middle
      margin-top: 92px
      .box
        width: 50%
        display: inline-block
        vertical-align: middle
        text-align: center
        cursor: pointer
        perspective: 200px
        z-index: 13
        position: relative
        &.yes:hover
          img
            transform: translate3d(0,0,10px)
        &>img
          transition: all 0.2s
          width: 55%
          margin-bottom: 10px
        &>p
          font-size: 16px
          color: #ffffff
          line-height: 1.8em
        img.i-know-btn
          width: 111px
          height: 54px
          z-index: 13
          position: absolute
          bottom: -90px
          right: -63px
          &:hover
            opacity: 0.7
        .hint
          position: absolute
          top: -132px
          text-align: center
          color: #8f82bc
          font-size: 14px
          background-size: 100% 100%
          padding: 13px 0
          &.pb
            width: 272px
            height: 98px
            background-image: url('../../../img/digireader/library_entry_bubble_1.png')
            left: 25%
          &.vo
            width: 372px
            height: 98px
            background-image: url('../../../img/digireader/library_entry_bubble_2.png')
            left: 17%
</style>


