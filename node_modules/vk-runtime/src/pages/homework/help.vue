<template lang="jade">
  .help-body
    .black-mirror(v-show="isMirrorShow")
    .help-wrapper
      .help-area
        h1.help-title 作业问题快速解决指南
        .container-box.container-box-pc
          .problem-feedback(@click="openProblemFeedback") 问题反馈
          .feedback-base.animated.bounceIn(v-show="isFeedBackLayerShow")
            a.fw-close(@click="feedBackClose")
            .fw-dinosaur
              img(src="../../img/common/dino_modalface_happy.png")
            .fw-content
              .fw-title 宝贝遇到了什么问题?
              .fw-main
                .fw-minititle 选择你遇到的问题，我们会尽快为您解决
                ul.fw-errors.fn-clear
                  li(v-for="tag in tags", :class="{'active': tag.active }", @click="selectQuestion(tag.id)") {{tag.title}}
                .fw-type
                  input(type="text", placeholder="请输入您遇到的其他问题",maxLength="100", v-model="customIssue")
                .fw-submit
                  input(type="button", v-bind:class="{active:submitActive}", value="提交", @click="questionSubmit")
          .help-list-box
            .help-container#help-container
              h5 尊敬的家长和小朋友:
              .explain 当您打开这个指南的时候，一定是小朋友在做作业时遇到了问题。不用着急哦，请对照以下目录看看如何快速解决你的问题吧！
              ul.list-box#js-list-title
                li.title#title_0(@click = "openSub('1')")
                  .name(data_num=0) 作业成绩问题
                    i.icon
                  ul.subtitle-con(v-show="isShowSub1")
                    li.subtitle-box
                      .subtitle(@click.stop.self="toggleDetail($event)") 作业成绩未刷新
                      .detail
                        .box
                          p.txt 如果做完了某个作业，但是作业列表没有显示成绩，状态为“待完成”。（如下图）
                          img(src="../../img/homework/help/help-1.png")
                          p.txt 请确保作业最后见到过类似下图界面，并点击图中的“Home”回到作业列表页面。
                          img(src="../../img/homework/help/help-2.png")
                          p.txt 如果没有见到上图页面，请在做完作业后按如下提示点击对应的提交按钮。 Level 1（示例）
                          img(src="../../img/homework/help/help-3.png")
                          p.txt Level 2-4（示例）
                          img(src="../../img/homework/help/help-4.png")
                          p.txt Level 5（示例）
                          img(src="../../img/homework/help/help-5.png")
                          p.txt Level 6（示例）
                          img(src="../../img/homework/help/help-6.png")
                          p.txt 并点击下图中的“YES”
                          img(src="../../img/homework/help/help-7.png")
                          p.txt 小学托福 （示例）
                          img.common-pd(src="../../img/homework/help/help-8.png")
                    li.subtitle-box
                      .subtitle(@click.stop.self="toggleDetail($event)") 成绩提交失败
                      .detail
                        .box
                          p.txt 请再次点击“重新提交”。
                          img.common-pd(src="../../img/homework/help/help-9.png")
                li.title#title_1(@click = "openSub('2')")
                  .name(data_num=1) 中途卡住
                    i.icon
                  ul.subtitle-con(v-show="isShowSub2")
                    li.subtitle-box
                      .subtitle(@click.stop.self="toggleDetail($event)") 点击没反应
                      .detail
                        .box
                          p.txt 操作提示：若点击动画无效，很大可能是前一步没有点击到正确的图形。例如下面第一张图，需要点击第三匹马（黑马），避免点击手形提示区域。
                          p.txt 点击后出现第二张图，如果点击第四匹马没有反应，再次点击第三匹马（此时已经是字母“a”的白马了），第四匹马就可以正常点击了。
                          img(src="../../img/homework/help/help-10.png")
                          img(src="../../img/homework/help/help-11.png")
                          p.txt.common-pd 类似的问题，手形是指引小朋友点击哪个图形，点击对应的图形尽量避开手型区域本身。如果卡住了，可以通过重新点击上一个图形来激活动画。
                    li.subtitle-box
                      .subtitle(@click.stop.self="toggleDetail($event)") 没有下一步
                      .detail
                        .box
                          p.txt 进入下一步的按钮没有加载出来。原因可能是浏览器没有允许运行flash或者flash版本太低。
                          //- img(src="../../img/homework/help/help-20.png")
                          p.txt 设置允许运行flash：<br>Chrome 浏览器<br>地址栏输入chrome://settings/content
                          img(src="../../img/homework/help/help-12.png")
                          p.txt 然后如下图操作：
                          img(src="../../img/homework/help/help-13.png")
                          p.txt 360浏览器
                          p.txt 地址栏输入se://plugins/
                          img.common-pd(src="../../img/homework/help/help-14.png")
                    li.subtitle-box
                      .subtitle(@click.stop.self="toggleDetail($event)") 套圈拉动物卡住
                      .detail
                        .box
                          p.txt 如果卡在类似下图的地方，很可能是连续点击造成的。请点击一次后等待声音播放完成后再点击。
                          img.common-pd(src="../../img/homework/help/help-15.png")
                    li.subtitle-box
                      .subtitle(@click.stop.self="toggleDetail($event)") Surface设备做作业拖拽困难
                      .detail
                        .box
                          p.txt.common-pd 由于作业系统当前对Surface设备的触屏功能支持不够完善，请插上鼠标后再做作业。
                li.title#title_2(@click = "openSub('3')")
                  .name(data_num=2) 下载问题
                    i.icon
                  ul.subtitle-con(v-show="isShowSub3")
                    li.subtitle-box
                      .subtitle(@click.stop.self="toggleDetail($event)") 下载失败
                      .detail
                        .box
                          p.txt VIPKID上课助手——关闭上课助手，找安装目录下的文件夹\resources\app\dl，删除原来所有文件，重新打开上课助手，重新下载作业。
                          p.txt VIPKID学习中心PC客户端——关闭客户端，找安装目录下的文件夹\resources\app\homework，删除原来所有文件，重新打开客户端，重新下载作业。
                          p.txt 查看安装目录的办法：
                          img(src="../../img/homework/help/help-30.png")
                          p.txt 1）点击上图属性
                          img(src="../../img/homework/help/help-31.png")
                          p.txt.common-pd 2）点击上图“打开文件所在的位置”
                    li.subtitle-box
                      .subtitle(@click.stop.self="toggleDetail($event)") 下载缓慢
                      .detail
                        .box
                          p.txt 保证网络带宽正常。
                          p.txt.common-pd 关闭其他下载软件。
                    li.subtitle-box
                      .subtitle(@click.stop.self="toggleDetail($event)") 一直转圈
                      .detail
                        .box
                          p.txt 如果打开某个作业或者跳转到某一题的时候一直在转圈，请尝试 <br>检查网络，保证网络畅通<br>清除浏览器缓存，如下图
                          img(src="../../img/homework/help/help-33.png")
                          p.txt.common-pd 联系客服修改DNS配置
                li.title#title_3(@click = "openSub('4')")
                  .name(data_num=3) 白屏
                    i.icon
                  ul.subtitle-con(v-show="isShowSub4")
                    li.subtitle-box
                      .subtitle(@click.stop.self="toggleDetail($event)") 启动白屏
                      .detail
                        .box
                          p.txt 如下图，多数情况是网速太慢。可以尝试重启路由器，关闭下载软件或其他占网速的软件。
                          img.common-pd(src="../../img/homework/help/help-16.png")
                    li.subtitle-box
                      .subtitle(@click.stop.self="toggleDetail($event)") 中途白屏
                      .detail
                        .box
                          p.txt 尽量关闭其他运行中的软件。<br>点击后声音播放时，在声音播放完成之前，最好不要点击其他地方。<br>不要同时点击Replay和Next两个按钮，如下图。
                          img(src="../../img/homework/help/help-17.png")
                          p.txt 不要来回点击左手和右手，如下图。
                          img.common-pd(src="../../img/homework/help/help-18.png")

                li.title#title_4(@click = "openSub('5')")
                  .name(data_num=4) 卡顿
                    i.icon
                  ul.subtitle-con(v-show="isShowSub5")
                    li.subtitle-box
                      .detail2
                        .cons
                          p.txt · 请重启电脑，关闭其他运行中的软件，保证电脑有足够CPU和内存。<br>· 升级电脑硬件配置。<br>· 如果是用浏览器做作业，请清除浏览器缓存后重试。如图
                          img(src="../../img/homework/help/help-32.png")
                          img(src="../../img/homework/help/help-33.png")
                          p.txt.common-pd · 如果是用上课助手或者学习中心PC客户端，请查阅本手册“下载失败”的提示删除原来的文件后重试。
                li.title#title_5(@click = "openSub('6')")
                  .name(data_num=5) 答案问题
                    i.icon
                  ul.subtitle-con(v-show="isShowSub6")
                    li.subtitle-box
                      .detail2
                        .cons
                          p.txt 目前有很多对答案有疑问的反馈，主要是因为把多选题当成单选题，造成的误解。所有蓝色背景的都是多选题。如下图：
                          img(src="../../img/homework/help/help-36.png")
                          img(src="../../img/homework/help/help-37.png")
</template>
<script>
  import axios from 'axios'
  import cookies from 'cookies-js'
  import TopPart from '../common/top_part.vue'
  import {getDeviceType, getQueryString} from './mods/_toolsFunction.js'
  import {getHomeworkissueTag, homeworkissueSave} from './mods/_api.js'
  export default {
    data() {
      return {
        isShowSub1: false,
        isShowSub2: false,
        isShowSub3: false,
        isShowSub4: false,
        isShowSub5: false,
        isShowSub6: false,
        tags: [],
        customIssue: '',
        submitActive: false,
        isFeedBackLayerShow: false,
        isMirrorShow: false
      }
    },
    components: {
      TopPart
    },
    mounted() {
      getHomeworkissueTag().then(res => {
        let tempTags = res.data.data.tags
        for (let i = 0; i < tempTags.length; i++) {
          tempTags[i].active = false
        }
        this.tags = tempTags
      })
    },
    watch: {
      customIssue: () => {
        this.switchSubmitClass()
      }
    },
    methods: {
      selectQuestion(id) {
        for (let i = 0; i < this.tags.length; i++) {
          if (this.tags[i].id == id * 1) {
            this.tags[i].active = !this.tags[i].active
            break
          }
        }
        this.switchSubmitClass()
      },
      questionSubmit() {
        if (!this.submitActive) {
          return
        }
        let selectedIssues = []
        for (let i = 0; i < this.tags.length; i++) {
          if (this.tags[i].active) {
            let tempObj = {
              issueTagId: this.tags[i].id,
              issueTagContent: this.tags[i].title
            }
            selectedIssues.push(tempObj)
          }
        }
        let params = {
          type: getQueryString('type'),
          studentId: cookies.get('studentId'),
          homeworkId: getQueryString('homeworkid') ? getQueryString('homeworkid') : '',
          client: getDeviceType,
          model: navigator.userAgent,
          customIssue: this.customIssue,
          issues: selectedIssues
        }
        homeworkissueSave(JSON.stringify(params)).then(res => {
          // this.feedbackSuccess = true
          // this.feedbackWrapper = false
          this.isFeedBackLayerShow = false
          this.$showToast('问题反馈提交成功～<br>我们会尽快为您处理~', true)
          setTimeout(() => {
            this.isMirrorShow = false
          }, 2500)
        }).catch(error => {
          alert('网络异常，请重试！')
        })
      },
      switchSubmitClass() {
        if (this.customIssue) {
          this.submitActive = true
        } else {
          for (let i = 0; i < this.tags.length; i++) {
            if (this.tags[i].active) {
              this.submitActive = true
              break
            } else {
              this.submitActive = false
            }
          }
        }
      },
      openProblemFeedback() {
        this.isFeedBackLayerShow = true
        this.isMirrorShow = true
      },
      feedBackClose() {
        this.isFeedBackLayerShow = false
        this.isMirrorShow = false
      },
      toggleDetail(event) {
        let state = event.target.parentNode.querySelectorAll('.detail')[0].style.display
        if (!state) {
          event.target.parentNode.querySelectorAll('.detail')[0].style.display = 'block'
        } else {
          event.target.parentNode.querySelectorAll('.detail')[0].style.display = ''
        }
      },
      openSub(index) {
        this['isShowSub' + index] = !this['isShowSub' + index]
      }
    }
  }
</script>

<style lang="stylus" scoped>
  *
    box-sizing: border-box

  .help-html
    height: 100%

  .help-body
    background: #6e3883 url("../../img/homework/bg.png") no-repeat center center;
    -webkit-background-size: cover
    background-size: cover
    height: 100%
    .black-mirror
      position: fixed
      top: 0
      bottom: 0
      left: 0
      right: 0
      z-index: 2
      width: 100%
      height: 100%
      background-color: rgba(0, 0, 0, 0.7)

  .help-wrapper, .help-area
    height: 100%

  .fn-hide
    display: none !important

  .help-title
    font-size: 32px
    color: #fff
    text-align: center
    padding: 30px 0

  .container-box
    position: relative
    width: 80%
    height: 80%
    margin: 0 auto
    .feedback-base
      position: absolute
      left: 50%
      top: 50%
      border-radius: 20px
      z-index: 2
      margin-left: -308px
      margin-top: -197px
      width: 616px
      height: 395px
      a.fw-close
        position: absolute
        right: -10px
        top: -10px
        width: 40px
        height: 40px
        background: url('../../img/homework/closed.png') no-repeat center
        background-size: 40px 40px
      .fw-dinosaur
        position: absolute
        top: -80px
        left: 50%
        margin-left: -121px
        width: 242px
        height: 91px
        img
          width: 100%
      .fw-content
        width: 100%
        height: 100%
        box-sizing: border-box
        background-color: #fff
        border: 5px solid #8f82bc
        border-radius: 16px
        .fw-title-mini
          text-align: center
          color: #fff
          font-size: 24px
          background-color: #8f82bc
          height: 80px
          line-height: 80px
          height: 58px
          line-height: 58px
        .fw-title
          text-align: center
          color: #fff
          font-size: 24px
          background-color: #8f82bc
          height: 80px
          line-height: 80px
        .fw-main
          padding: 0 45px
          .fw-minititle-minihome
            font-size: 16px !important
            color: #999 !important
          .fw-minititle
            margin-top: 20px
            margin-bottom: 15px
            color: #333
            font-size: 18px
            line-height: 25px
            text-align: center
          ul.fw-errors
            margin-right: -15px
            li
              float: left
              margin-right: 12px
              margin-bottom: 20px
              width: 162px
              height: 40px
              line-height: 40px
              font-size: 18px
              color: #666
              border-radius: 30px
              border: 1px solid #d9d9d9
              text-align: center
              cursor: pointer
              &.active
              // background-color: #ff6600
                color: #ff6600
                border: 1px solid #ff6600
          .fw-type
            width: 100%
            input
              width: 100%
              height: 40px
              font-size: 18px
              border: 1px solid #d9d9d9
              border-radius: 30px
              text-indent: 20px
              color: #666
              &:focus
                outline: none
              &::placeholder
                color: #999
          .fw-submit
            margin-top: 20px
            text-align: center
            .ml-40
              margin-left: 40px
            input, a
              display: inline-block
              width: 142px
              height: 40px
              line-height: 40px
              color: #fff
              font-size: 18px
              text-decoration: none
              background: url('../../img/homework/button-disable.png') no-repeat center
              background-size: 142px 40px
              cursor: not-allowed
              border: none
              padding: 0
            input:focus
              outline: none
            input.active, a.active
              background: url('../../img/homework/button-confirmed.png') no-repeat center
              background-size: 142px 40px
              cursor: pointer
              &:hover
                background: url('../../img/homework/button-hover.png') no-repeat center
                background-size: 142px 40px
            input.visited
              background: url('../../img/homework/button-click.png') no-repeat center
              background-size: 142px 40px
    .problem-feedback
      position: absolute
      bottom: 20px
      left: 50%
      margin-left: -80px
      width: 160px
      height: 50px
      line-height: 50px
      text-align: center
      background-image: url('../../img/homework/button_l_orange_normal@2x.png')
      background-repeat: no-repeat
      background-size: 100%
      font-size: 20px
      color: #ffffff
      cursor: pointer

  .help-list-box
    background: #fff
    border: solid 7px #a18ee3
    border-radius: 12px
    margin: 0 auto
    padding: 30px 35px
    width: 100%
    border: solid 7px #a18ee3
    border-radius: 12px
    margin: 0 auto
    height: 100%
    .help-container
      overflow: auto
      width: 100%
      height: 91%
      .xifu-title
        position: absolute
        left: 0
        top: 0
        width: 100%
        background: red
        height: 30px
      h5
        font-size: 20px
        color: #2f2f2f
        padding-bottom: 5px
      .explain
        color: #595959
        font-size: 18px
        line-height: 2
        padding-bottom: 30px
        text-indent: 36px
      .list-box
        font-size: 18px
        color: #493482
        border-top: 1px solid #c1c1c1
        .title
          background: #fff
          .name
            position: relative
            background: #fff
            padding: 20px
            padding-left: 55px
            border-bottom: 1px solid #c1c1c1
            &.title-fix-style
              position: absolute
              left: 0
              top: 0px
              margin: 7px 35px 0px
              right: 0
              z-index: 10
            .icon
              position: absolute
              top: 23px
              left: 20px
              width: 16px
              height: 10px
              display: block
              cursor: pointer
              background-image: url('../../img/homework/help/arrow.png')
              background-size: cover
              transition: transform .3s
              &.active
                transform: rotate(180deg)
        .subtitle-con
          .subtitle
            position: relative
            background: #E5E2F7
            color: #717171
            padding: 0 20px
            padding-left: 55px
            height: 40px
            line-height: 40px
            font-size: 14px
            border-bottom: 1px dashed #c7c7c7
            cursor: pointer
            background-image: url('../../img/homework/help/icon-img.png')
            background-size: 22px auto
            background-position: 23px 9px
            background-repeat: no-repeat
          .cons
            width: 80%
            margin: 0 auto
            .txt
              font-size: 16px
              color: #373737
              line-height: 1.5
              padding-top: 10px
              padding-bottom: 5px
          .detail2
            background-color: #fafafa
            .box
              width: 80%
              margin: 0 auto
            .txt
              font-size: 16px
              color: #373737
              line-height: 1.5
              padding-top: 10px
              padding-bottom: 5px
            img
              display: block
              width: 100%
              padding: 10px 0
            .common-pd
              padding-bottom: 26px
          .detail
            background-color: #fafafa
            display: none
            .box
              width: 80%
              margin: 0 auto
            .txt
              font-size: 16px
              color: #373737
              line-height: 1.5
              padding-top: 10px
              padding-bottom: 5px
            img
              display: block
              width: 100%
              padding: 10px 0
            .common-pd
              padding-bottom: 26px

  .container-box-pc .list-box
    .title .name:hover
      background: #efefef
    .subtitle-con .subtitle:hover
      background-color: #dfd9f8

  /* pad css */
  .container-box-pad
    width: 90%


</style>
