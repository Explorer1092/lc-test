//周打卡组件
<template lang="jade">
  .week-check-model
    .tip 每周坚持两节课
    .box
      .circle-bg(:style="{backgroundColor:states[currentLevel].bgColor}")
        .step(@click="openIt",@mouseleave="isShowTip=false")   
          //本周签到成功tip
          transition(enterActiveClass="animated fadeInUp",leaveActiveClass="animated fadeOutDown")
            tip.little-tip(v-if="isShowTip",type="while-top",:style="tipNumber>2?{width:'115px',left:'-13px',top:'-35px'}:''")
              span(v-html="currentTipText")   
          .icon
            .sign(:class="treasureBoxCount > 0?states[currentLevel].openClass:states[currentLevel].closeClass")
              number.box-number(v-if="treasureBoxCount>0",type="orange",:number="treasureBoxCount.toString()")
          svg.step-body(version="1.1",xmlns="http://www.w3.org/2000/svg")
            defs
              linearGradient(x1="1",y1="0",x2="0",y2="0",id="gradient1")
                stop(offset="0%",:stop-color="states[currentLevel].endColor")
                stop(offset="100%",:stop-color="states[currentLevel].midColor")
              linearGradient(x1="1",y1="0",x2="0",y2="0",id="gradient2")
                stop(offset="0%",:stop-color="states[currentLevel].startColor")
                stop(offset="100%",:stop-color="states[currentLevel].midColor")
            g(transform="matrix(0,-1,1,0,65,65)")
              circle.c1(cx="0" cy="0",r="62.5",stroke-width="6",stroke="url('#gradient1')",fill="none",:stroke-dasharray="100*(step%4)+' 400'")
              circle.c2(cx="0" cy="0",r="62.5",stroke-width="6",stroke="url('#gradient2')",fill="none",:stroke-dasharray="(step%4)<3?100*(step%4)+' 400':200+' 400'")
        .mask(:style="{backgroundColor:states[currentLevel].maskColor}")
        .success(v-for="i in 4",:style="step%4>=i?{backgroundColor:states[currentLevel].btnColor}:''")
          span(v-if="i!=step%4") {{i}}
          img(v-if="i==step%4",src="../../../img/hot_activity/window_chose@2x.png")
</template>
<script>
  import formurlencoded from "form-urlencoded"
  import tip from "../../common/vk_tip.vue"
  import axios from 'axios'
  import cookies from 'cookies-js'
  import number from '../../common/vk_number.vue'
  export default {
    data() {
      return {
        isShowTip: false,
        currentTipText: "",
        tipNumber: 0,
        tipTexts: [
          "本周签到成功~",
          "再坚持4周，养成好习惯，连续达标获得的奖励能翻倍哦",
          "再坚持4周，养成好习惯，连续达标获得的奖励能更多哦",
          "连续四周打卡<br/> 领取<span style='color: #ff6600'>400～600</span>能量石",
          "连续四周打卡<br/> 领取<span style='color: #ff6600'>600～900</span>能量石"
        ],
        checkWeek: 0,
        states: [
          {
            startColor: "#D2DD68",
            midColor: "#9ad987",
            endColor: "#58D6AE",
            btnColor: "#58D6AE",
            closeClass: "sign-1-close",
            openClass: "sign-1-open",
            bgColor: "rgba(255,255,255,0.4)",
            maskColor: "#b9aee9"
          },
          {
            startColor: "#FFF053",
            midColor: "#ffba53",
            endColor: "#FF7B54",
            btnColor: "#FF7B54",
            closeClass: "sign-2-close",
            openClass: "sign-2-open",
            bgColor: "rgba(255,140,84,0.4)",
            maskColor: "rgb(185, 128, 165)"
          }
        ],
        //分两个级别，4周连续打开以内是第一级，4周以上是第二级
        currentLevel: 0
      }
    },
    props: {
      //第几步成功了
      step: {
        type: Number,
        default: 0
      },
      //可领取宝箱数量
      treasureBoxCount: {
        type: Number,
        default: 0
      },
      //本周是否已打卡
      isCurrentWeek: {
        type: Boolean,
        default: false
      }
    },
    components: {
      tip, number
    },
    methods: {
      openIt(){
        if (this.treasureBoxCount > 0) {
          this.$emit("openIt")
        } else {
          this.isShowTip = true
          if (this.step < 5) {
            this.tipNumber = 3
            this.currentTipText = this.tipTexts[3]
          } else {
            this.tipNumber = 4
            this.currentTipText = this.tipTexts[4]
          }
        }
      }
    },
    watch: {
      isCurrentWeek: function (n, o) {
        if (n) {
          setTimeout(() => {
            this.isShowTip = true
            this.currentTipText = this.tipTexts[0]
            setTimeout(() => {
              this.isShowTip = false
            }, 2000)
          }, 2000)
        } else {
          this.isShowTip = false
        }
      },
      step: function (n, o) {
        this.currentLevel = n < 5 ? 0 : 1
      }
    }
  }
</script>
<style lang="stylus" scoped>
  .week-check-model
    position: relative
    height: 180px
    width: 180px
    text-align: center
    background: rgba(142, 123, 225, 0.9)
    border-radius: 45px

  .tip
    position: absolute
    height: 34px
    width: 130px
    background: rgb(133, 97, 237)
    border-radius: 17px
    top: -25px
    left: 26px
    color: #ffffff
    font-size: 16px
    line-height: 34px

  .little-tip
    width: 90px
    left: 0
    top: -23px

  .box
    display: inline-block
    width: 152px
    height: 152px
    margin: 14px auto

  .circle-bg
    width: 100%
    height: 100%
    border-radius: 50%
    background: rgba(255, 255, 255, 0.4)
    .step
      position: relative
      display: inline-block
      width: 120px
      height: 120px
      border: solid #DBDBC9 5px
      border-radius: 50%
      margin: 10px auto
      cursor: pointer
      .icon
        box-sizing: border-box
        width: 100px
        height: 100px
        margin: 10px auto
        border-radius: 50%
        background: #4a378c
        padding-top: 6px
      .box-number
        position: absolute
        bottom: -10px
        right: -78px
        transform: scale(0.5)
        width: 150px
      .sign
        background: url(../../../img/hot_activity/week_check_icon.png)
        height: 81px
        width: 80px
        margin: auto
        transform-origin: 50% 10%
      .sign-1-close
        background-position: -110px -10px
      .sign-1-open
        background-position: -10px -10px
        animation: leftRight 1s ease infinite
      .sign-2-close
        background-position: -110px -111px
      .sign-2-open
        background-position: -10px -111px
        animation: leftRight 1s ease infinite

    .mask
      position: absolute
      display: block
      height: 15px
      width: 15px
      top: 20px
      right: 70px

    .success
      position: absolute
      height: 20px
      width: 20px
      border-radius: 50%
      color: #ffffff
      line-height: 20px
      font-size: 14px
      background-color: #DBDBC9
      img
        width: 25px
        margin-top: -8px

    .step-body
      position: absolute
      width: 132px
      height: 132px
      top: -5px
      left: -5px
      transform: rotate(-0.05deg)

    .c1
      transition: stroke-dasharray 2s
    .c2
      transition: stroke-dasharray 1s

    .success:nth-child(3)
      top: 80px
      right: 19px
    .success:nth-child(4)
      bottom: 18px
      right: 80px
    .success:nth-child(5)
      top: 80px
      left: 18px
    .success:nth-child(6)
      top: 17px
      right: 80px

    @keyframes leftRight
      0%
        transform: scale(0.98)
      20%
        transform: scale(1.05)
      100%
        transform: scale(0.98)

</style>
