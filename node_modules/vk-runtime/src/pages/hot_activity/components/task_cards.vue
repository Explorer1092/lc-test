//任务卡列表组件
<template lang="jade">
    .task-card
        .task-list
            .task-container
                .task-list-content#task-list-content(ref="islandWrapper")
                    .task-list-long#task-list-long(ref="taskList")
                        .task-list-each(
                        :id="'task-list-each-' + (index + 1)"
                        v-show="isShowTaskList && !item.ifShowDetail",
                        v-for="(item,index) in listImpels",
                        :class="{'task-list-each-animation':item.taskStatus && item.ifShowNewIcon,'task-list-each-many':item.isShowMany,'task-list-each-nobutton':(!item.buttonStatusAll && !item.buttonStatusReceive&& !item.buttonStatusLeave),'list-detail-each-done':item.buttonStatusDone,'list-detail-each-over':item.buttonStatusOver,'task-list-each-motivate':item.taskStatus,'task-list-each-nobutton-status':item.taskNoButton}")
                            img.task-list-each-detail-sign(src="../../../img/hot_activity/hot-activity-detail.png",v-if="item.taskStatus && item.extraDesc",@click="showListDetailSign(item.appointName,item.extraDesc)")
                            img.task-list-each-detail-sign-course(src="../../../img/hot_activity/hot-activity-normal-detail.png",v-if="item.isShowMany && item.extraDesc",@click="showListDetailSign(item.name,item.extraDesc)")
                            img.task-list-each-detail-sign(src="../../../img/hot_activity/hot-activity-normal-detail.png",v-if="!item.taskStatus && !item.isShowMany && item.extraDesc",@click="showListDetailSign(item.name,item.extraDesc)")
                            img.task-list-each-detail-sign-new(src="../../../img/hot_activity/hot-activity-card-new.png",v-if="item.taskStatus&&item.viesStatus=='NEW'")
                            .task-list-each-status-new(v-if="item.taskStatus && item.ifShowNewIcon")
                            .task-list-each-title(v-if="item.isShowMany", :class="{'task-list-each-title-visited': item.hasVisited}")
                                .task-list-each-title-unit {{item.nameList[0]}}
                                .task-list-each-title-lesson Lesson
                                    .task-list-each-title-lesson-num
                                        span {{item.nameList[1]}}
                                .task-list-each-detail {{item.scheduledDate}}
                            span.task-list-each-icon(:style="item.imgUrl?{backgroundImage:'url('+item.imgUrl+')'}:''")
                            p.task-list-each-name(:title="item.overTopTitle", v-if="!item.isShowMany") {{item.name}}
                            p.task-list-each-name-desc(v-if="item.taskStatus && item.appointDesc") {{item.appointDesc}}
                            p.task-list-each-detail(v-show="!item.isShowMany && !item.taskStatus") {{item.activityDesc}}
                            //- p.task-list-each-detail-number(v-show="!item.isShowMany && item.taskStatus && [1, 2].indexOf(item.taskStatus) !== -1") 100人参加
                            // .task-list-each-number
                            //     i.icon()
                            //     span(v-if="!item.taskStatus") +
                            //     span.number(:class="{'number-margin':item.taskStatus}") {{item.totalEggshellNumber}}
                            .task-list-each-number(v-if="item.taskStatus")
                                i.iconStone(v-if="item.awardJson[0].awardType=='EGGSHELL' ")
                                i.iconStart(v-if="item.awardJson[0].awardType=='STAR'")
                                i.iconCard(v-if="item.awardJson[0].awardType=='EGREETING_CARD'")
                                  img.task-list-iconcard(:src="item.awardJson[0].awardPic",@click="showcardTip(index)",@mouseleave="isShowTip=false")
                                span(v-if="item.awardJson[0].awardType!='EGGSHELL' ") +
                                span(v-if="item.awardJson[0].awardType=='EGGSHELL' ").number {{item.awardJson[0].awardMinNumber}}-{{item.awardJson[0].awardMaxNumber}}
                                span(v-if="item.awardJson[0].awardType!='EGGSHELL' ").number {{item.awardJson[0].awardNumber}}
                                transition(enterActiveClass="animated fadeInDown",leaveActiveClass="animated fadeOutUp")
                                  .task-list-tip(v-if="isShowTip && index==showTipnumber")
                                    img.task-list-tip-img(:src="item.awardJson[0].awardPic")
                                    span.task-list-tip-name {{item.awardJson[0].awardName}}
                                    .task-list-tip-arror

                            .task-list-each-number(v-if="!item.taskStatus")
                                i.iconStone
                                span +
                                span.number {{item.totalEggshellNumber}}
                            .task-list-each-button(v-if="item.taskStatus === 2",@click.stop="applyNewTask(item.id,item.signUpDesc)") 我要报名
                            .task-list-each-button.task-list-each-button-disable(v-if="item.taskStatus === 1") 报名成功
                            .task-list-each-button.task-list-each-button-receive(v-if="item.taskStatus === 4",@click.stop="getNewTaskGift(item.id,item.awardJson[0].awardType)") 领取奖励<!--定向-->
                            .task-list-each-button(v-if="item.buttonStatusAll && item.isShowMany",@click="showListDetailContent(item, index)") 查看全部
                            .task-list-each-button.task-list-each-button-receive(v-if="item.buttonStatusReceive && item.isShowMany",@click="showListDetailContent(item, index)") 领取课程奖励
                            .task-list-each-button.task-list-each-button-receive(v-if="!item.taskStatus && !item.isShowMany && item.buttonStatusLeave",@click="openListLeave(item.redirectUrl)") 前往<!--普通-->
                            .task-list-each-button.task-list-each-button-receive(v-if="item.taskStatus && item.source && item.redirectUrl && item.taskStatus === 3",@click="openListLeave(item.redirectUrl)") 前往<!--定向-->
                            .task-list-each-button.task-list-each-button-receive(v-if="!item.taskStatus && !item.isShowMany&& !item.buttonStatusLeave  && item.buttonStatusReceive ",@click="openListBox(item,$event)") 领取奖励<!--普通-->
                            .task-list-each-new-progress(v-if="item.taskStatus && [3,4].indexOf(item.taskStatus) !== -1")
                                .progress-day(v-if="item.taskProgress<=item.taskCourseCount",:style="{'width':item.progressNum+'px'}")
                                .progress-all(v-if="item.taskProgress<=item.taskCourseCount")
                                span.progress-size {{item.taskProgress}}/{{item.taskCourseCount}}
                            .task-list-each-new-progress(v-if=" item.activityConfigType == 'ACTIVITY_TASK' && item.showProgress=='YES' && !item.buttonStatusDone && !item.buttonStatusOver")
                                .progress-day(:style="{'width':item.progressNum+'px'}")
                                .progress-all
                                span.progress-size {{item.currentProgress}}/{{item.progressCount}}
                            .task-list-each-date(v-show="!item.taskStatus && item.ifDate") {{item.difference}}天后过期
                            .task-list-each-date-new-task(v-show="item.taskStatus && item.ifDate && item.dateText")
                                span {{item.dateText}}
                            .task-list-each-status(:class="{'task-list-each-status-done':item.buttonStatusDone,'task-list-each-status-over':item.buttonStatusOver}")
                .task-list-arrow
                    .task-arrow-left(:class="{'scroll-disable' : isScrollDisableLeft}", @click="windowScrollLeft")
                    .task-arrow-right(:class="{'scroll-disable' : isScrollDisableRight}", @click="windowScrollRight")
                .task-list-default(v-show="taskListDefault")
                    span
                    .task-list-default-p
                        p 小朋友目前还没有要完成的任务哦～
                        p 快去预约有趣的课程吧
        .list-detail-content(ref="listDetail",v-show="ListDetailContent")
            .list-detail-wrapper
                .list-detail-title
                    p {{listDetailTitle}}
                .list-detail-close(@click="closeListDetail")
                .list-detail-after
                .list-detail-container
                    .list-detail-middle#list-detail-middle(ref="islandWrapper2")
                        .list-detail-long#list-detail-long
                            .task-list-each.list-detail-each(
                            :id="'list-detail-each-' + item.eachIndex + '-' + (index + 1)",
                            :class="{'task-list-each-nobutton':(!item.buttonStatusAll && !item.buttonStatusReceive),'list-detail-each-done':item.buttonStatusDone,'list-detail-each-over':item.buttonStatusOver,'float-none':item.ifNotFloat}",
                            v-for="(item,index) in listDetailImpels")
                                span.task-list-each-icon(:class="'list-detail-icon-' + item.activityConfigId")
                                p.task-list-each-name {{item.name}}
                                p.task-list-each-detail {{item.activityDesc}}
                                .task-list-each-number(v-if="item.totalEggshellNumber>0")
                                    i.icon
                                    span +
                                    span.number {{item.totalEggshellNumber}}
                                .task-list-each-button.task-list-each-button-receive(
                                class="list-evaluate-teacher",
                                :id="'list-detail-button-' + item.eachIndex + '-' + (index + 1)",
                                v-if="item.evaluateTeacher",@click="goToEvaluate(item.onlineClassId)") Go
                                .task-list-each-button(
                                :id="'list-detail-button-' + item.eachIndex + '-' + (index + 1)"
                                v-if="item.buttonStatusAll",@click="openListDetailBox(item,$event)") 查看全部
                                .task-list-each-button.task-list-each-button-receive(
                                :id="'list-detail-button-' + item.eachIndex + '-' + (index + 1)"
                                v-if="item.buttonStatusReceive",@click="openListDetailBox(item,$event)") 领取奖励
                                .task-list-each-date(v-show="item.ifDate && item.buttonStatusReceive") {{item.difference}}天后过期
                                .task-list-each-status(:class="{'task-list-each-status-done-course':item.activityTreasureBoxStatus=='OPEN'}")
                    .list-detail-arrow(v-show="listDetailArrow")
                        .list-detail-arrow-left(@click="listDetailArrowLeft")
                        .list-detail-arrow-right(@click="listDetailArrowRight")
        //激励任务通告提示
        motivate-task-notice(v-if="isShowMotivateTaskNoticeComputed",:noticeText="motivateTaskNoticeText",:posterImgSrc="motivateTaskPosterImgSrc",
        :noticeType="motivateTaskNoticeType",@closeIt="closeMotivateTaskNotice")
        my-dialog(v-if="ListDetailSign", :tipText="this.tipText", :confirmButton="'我知道了'", :type="'alert'", :title="this.tiptitle",isShowTitle = true,@library-dialog-cancel="reloadPage",@library-dialog-close="reloadPage",class="dialog-scroll")

</template>
<script>
  import axios from 'axios'
  import formUrlEncoded from 'form-urlencoded'
  import cookies from 'cookies-js'
  import {deepCopy, getMonthDays, localStorageUtil, getStrLength} from '../../../utils/_untils'
  // 激励任务的通告
  import motivateTaskNotice from './motivate_task_notice.vue'
  import myDialog from "../../readers/common/dialog.vue"
  export default {
    props: {
      toastRegulator: {
        type: String,
        default: ''
      }
    },
    data: function () {
      return {
        lessonVisitedCards: [], //课程类复卡被点击过的lessonId
        applyNewTaskId: -1, //报名任务的id
        motivateTaskNoticeText: '', //定向激励弹出层提示文本
        motivateTaskPosterImgSrc: '', // 定向激励海报图片地址
        motivateTaskNoticeType: 'notice-message', // 定向激励通告类型
        isShowMotivateTaskNotice: false, // 显示激励任务通告
        //list数组
        listImpels: [],
        //task-list-default显示与否
        taskListDefault: false,
        //是否显示list标签
        isShowTaskList: false,
        //list细节数组
        listDetailImpels: [],
        //list 详情页arrow是否显示
        listDetailArrow: false,
        //list detail content是否显示
        ListDetailContent: false,
        //list detail title内容
        listDetailTitle: null,
        isScrolling: false,
        //卡片列表禁止向左滑动
        isScrollDisableLeft: true,
        //卡片列表禁止向右滑动
        isScrollDisableRight: false,
        ListDetailSign:false,
        tiptitle:'',
        tipText:'',
        taskNoButton:false,
        isShowTip:false,
        showTipnumber:0
      }
    },
    components: {
      motivateTaskNotice,
      myDialog
    },
    computed: {
      isShowMotivateTaskNoticeComputed() {
        if (this.isShowMotivateTaskNotice && this.motivateTaskNoticeType === 'notice-poster') {
          if (this.toastRegulator === 'motivate') {
            sa.track('learning_click', {'click_id': 'pc_learning_motivate_acitivity_show_new_task_poster_toast'})
          }
          return this.toastRegulator === 'motivate'
        } else {
          return this.isShowMotivateTaskNotice
        }
      }
    },
    mounted () {
      this.getTaskListData()
      this.checkShowMotivatePoster()
    },
    methods: {
      openBox(activityTreasureBoxId){
        axios.post("/rest/learninggw/api/point/activity/treasureBox/openByIdAndStudentId", formUrlEncoded({
          studentId: cookies.get("studentId"),
          id: activityTreasureBoxId
        })).then(res => {
          if (res.data.code == 200 && res.data.data) {
            this.$playSound("openImpel")
            this.closeListDetail()
            this.getTaskListData()
            this.$emit("afterOpenBox", res.data.data.toString())
          } else {
            this.$showToast("领取失败了")
          }
        })
      },
      reloadPage(){
        this.ListDetailSign=false
      },
      showListDetailSign(name,desc){
        this.ListDetailSign=true
        this.tiptitle=name
        this.tipText=desc
      },
      openListLeave(url){
        if(url.indexOf('http')>-1){
          window.location.href=url
          // window.location.href=url+ "?previous_url=" + encodeURIComponent(window.location.href)
          let dtRoute = url.split('vipkid.com.cn')[1]
          this.$router.push(dtRoute)
          console.log(dtRoute)
        }else{
          window.location.href='https://'+url
          let dtRoute = url.split('vipkid.com.cn')[1]
          this.$router.push(dtRoute)
          console.log(dtRoute)
          // window.location.href='https://'+url+ "?previous_url=" + encodeURIComponent(window.location.href)
        }
      },
      showcardTip(index){
        this.showTipnumber=index
        this.isShowTip=true
      },
      //获取task card 列表
      getTaskListData(){
        let promise = axios.get("/rest/learninggw/api/point/activity/homePage/getTaskListByStudentId", {
          params: {
            studentId: cookies.get("studentId")
          }
        })
        promise.then(res => {
          if (res.data.code == 200 && res.data.data && res.data.data.length) {
            let listArrayNew = res.data.data
            let listArrayNewFilter = []
            this.isShowTaskList = true
            for (let i = 0; i < listArrayNew.length; i++) {
              let item=listArrayNew[i]
              if(item.taskProgress&&item.taskCourseCount){
                item.progressNum=(item.taskProgress/item.taskCourseCount)*60
              }else if(item.currentProgress&&item.progressCount){
                item.progressNum=(item.currentProgress/item.progressCount)*60
              }else{
                item.progressNum=0
              }
              // 转换时间戳
              let expireDate = this.timestampToTime(listArrayNew[i].expireDateTime)
              listArrayNew[i].expireDate = expireDate
              let serverDate = this.timestampToTime(listArrayNew[i].serverDateTime)
              listArrayNew[i].serverDate = serverDate
              let activityConfigType = listArrayNew[i].activityConfigType
              if (activityConfigType === 'ACTIVITY_APPOINT_TASK') {
                // 定向激励任务逻辑
                if (listArrayNew[i].signUpStartDateTime >= listArrayNew[i].serverDateTime) {
                  //报名时间还没到 该卡片隐藏掉
                  continue
                } else {
                  listArrayNew[i].ifShowDetail = false
                  listArrayNew[i].isShowMany = false
                  listArrayNew[i].name = listArrayNew[i].appointName || ''
                  if (getStrLength(listArrayNew[i].appointDesc) > 20) {
                    listArrayNew[i].overTopTitle = listArrayNew[i].appointDesc
                  }
                  listArrayNew[i].totalEggshellNumber = `${listArrayNew[i].eggshellNumberMin}~${listArrayNew[i].eggshellNumberMax}`
                  // 是否是新任务
                  listArrayNew[i].ifShowNewIcon = listArrayNew[i].viewStatus === 'NEW' || false
                  listArrayNew[i].buttonStatusAll = true
                  listArrayNew[i].buttonStatusReceive = true
                  listArrayNew[i].taskNoButton = false

                  // 活动的图片
                  listArrayNew[i].imgUrl = encodeURI(listArrayNew[i].cardImg) || ''
                  // 分类活动状态
                  listArrayNew[i] = this.filterMotivateTasksItem(listArrayNew[i])
                  if (listArrayNew[i].taskStatus > 0) {
                    listArrayNewFilter.push(listArrayNew[i])
                    // 非状态零的情况显示
                    sa.track('learning_click', {'click_id': 'pc_learning_motivate_acitivity_show_task_card_id_' + listArrayNew[i].id})
                  }
                }
              } else {
                // 非定向激励任务逻辑
                // 新增 判断listdetail是否为空
                let ArrayDetailList = listArrayNew[i].activityCourseDetailDTOList
                if (Array.isArray(ArrayDetailList) && ArrayDetailList.length == 0) {
                  listArrayNew[i].ifShowDetail = true
                } else {
                  listArrayNew[i].ifShowDetail = false
                }
                if (activityConfigType == 'ACTIVITY_TASK') {
                  listArrayNew[i] = this.filterMotivateTasksItemtask(listArrayNew[i])
                  listArrayNew[i].isShowMany = false //单组卡list 不能点开详情detail 没有status类 根据activityTreasureBoxStatus判断button
                  listArrayNew[i].buttonStatusAll = false
                  listArrayNew[i].buttonStatusLeave = false
                  if (listArrayNew[i].showRedirect == 'YES' && listArrayNew[i].redirectUrl) {
                    listArrayNew[i].buttonStatusLeave = true
                  }else{
                    listArrayNew[i].buttonStatusLeave = false
                  }
                  if (listArrayNew[i].activityTreasureBoxStatus == 'CLOSE') {
                    listArrayNew[i].buttonStatusReceive = true
                  } else if (!listArrayNew[i].activityTreasureBoxStatus) {
                    listArrayNew[i].buttonStatusReceive = false
                  } else if (listArrayNew[i].activityTreasureBoxStatus == 'OPEN') {
                    listArrayNew[i].buttonStatusReceive = false
                    listArrayNew[i].buttonStatusDone = true
                  } else if (listArrayNew[i].activityTreasureBoxStatus == 'EXPIRE') {
                    listArrayNew[i].buttonStatusReceive = false
                    listArrayNew[i].buttonStatusOver = true
                  }else if (!listArrayNew[i].activityTreasureBoxStatus){
                    if(!listArrayNew[i].redirectUrl){
                      listArrayNew[i].buttonStatusLeave = false
                      listArrayNew[i].buttonStatusReceive = false
                    }
                  }

                } else if (activityConfigType == 'COURSE') {
                  listArrayNew[i].isShowMany = true //多组list 卡堆 能点开详情detail 根据status判断button
                  if (listArrayNew[i].status == 'CLOSE') {
                    listArrayNew[i].buttonStatusAll = false //list卡堆上的button是否显示
                    listArrayNew[i].buttonStatusReceive = true
                  } else if (!listArrayNew[i].status) {
                    listArrayNew[i].buttonStatusAll = true
                    listArrayNew[i].buttonStatusReceive = false
                  }
                  listArrayNew[i].scheduledDate = this.timeToDate(listArrayNew[i].scheduledDateTime)
                  listArrayNew[i].nameList = listArrayNew[i].name.split('Lesson')
                  if (this.lessonVisitedCards.indexOf(listArrayNew[i].lessonId) !== -1) {
                    listArrayNew[i].hasVisited = true
                  }
                }
                // 时间处理逻辑
                if (listArrayNew[i].expireDate[0].M == listArrayNew[i].serverDate[0].M) {

                  let difference = listArrayNew[i].expireDate[0].D - listArrayNew[i].serverDate[0].D //日期差

                  listArrayNew[i].difference = difference //日期差
                  if (difference < 15) {
                    listArrayNew[i].ifDate = true //是否显示倒计时
                  } else {
                    listArrayNew[i].ifDate = false //是否显示倒计时
                  }
                } else {
                  //这个月有多少天
                  let currentDay = getMonthDays(listArrayNew[i].serverDate[0].M)
                  let lastMonthDiff = currentDay - listArrayNew[i].serverDate[0].D //上个月剩余天数
                  let difference = lastMonthDiff + listArrayNew[i].expireDate[0].D //总差别天数

                  listArrayNew[i].difference = difference //日期差
                  if (difference < 15) {
                    listArrayNew[i].ifDate = true //是否显示倒计时
                  } else {
                    listArrayNew[i].ifDate = false //是否显示倒计时
                  }
                }
                listArrayNew[i].eachIndex = i
                listArrayNewFilter.push(listArrayNew[i])
              }
            }
            this.listImpels = listArrayNewFilter
            // 修改list区域的长度
            let listImpelsLength = this.listImpels.length
            if (listImpelsLength >= 4) {
              document.getElementsByClassName('task-list-long')[0].style.minWidth = (listImpelsLength * 220) + 'px'
            }
            this.isScrollDisableRight = document.getElementsByClassName('task-list')[0].offsetWidth > 1012 ? listImpelsLength <= 5 : listImpelsLength <= 4
          } else {
            this.taskListDefault = true
          }
        })
      },
      filterMotivateTasksItem(item) {
        let sta=item.serverDate[0]
        let end
        let timedown=false
        let timeup=false
        switch(true) {
        case (item.status === 'WAIT_SIGN_UP' && item.signUpStartDateTime <= item.serverDateTime && item.serverDateTime < item.signUpEndDateTime) || (item.status === 'COMPLETE' && !item.signUpDateTime && item.serverDateTime < item.expireDateTime):
          //我要报名---报名还有6天结束
          item.taskStatus = 2
          item.buttonStatusDone = false
          item.buttonStatusOver = false
          item.ifDate = false
          end=this.timestampToTime(item.signUpEndDateTime)[0]
          timedown=(end.Y-sta.Y)*12+(end.M-sta.M)>1
          timeup=(end.Y-sta.Y)*12+(end.M-sta.M)==1&&(end.D-sta.D>0)
          if( timedown || timeup ){
            item.dateText=''//超过30天不显示倒计时
          }else{
            item.dateText = `报名还有${this.getMotivateCountdown(sta,end)}结束`
          }
          break
        case item.status === 'SIGN_UP' && item.serverDateTime < item.appointStartDateTime:
          // 报名成功---任务将在6天后开始
          item.taskStatus = 1
          item.buttonStatusDone = false
          item.buttonStatusOver = false
          item.ifDate = false
          end=this.timestampToTime(item.appointStartDateTime)[0]
          timedown=(end.Y-sta.Y)*12+(end.M-sta.M)>1
          timeup=(end.Y-sta.Y)*12+(end.M-sta.M)==1&&(end.D-sta.D>0)
          if( timedown || timeup ){
            item.dateText=''//超过30天不显示倒计时
          }else{
            item.dateText = `任务将在${this.getMotivateCountdown(sta,end)}后开始`
          }
          break
        case item.status === 'SIGN_UP' && item.appointStartDateTime <= item.serverDateTime && item.serverDateTime < item.appointEndDateTime:
          // 学习中---任务将在6天后截止
          item.taskStatus = 3
          item.buttonStatusDone = false
          item.buttonStatusOver = false
          item.ifDate = true
          if(item.source && item.redirectUrl){
            item.taskNoButton=false
          }else{
            item.taskNoButton=true
          }
          end=this.timestampToTime(item.appointEndDateTime)[0]
          timedown=(end.Y-sta.Y)*12+(end.M-sta.M)>1
          timeup=(end.Y-sta.Y)*12+(end.M-sta.M)==1&&(end.D-sta.D>0)
          if( timedown || timeup ){
            item.dateText=''//超过30天不显示倒计时
          }else{
            item.dateText = `任务将在${this.getMotivateCountdown(sta,end)}后截止`
          }
          break
        case item.status === 'COMPLETE' && item.activityAppointTreasureBoxStatus === 'CLOSE' && item.serverDateTime < item.expireDateTime:
          // 待领取---6天后过期

          item.taskStatus = 4
          item.buttonStatusDone = false
          item.buttonStatusOver = false
          item.ifDate = true

          end=item.expireDate[0]
          timedown=(end.Y-sta.Y)*12+(end.M-sta.M)>1
          timeup=(end.Y-sta.Y)*12+(end.M-sta.M)==1&&(end.D-sta.D>0)
          if( timedown || timeup ){
            item.dateText=''//超过30天不显示倒计时
          }else{
            item.dateText = `${this.getMotivateCountdown(sta,end)}后过期`
          }
          break
        case item.status === 'COMPLETE' && item.activityAppointTreasureBoxStatus === 'OPEN':
          // 已领奖
          item.taskStatus = 5
          item.buttonStatusDone = true
          item.buttonStatusOver = false
          break
        case item.appointEndDateTime < item.serverDateTime:
          // 活动结束
          item.taskStatus = 6
          item.buttonStatusDone = false
          item.buttonStatusOver = true
          break
        default:
          item.taskStatus = 0
        }
        return item
      },
      filterMotivateTasksItemtask(item) {
        switch(true) {
        case item.activityAppointTreasureBoxStatus === 'OPEN'&&item.serverDateTime < item.expireDateTime:
          item.buttonStatusDone = true
          item.buttonStatusOver = false
          break
        case item.expireDateTime && item.expireDateTime < item.serverDateTime:
          // 活动结束
          item.buttonStatusDone = false
          item.buttonStatusOver = true
          break
        default:
          item.buttonStatusDone = null
          item.buttonStatusOver = null
        }
        return item
      },

      doShowMotivatePoster(id, text, imgSrc) {
        this.$emit("sortAllToast", {"motivate": true})
        this.applyNewTaskId = id
        this.motivateTaskNoticeText = text
        this.motivateTaskPosterImgSrc = imgSrc
        this.showMotivateTaskNotice('notice-poster')
        //缓存定向激励新任务提示内容
        localStorageUtil.set('motivate_poster_content', JSON.stringify({
          id: id,
          text: text,
          imgSrc: imgSrc
        }))
      },
      checkShowMotivatePoster() {
        //请求有没有新任务弹窗提示
        let promise = axios.get('/rest/learninggw/api/point/activity/appoint/task/getWaitSignUpAndNeedToastList', {params: {studentId: cookies.get("studentId")}})
        promise.then((res) => {
          let hasToast = false
          if (res.data.code === 200 && Array.isArray(res.data.data) && res.data.data.length !== 0) {
            let taskArr = res.data.data
            let index = -1
            let timer = 0
            for (let i = 0; i < taskArr.length; i++) {
              // 查找到第一个需要弹出提示的任务
              if (taskArr[i].activityAppointConfig.needFirstInToast === 'YES') {
                if (taskArr[i].activityAppointConfig.signUpStartDateTime > timer) {
                  index = i
                  timer = taskArr[i].activityAppointConfig.signUpStartDateTime
                }
              }
            }
            if (index !== -1) {
              this.doShowMotivatePoster(taskArr[index].id, taskArr[index].activityAppointConfig.toastText, taskArr[index].activityAppointConfig.toastImg)
              hasToast = true
            }
          }
          if (!hasToast) {
            // 获取弹出层缓存队列
            let toastNames = localStorageUtil.get('wait_toast_names')
            let toastNamesArr = toastNames ? JSON.parse(toastNames) : []
            // 获取缓存内容
            let toastContent = localStorageUtil.get('motivate_poster_content')
            let toastContentObj = toastContent ? JSON.parse(toastContent) : null
            if (toastNamesArr[1] === 'motivate' && toastContentObj) {
              this.doShowMotivatePoster(toastContentObj.id, toastContentObj.text, toastContentObj.imgSrc)
            } else {
              this.$emit("sortAllToast", {"motivate": false})
            }
          }
        }).catch(() => {
          this.$emit("sortAllToast", {"motivate": false})
        })
      },
      closeMotivateTaskNotice(msg) {
        this.isShowMotivateTaskNotice = false
        if (msg.flag) {
          //同意挑战或接受邀请
          this.postApplyNewTask()
        }
        switch(true) {
        case msg.flag && msg.type === 1:
          sa.track('learning_click', {'click_id': 'pc_learning_motivate_acitivity_sign_up_agree'})
          break
        case !msg.flag && msg.type === 1:
          sa.track('learning_click', {'click_id': 'pc_learning_motivate_acitivity_sign_up_disagree'})
          break
        case msg.flag && msg.type === 2:
          sa.track('learning_click', {'click_id': 'pc_learning_motivate_acitivity_new_task_poster_toast_agree'})
          break
        case !msg.flag && msg.type === 2:
          sa.track('learning_click', {'click_id': 'pc_learning_motivate_acitivity_close_new_task_poster_toast'})
          break
        }
      },
      applyNewTask(id, toastText) {
        this.$playSound("click")
        // 新任务报名
        this.applyNewTaskId = id
        this.motivateTaskNoticeText = toastText
        this.showMotivateTaskNotice() //显示弹窗
        sa.track('learning_click', {'click_id': 'pc_learning_motivate_acitivity_sign_up_btn'})
      },
      getNewTaskGift(id,awardType) {
        //获取激励任务的奖励
        axios.post("/rest/learninggw/api/point/activity/appoint/treasureBox/openByActivityAppointTaskIdAndStudentId", formUrlEncoded({
          studentId: cookies.get("studentId"),
          activityAppointTaskId: id
        })).then(res => {
          if (res.data.code === 200 && res.data.data) {
            if(awardType=='EGGSHELL'){//能量石
              this.$playSound("openImpel")
              this.newTaskChangeState('gift', id)
              this.$emit("afterOpenBox", res.data.data.toString())
            }else if(awardType=='STAR'){
              this.showListDetailSign('','恭喜获得星星奖励~')
              this.newTaskChangeState('gift', id)
            }else if(awardType=='EGREETING_CARD'){
              this.showListDetailSign('','恭喜获得贺卡奖励~')
              this.newTaskChangeState('gift', id)
            }
          } else {
            this.$showToast("领取失败了")
          }
        }).catch(() => {
          this.$showToast("领取失败了")
        })
        sa.track('learning_click', {'click_id': 'pc_learning_motivate_acitivity_open_gift'})
      },
      newTaskChangeState(type, id) {
        // 定向任务卡片的状态和类型的更改
        for (let i = 0; i < this.listImpels.length; i++) {
          if (this.listImpels[i].activityConfigType === 'ACTIVITY_APPOINT_TASK' && this.listImpels[i].id === id) {
            if (type === 'signUp') {
              // 报名后的状态更改
              if (this.listImpels[i].status === 'COMPLETE') {
                this.listImpels[i].signUpDateTime = Date.parse(new Date())
              } else {
                this.listImpels[i].status = 'SIGN_UP'
              }
              this.listImpels[i].viewStatus = 'NOT_NEW'
              this.listImpels[i].ifShowNewIcon = false
              this.listImpels[i] = this.filterMotivateTasksItem(this.listImpels[i])
            } else if (type === 'gift') {
              // 领取奖励后的状态更改
              this.listImpels[i].ifDate = false
              this.listImpels[i].activityAppointTreasureBoxStatus = 'OPEN'
              this.taskNoButton=false
              this.listImpels[i] = this.filterMotivateTasksItem(this.listImpels[i])
            }
            break
          }
        }
      },
      postApplyNewTask() {
        // 定向激励活动报名
        if (this.applyNewTaskId === -1) {
          return
        }
        //发送报名请求
        axios.post("/rest/learninggw/api/point/activity/appoint/task/signUpTask", formUrlEncoded({
          studentId: cookies.get("studentId"),
          id: this.applyNewTaskId
        })).then(res => {
          if (res.data.code === 200) {
            // 刷新列表
            this.newTaskChangeState('signUp', this.applyNewTaskId)
            // 获取定向激励新任务提示缓存内容
            let toastContent = localStorageUtil.get('motivate_poster_content')
            let toastContentObj = toastContent ? JSON.parse(toastContent) : null
            let toastNames = localStorageUtil.get('wait_toast_names')
            let toastNamesArr = toastNames ? JSON.parse(toastNames) : []
            if (toastContentObj && toastContentObj.id === this.applyNewTaskId) {
              //如果是用户点击了报名，并且报名对象和缓存对象一致，清除缓存
              localStorageUtil.del('motivate_poster_content')
              toastNamesArr[1] = ''
              localStorageUtil.set('wait_toast_names', JSON.stringify(toastNamesArr))
            }
          } else {
            this.$showToast("报名失败了")
          }
          this.applyNewTaskId = -1
          this.motivateTaskNoticeText = ''
        }).catch(() => {
          this.$showToast("报名失败了")
          this.applyNewTaskId = -1
          this.motivateTaskNoticeText = ''
        })
      },
      showMotivateTaskNotice(msg) {
        this.motivateTaskNoticeType = msg === 'notice-poster' ? 'notice-poster' : 'notice-message'
        this.isShowMotivateTaskNotice = true
      },

      // 打开list详情页的宝箱
      openListDetailBox(item, e){
        this.openBox(item.activityTreasureBoxId)
        sa.track('learning_click', {
          'click_id': 'pc_learning_impel_box_activity_open_list_detail_box'
        })
      },
      // 打开list单卡堆的宝箱
      openListBox(item, e){
        this.openBox(item.activityTreasureBoxId)
        sa.track('learning_click', {
          'click_id': 'pc_learning_impel_box_activity_open_list_box'
        })
      },
      // list 轮播按钮
      windowScrollRight() {
        let that = this
        if (!this.isScrolling && !that.isScrollDisableRight) {
          //滚动动画停止时执行
          this.isScrolling = true
          Velocity(this.$refs.islandWrapper, "scroll", {
            axis: "x",
            container: this.$refs.islandWrapper,
            duration: 300,
            offset: 814,
            mobileHA: false,
            complete: scrollEnd
          })
        }
        function scrollEnd() {
          //滚动动画回调
          that.isScrolling = false
          if (that.$refs.islandWrapper.scrollLeft > 0 && that.isScrollDisableLeft) {
            that.isScrollDisableLeft = false
          } else if (that.$refs.islandWrapper.scrollLeft === that.$refs.taskList.offsetWidth - that.$refs.islandWrapper.offsetWidth) {
            that.isScrollDisableRight = true
          }
        }
      },
      //左右滚动
      windowScrollLeft() {
        let that = this
        if (!this.isScrolling && !that.isScrollDisableLeft) {
          //滚动动画停止时执行
          this.isScrolling = true
          Velocity(this.$refs.islandWrapper, "scroll", {
            axis: "x",
            container: this.$refs.islandWrapper,
            duration: 300,
            offset: -814,
            mobileHA: false,
            complete: scrollEnd
          })
        }
        function scrollEnd() {
          //滚动动画回调
          that.isScrolling = false
          if (that.isScrollDisableRight) {
            that.isScrollDisableRight = false
          } else if (that.$refs.islandWrapper.scrollLeft === 0) {
            that.isScrollDisableLeft = true
          }
        }
      },
      timestampToTime(timestamp) {
        //时间戳为10位需*1000，时间戳为13位的话不需乘1000
        let date = new Date(timestamp)
        let Y = date.getFullYear()
        let M = (date.getMonth() + 1 < 10 ? '0' + (date.getMonth() + 1) : date.getMonth() + 1)
        let D = date.getDate()
        let h = date.getHours()
        let m = date.getMinutes()
        let s = date.getSeconds()
        return [{
          "Y": Y,
          "M": M,
          "D": D,
          "h": h,
          "m": m,
          "s": s
        }]
      },
      timeToDate(timestamp) {
        let date = new Date(timestamp)//时间戳为10位需*1000，时间戳为13位的话不需乘1000
        let Y = date.getFullYear()
        let M = (date.getMonth() + 1 < 10 ? (date.getMonth() + 1) : date.getMonth() + 1)
        let D = date.getDate()
        let h = date.getHours()
        // let m = date.getMinutes()
        let m = (date.getMinutes() == 0 ? '0' + date.getMinutes() : date.getMinutes())
        let s = date.getSeconds()
        return M + '月' + D + '日 ' + h + ':' + m
      },
      //获取激励数据的倒计时
      getMotivateCountdown(startTimer, endTimer) {
        //规制 默认为天，倒计时小于1天的时候，文本变为还有X小时，小于1小时的时候，文本变为X分钟，小于分默认1分钟
        //相同月份
        if (startTimer.M === endTimer.M) {
          //相同日子
          if (endTimer.D === startTimer.D) {
            //相同小时
            if (endTimer.h === startTimer.h) {
              //相同分钟
              if (endTimer.m === startTimer.m) {
                return `1分钟`
              } else {
                return `${endTimer.m - startTimer.m}分钟`
              }
            } else {
              return `${endTimer.h - startTimer.h}小时`
            }
          } else {
            return `${endTimer.D - startTimer.D}天`
          }
        } else {
          //不同月份
          //转换为整数
          startTimer.M = parseInt(startTimer.M, 10)
          endTimer.M = parseInt(endTimer.M, 10)
          // 当月剩余天数
          let lastDays = getMonthDays(startTimer.M) - startTimer.D
          let count = 1
          let days = 0
          // 相隔大于一个月进入循环计算
          while (endTimer.M > (startTimer.M + count)){
            days += getMonthDays(startTimer.M + count)
            count++
          }
          return `${endTimer.D + lastDays + days}天`
        }
      },

      // 显示list详情页面
      showListDetailContent(value, index){
        this.listImpels[index].hasVisited = true
        this.lessonVisitedCards.push(value.lessonId)
        // 如果是单个卡堆 那就按照打开宝箱来处理
        // 打开详情页 如果是卡堆的话 就正常打开详情弹窗
        this.ListDetailContent = true
        this.listDetailTitle = value.name
        let ArrayListDetail = value.activityCourseDetailDTOList

        // 判断list卡堆里是否就一个卡片 让他居中
        let listDetailLength = this.count(ArrayListDetail) - 1
        if (listDetailLength == 1) {
          ArrayListDetail[0].ifNotFloat = true
        }
        for (let i = 0; i < ArrayListDetail.length; i++) {
          // 判断按钮状态
          if (ArrayListDetail[i].activityTreasureBoxStatus == 'CLOSE') {
            ArrayListDetail[i].buttonStatusReceive = true
            ArrayListDetail[i].buttonStatusAll = false
          } else if (!ArrayListDetail[i].activityTreasureBoxStatus) {
            ArrayListDetail[i].buttonStatusAll = false
            ArrayListDetail[i].buttonStatusReceive = false
          } else if (ArrayListDetail[i].activityTreasureBoxStatus == 'OPEN') {
            ArrayListDetail[i].buttonStatusAll = false
            ArrayListDetail[i].buttonStatusReceive = false
            ArrayListDetail[i].buttonStatusDone = true
          } else if (ArrayListDetail[i].activityTreasureBoxStatus == 'EXPIRE') {
            ArrayListDetail[i].buttonStatusAll = false
            ArrayListDetail[i].buttonStatusReceive = false
            ArrayListDetail[i].buttonStatusOver = true
          }
          // 转换时间戳
          let expireDate = this.timestampToTime(ArrayListDetail[i].expireDateTime)

          ArrayListDetail[i].expireDate = expireDate
          let serverDate = this.timestampToTime(ArrayListDetail[i].serverDateTime)

          ArrayListDetail[i].serverDate = serverDate

          if (ArrayListDetail[i].expireDate[0].M == ArrayListDetail[i].serverDate[0].M) {
            let difference = ArrayListDetail[i].expireDate[0].D - ArrayListDetail[i].serverDate[0].D //日期差

            ArrayListDetail[i].difference = difference //日期差
            if (difference < 15) {
              ArrayListDetail[i].ifDate = true //是否显示倒计时
            } else {
              ArrayListDetail[i].ifDate = false //是否显示倒计时
            }
          } else {
            let currentDay = getMonthDays(ArrayListDetail[i].serverDate[0].M)
            let lastMonthDiff = currentDay - ArrayListDetail[i].serverDate[0].D //上个月剩余天数
            let difference = lastMonthDiff + ArrayListDetail[i].expireDate[0].D //总差别天数
            ArrayListDetail[i].difference = difference //日期差
            if (difference < 15) {
              ArrayListDetail[i].ifDate = true //是否显示倒计时
            } else {
              ArrayListDetail[i].ifDate = false //是否显示倒计时
            }
          }
          // 给list detail Impels加一个index参数 用来区分每个list detail
          ArrayListDetail[i].eachIndex = value.eachIndex
        }

        //此处需要深拷贝
        this.listDetailImpels = deepCopy(ArrayListDetail)
        //添加学生评价老师
        if (this.checkoutTime(value.scheduledDateTime)) {
          this.listDetailImpels.push(this.addEvaluateTeacher(value.onlineClassId))
        }
        let valueLength = this.listDetailImpels.length

        if (valueLength > 2) {
          document.getElementsByClassName('list-detail-wrapper')[0].classList.add('max-detail-wrapper')
          document.getElementsByClassName('list-detail-container')[0].classList.add('max-detail-container')
          this.listDetailArrow = true
        } else {
          document.getElementsByClassName('list-detail-wrapper')[0].classList.remove('max-detail-wrapper')
          document.getElementsByClassName('list-detail-container')[0].classList.remove('max-detail-container')
          this.listDetailArrow = false
        }

        if (valueLength >= 3) {
          document.getElementsByClassName('list-detail-long')[0].style.minWidth = (valueLength * 230) + 'px'
        }

        sa.track('learning_click', {
          'click_id': 'pc_learning_impel_box_acitivity_show_list_all'
        })
      },
      count(o){
        var t = typeof o
        if (t == 'string') {
          return o.length
        } else if (t == 'object') {
          var n = 0
          for (var i in o) {
            n++
          }
          return n
        }
        return false
      },
      // list 详情页轮播按钮
      listDetailArrowLeft(){
        let nextPosition, moveD
        let that = this
        let currPosition = document.getElementById('list-detail-middle').scrollLeft
        let moveDistance = window.innerWidth / 2 //每次移动50%视窗宽度
        if (!this.isScrolling) {
          //滚动动画停止时执行
          this.isScrolling = true
          nextPosition = currPosition - moveDistance
          Velocity(this.$refs.islandWrapper2, "scroll", {
            axis: "x",
            container: this.$refs.islandWrapper2,
            duration: 300,
            offset: -621,
            mobileHA: false,
            complete: scrollEnd
          })
        }
        function scrollEnd() {
          //滚动动画回调
          that.isScrolling = false
        }
      },
      listDetailArrowRight(){
        let nextPosition
        let that = this
        let currPosition = document.getElementById('list-detail-middle').scrollLeft
        let moveDistance = window.innerWidth / 2 //每次移动50%视窗宽度
        if (!this.isScrolling) {
          //滚动动画停止时执行
          this.isScrolling = true
          nextPosition = currPosition + moveDistance
          Velocity(this.$refs.islandWrapper2, "scroll", {
            axis: "x",
            container: this.$refs.islandWrapper2,
            duration: 300,
            offset: 621,
            mobileHA: false,
            complete: scrollEnd
          })
        }
        function scrollEnd() {
          //滚动动画回调
          that.isScrolling = false
        }
      },
      // 关闭list-detail蒙层
      closeListDetail(){
        this.ListDetailContent = false
      },
      //去往学生评价老师
      goToEvaluate(onlineClassId){
        sa.track('learning_click', {
          'click_id': 'pc_learning_impel_box_activity_go_evaluate'
        })
        this.$router.push({path: `/evaluate_home/${onlineClassId}`})
      },
      /**
       * @description 判断上课时间是是否大于上线时间，如果大于上线时间，那么显示评价，如果小于上线时间那么不评价
       * @param scheduledDateTime [int] 当前课的上课时间，单位为ms
       */
      checkoutTime(scheduledDateTime){
        let onLineTime = (new Date(2018, 4, 28)).getTime()
        if (onLineTime > scheduledDateTime) {
          return false
        } else {
          return true
        }
      },
      /**
       @description  往listDetailImpels数组中添加数据，是添加对老师的评价的卡片
       这个本来应该从后端返回对老师评价的对象数据，但是因为从后端添加数据，后端修改的逻辑
       比较大，因此从前端添加该数据，总之不合理,然后无法考虑历史数据，以上线时间为标准， 上线之前的时间
       不添加卡片，上线之后添加卡片，这样导致删除卡片是，需要一个变量去判断是否添加卡片，不然在关闭弹窗的时候，
       删除了不应该的删除的数据。
       */
      addEvaluateTeacher(onlineClassId){
        let evaluateData = {
          totalEggshellNumber: 0,
          name: "评价老师",
          activityConfigId: 0,
          activityDesc: "正常完课后给老师评价",
          ifNotFloat: true,
          evaluateTeacher: true,
          buttonStatusDone: false,
          difference: 2,
          ifDate: false,
          eachIndex: 0,
          onlineClassId: onlineClassId
        }
        return evaluateData
      }

    }
  }
</script>

<style lang="stylus" scoped>

    .task-list
        position: absolute
        width: 1012px
        height: 280px
        left: 50%
        top: 53%
        margin-top: -75px
        margin-left: -500px
        overflow: hidden

    /* overflow-x scroll */
    .task-container
        position: relative
        width: 100%
        height: 100%

    .task-list-content
        position: relative
        width: 880px
        height: 271px
        margin: 0 auto
        padding-top: 26px
        overflow-x: scroll
        overflow-y: hidden

    ::-webkit-scrollbar
        display: none

    .task-list-each-icon
        position: relative
        display: block
        width: 90px
        height: 90px
        margin: 10px auto 0
        background: url(../../../img/hot_activity/hot-activity-detail-book.png)
        background-size: 100% 100%

    .task-list-each-many .task-list-each-icon
        margin-top: 40px
        background: url(../../../img/hot_activity/hot_activity_icon-homework@3x.png)
        background-size: 100% 100%



    //add by 罗明忠 添加对教师的评价。
    #list-detail-icon-0
        margin-top: 30px
        margin-bottom: 10px

    .list-detail-icon-0
        background: url(../../../img/hot_activity/hot_acitivity_evalute_teacher.png)
        background-size: 100% 100%

    // add end

    .list-detail-icon-1
        background: url(../../../img/hot_activity/hot_activity_icon-library.png)
        background-size: 100% 100%

    .list-detail-icon-2
        background: url(../../../img/hot_activity/hot_activity_icon-prevideo.png)
        background-size: 100% 100%

    .list-detail-icon-3
        background: url(../../../img/hot_activity/hot_activity_icon-allcourse.png)
        background-size: 100% 100%

    .task-list-each-name
        position: relative
        text-align: center
        color: #666
        font-size: 18px
        line-height: 35px
        font-weight: bold
    .task-list-each-name-desc
        position: relative
        text-align: center
        color: #999
        font-size: 12px
        line-height: 17px
        font-weight: bold
        padding: 0 8px
        text-overflow: ellipsis
        white-space: nowrap
        overflow: hidden

    .task-list-each-detail
        position: relative
        text-align: center
        color: #999
        font-size: 12px
        line-height: 17px
        font-weight: bold

    .task-list-each-detail-number
        position:absolute
        left:70px
        bottom:17px
        font-size:12px
        font-weight:400;
        color:#BA8400

    
    .task-list-each-number
        position: relative
        text-align: center
        height: 31px
        line-height: 31px
        font-weight: bold

        .number-margin
            margin-left: 6px

        .iconStone
            display: inline-block
            width: 20px
            height: 31px
            margin: 0
            vertical-align: bottom
            background: url("../../../img/hot_activity/hot_activity_meteorite.png") no-repeat
            background-size: 100% 65%
            background-position: center
            // background: url("../../../img/rankings/home_starstore@2x.png") no-repeat
        .iconStart
            display: inline-block
            width: 20px
            height: 31px
            margin: 0
            vertical-align: bottom
            background: url("../../../img/rankings/home_starstore@2x.png") no-repeat
            background-size: 100% 65%
            background-position: center
        .iconCard
            display: inline-block
            width: 20px
            height: 31px
            margin: 0
            vertical-align: bottom

            .task-list-iconcard
               width:18px
               height:18px
               cursor:pointer

        span
            color: #F85415
            display: inline-block
            font-size: 14px
            font-weight: bold
            margin-left: 2px
        .task-list-tip
            position:absolute
            left:40px
            top:-60px
            background:#8561ED
            width:132px
            height:57px
            opacity:0.95
            border-radius:20px
          .task-list-tip-img
             width:34px
             height:34px
             vertical-align: middle
             text-align:left
             position: absolute
             left: 10px
             top: 10px
          .task-list-tip-name
              width:74px
              max-height:34px
              font-size:12px
              color:#fff
              line-height:16px
              text-align:left
              position: absolute
              right: 10px
              top: 10px
              overflow: hidden


         .task-list-tip-arror
            background: url(../../../img/hot_activity/cardArror.png) no-repeat
            background-size: 100% 100%
            background-position: center
            width:20px
            height:6px
            position: absolute
            left: 60px
            top: 57px



    .task-list-each-number-margin
        margin: 8px 0 9px

    .task-list-each-button
        display: block
        width: 120px
        height: 40px
        margin: 0 auto
        background: url(../../../img/hot_activity/hot_activity_button_receive.png)
        background-size: 100% 100%
        text-align: center
        color: #ffffff
        font-size: 18px
        line-height: 40px
        cursor: pointer

    .task-list-each-button-receive
        background: url(../../../img/hot_activity/hot_activity_button.png)
        background-size: 100% 100%

    .task-list-each-date
        position: absolute
        display: inline-block
        border-radius: 20px 20px 0px 0px
        background-color: #e7deee
        color: #8858A6
        font-size: 12px
        text-align: center
        width: 88px
        height: 16px
        line-height: 16px
        bottom: 0
        left: 50%
        margin-left: -44px

    .task-list-each-many .task-list-each-date
        bottom: 0

    .task-list-arrow
        .task-arrow-left
            position: absolute
            display: inline-block
            width: 59px
            height: 96px
            background: url(../../../img/hot_activity/hot-activity-last.png) no-repeat
            background-size: 100% 100%
            left: 0
            top: 80px
            cursor: pointer

        .task-arrow-right
            position: absolute
            display: inline-block
            width: 59px
            height: 96px
            background: url(../../../img/hot_activity/hot-activity-next.png) no-repeat
            background-size: 100% 100%
            right: 0
            top: 80px
            cursor: pointer

        .scroll-disable
            opacity: 0.6
            cursor: not-allowed

    .task-list-default
        position: absolute
        width: 300px
        height: 300px
        top: 0
        left: 50%
        margin-left: -150px
        span
            display: block
            width: 270px
            height: 270px
            background: url(../../../img/hot_activity/hot-activity-default.png)
            background-size: 100% 100%
            margin: 0 auto
        .task-list-default-p
            position: absolute
            width: 100%
            left: 0
            bottom: 40px
            p
                color: #ffffff
                font-size: 18px
                line-height: 24px
                text-align: center

    .task-list-each-nobutton .task-list-each-icon
        margin-top: 40px

    .task-list-each-many.task-list-each-nobutton .task-list-each-icon
        margin-top: 40px

    .task-list-each-nobutton-status  .task-list-each-icon
        margin-top: 40px

    /* overflow-x scroll */
    .task-container
        position: relative
        width: 100%
        height: 100%

    .task-list-long
        position: absolute
        min-width: 1000px
        left: 0
        top: 0
        padding: 10px 0
        overflow: hidden

    .list-detail-long
        min-width: 460px
        overflow: hidden

    .list-detail-long .task-list-each
        margin: 0 15px

    .task-list-each-animation
        animation: cardFade 1s infinite alternate
        &:hover
            animation-play-state: paused

    .task-list-each
        position: relative
        display: inline-block
        width: 200px
        height: 250px
        background: url(../../../img/hot_activity/hot_activity_singlecard-bg.png) no-repeat
        background-size: 100% 100%
        margin: 0 10px
        float: left
        vertical-align: top

        &:last-child
            margin-right: 0

        .task-list-each-progress
            height: 24px
            line-height: 24px
            text-align: center
            margin-bottom: 7px

            span
                font-size: 12px
                color: #999999

            .progress-day
                font-size: 18px
                color: #AD9AFF
                font-weight: 500

        .task-list-each-status-new
            position: absolute
            top: 0
            right: 0
            width: 44px
            height: 52px
            background: url(../../../img/hot_activity/hot-activity-status-new@2x.png) no-repeat
            background-size: 100% 100%
        .task-list-each-detail-sign
            position: absolute
            top:0
            left:13px
            width:41px
            height:41px
            cursor: pointer
        .task-list-each-detail-sign-course
            position: absolute
            top:9px
            left:12px
            width:41px
            height:41px
            cursor: pointer
        .task-list-each-detail-sign-new
            position: absolute
            top :0
            right:0
            width:44px
            height:52px

    /* 定向激励卡片样式 */
    .task-list-each-motivate
        background: url(../../../img/hot_activity/hot_activity_motivatecard-bg2.png) no-repeat
        background-size: 100% 100%

        .task-list-each-date-new-task
            position: absolute
            width: 100%
            text-align: center
            bottom: 0
            left: 0

            span
                display: inline-block
                border-radius: 20px 20px 0px 0px
                font-size: 12px
                text-align: center
                height: 16px
                line-height: 16px
                background:rgba(255,181,0, 0.2)
                color: #BA8400
                padding: 0 10px




    .task-list-each-many
        background: url(../../../img/hot_activity/hot_activity_singlecards-bg-v2@3x.png) no-repeat
        background-size: 100% 100%

        .task-list-each-title
            width: 100%
            color: #666
            margin-top: 10px

            .task-list-each-title-unit
                width: 78px
                height: 20px
                margin: 0 auto
                color: #fff
                background: rgba(220,203,255,1)
                border-radius: 0px 0px 40px 40px
                font-weight: bold
                font-size: 14px
                line-height: 20px
                text-align: center

            .task-list-each-title-lesson
                position: relative
                box-sizing: border-box
                font-weight: bold
                padding-right: 81px
                text-align: right
                font-size: 20px
                height: 20px
                line-height: 20px
                margin: 6px 0 3px

                .task-list-each-title-lesson-num
                    position: absolute
                    box-sizing: border-box
                    font-weight: bold
                    left: 126px
                    bottom: 0
                    font-size: 30px
                    line-height: 20px
                    padding-bottom: 3px

            .task-list-each-detail
                line-height: 17px

        .task-list-each-title-visited
            color: #999

        .task-list-each-icon
            width: 74px
            height: 74px
            margin: 5px auto 4px
            border-radius: 50%

    .task-list-each-name
        position: relative
        text-align: center
        color: #666
        font-size: 18px
        line-height: 26px
        font-weight: bold
        padding: 0 8px
        text-overflow: ellipsis
        white-space: nowrap
        overflow: hidden

    .task-list-each-detail
        position: relative
        text-align: center
        color: #999
        font-size: 12px
        line-height: 17px
        font-weight: bold

    .task-list-each-button
        display: block
        width: 120px
        height: 40px
        margin: 0 auto
        background: url(../../../img/hot_activity/hot_activity_button_receive.png)
        background-size: 100% 100%
        text-align: center
        color: #ffffff
        font-size: 18px
        line-height: 40px
        cursor: pointer

    .task-list-each-button-disable
        background: #FFF0CC
        cursor: auto
        border-radius:80px
        font-size:18px
        font-weight:400
        color:#D99A00

    .task-list-each-button-receive
        background: url(../../../img/hot_activity/hot_activity_button.png)
        background-size: 100% 100%

    .task-list-each-date
        position: absolute
        display: inline-block
        border-radius: 20px 20px 0px 0px
        background-color: #e7deee
        color: #8858A6
        font-size: 12px
        text-align: center
        width: 88px
        height: 16px
        line-height: 16px
        bottom: 0
        left: 50%
        margin-left: -44px

    .list-detail-arrow .list-detail-arrow-left
        position: absolute
        display: inline-block
        width: 40px
        height: 41px
        background: url(../../../img/hot_activity/hot-activity-detail-last.png) no-repeat
        background-size: 100% 100%
        left: 30px
        top: 145px
        cursor: pointer

    .list-detail-arrow .list-detail-arrow-right
        position: absolute
        display: inline-block
        width: 40px
        height: 41px
        background: url(../../../img/hot_activity/hot-activity-detail-next.png) no-repeat
        background-size: 100% 100%
        right: 30px
        top: 145px
        cursor: pointer

    .task-list-default
        position: absolute
        width: 300px
        height: 300px
        top: 0
        left: 50%
        margin-left: -150px
        span
            display: block
            width: 270px
            height: 270px
            background: url(../../../img/hot_activity/hot-activity-default.png)
            background-size: 100% 100%
            margin: 0 auto
        .task-list-default-p
            position: absolute
            width: 100%
            left: 0
            bottom: 40px
            p
                color: #ffffff
                font-size: 18px
                line-height: 24px
                text-align: center

    .width-auto
        width: auto
        padding-right: 10px

    .list-detail-container
        position: absolute
        background-color: #A18EE3
        text-align: center
        margin: 20px auto 30px
        border-radius: 30px
        min-width: 460px
        max-width: 680px
        z-index: 2
        height: 270px
        padding: 40px 75px 8px
        overflow: hidden

    .list-detail-middle
        position: absolute
        height: 300px
        min-width: 460px
        max-width: 690px
        overflow-x: scroll

    .list-detail-after
        position: absolute
        width: 80%
        background: #70639E
        height: 370px
        border-radius: 40px
        left: 10%
        z-index: 1

    .task-list-each-status
        position: absolute
        display:none
        width: 94px
        height: 72px
        right: 6px
        bottom: 14px

    .list-detail-each-over
        .task-list-each-button
            display: none
        .task-list-each-date
            display: none
        .task-list-each-icon
            margin-top: 40px
        .task-list-each-status-over
            display: inline-block
            background: url(../../../img/hot_activity/hot-activity-list-over.png) no-repeat
            background-size: 100% 100%


    .list-detail-each-done
        .task-list-each-button
            display: none
        .task-list-each-date
            display: none
        .task-list-each-icon
            margin-top: 40px
        .task-list-each-status-done
            display: inline-block
            background: url(../../../img/hot_activity/hot-activity-list-done.png) no-repeat
            background-size: 100% 100%

    .list-detail-wrapper
        position: absolute
        width: 600px
        height: 400px
        left: 50%
        top: 50%
        margin-left: -300px
        margin-top: -200px
        border-radius: 20px

    .max-detail-wrapper
        width: 820px
        margin-left: -410px

    .max-detail-container
        width: 680px

    .task-list-each-nobutton .task-list-each-icon
        margin-top: 40px

    .task-list-each-many.task-list-each-nobutton .task-list-each-icon
        margin-top: 40px

    //card detail部分
    .list-detail-content
        position: fixed
        width: 100%
        height: 100%
        left: 0
        top: 0
        background: rgba(0, 0, 0, 0.7)
        z-index: 25
        .list-detail-title
            position: absolute
            width: 446px
            height: 118px
            background: url(../../../img/hot_activity/hot-activity-title-bg.png) no-repeat
            background-size: 100% 100%
            margin: 0 auto
            top: -98px
            left: 50%
            margin-left: -223px
            z-index: 2
            p
                position: absolute
                top: 0
                width: 100%
                font-size: 30px
                line-height: 90px
                color: #ffffff
                text-align: center
        .list-detail-close
            display: inline-block
            position: absolute
            width: 57px
            height: 40px
            background: #70639E
            top: 30px
            right: -60px
            cursor: pointer
            background: url(../../../img/hot_activity/hot-activity-detail-close.png) no-repeat
            background-size: 100% 100%
            z-index: 1
        .task-list-each-status
            position: absolute
            display:none
            width: 94px
            height: 72px
            right: 6px
            bottom: 14px
           .task-list-each-status-done-course
               display: inline-block
               background: url(../../../img/hot_activity/hot-activity-list-done.png) no-repeat
               background-size: 100% 100%

    .task-list-each-new-progress
        position:absolute
        left:0
        bottom:24px
        width:200px
        height:6px

        .progress-all
            width:60px
            height:6px
            background:#E2E2E2
            border-radius:5px
            position:absolute
            left:60px
            top:0
        .progress-day
            height:6px
            background: #52B0B2
            border-radius:5px
            position:absolute
            left:60px
            top:0
            z-index:1
        .progress-size
            position: absolute
            left:124px
            top:-3px
            color:#52B0B2
            font-size:12px

    @media screen and (min-width: 1900px)
        .task-list
            width: 1350px
            margin-left: -675px

        .task-list-content
            width: 1100px

        .task-list-arrow
            .task-arrow-left
                left: 58px
            .task-arrow-right
                right: 58px

        @keyframes cardFade
            from
                transform: scale(1.03, 1.03)
            to
                transform: scale(1, 1)

</style>


