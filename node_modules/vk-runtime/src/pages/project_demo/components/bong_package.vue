<template lang="jade">
  vk-mask
    .content
      img.star-an(v-for="(star,index) in stars",src="../../../img/index/meteorite_2@2x.png",:style="star")
      .text 恭喜你获得{{impelNumber}}个宝石～
      .new-box(ref="box")
        .new-box-bg
        .number
          number.number-text(ref="numberText",:number="impelNumber")
      .circle
        .circle-item.animated.zoomIn(v-for="circleItem in circleItems",:style="circleItem")
</template>
<script>
  import number from '../../common/vk_number.vue'
  import vkMask from '../../common/vk_mask.vue'

  export default {
    data: function () {
      return {
        stars: [],
        circleItems: [],
        impelNumber: "0"
      }
    },
    components: {
      number,
      vkMask
    },
    props: ['number'],
    computed: {},
    mounted () {
      this.initLightAn()
      setTimeout(() => {
        this.getNumber()
      }, 600)
    },
    methods: {
      getNumber(){
        this.impelNumber = this.number + ""
        this.$nextTick(() => {
          this.stars = []
          var top = this.$refs.box.getBoundingClientRect().top + 155 - 40 + "px"
          var left = this.$refs.box.getBoundingClientRect().left + 300 - 35 + "px"
          for (var i = 0; i < 5; i++) {
            this.stars.push({
              top: top,
              left: left,
              transform: "scale(1.2, 1.2)"
            })
          }
        })
        setTimeout(() => {
          this.lightAn()
          this.$playSound("showImpel")
        }, 200)
        setTimeout(() => {
          this.hide()
        }, 2000)
      },
      initLightAn(){
        this.circleItems = []
        for (var i = 0; i < 10; i++) {
          let ra = Math.random() * 50
          this.circleItems.push({
            top: "160px",
            left: "280px",
            height: ra + "px",
            width: ra + "px",
            backgroundColor: "rgb(0, 221, 151)",
            opacity: Math.random() * 0.7
          })
        }
      },
      lightAn(){
        this.circleItems = []
        for (var i = 0; i < 10; i++) {
          let ra = Math.random() * 50
          this.circleItems.push({
            top: Math.random() * 300 + "px",
            left: Math.random() * 500 + "px",
            height: ra + "px",
            width: ra + "px",
            backgroundColor: "rgb(0, 221, 151)",
            opacity: Math.random() * 0.7
          })
        }
      },
      hide(){
        this.$nextTick(() => {
          setTimeout(() => {
            this.stars = []
            for (var i = 0; i < 5; i++) {
              this.stars.push({
                top: "20px",
                right: "30px",
                transform: "scale(0.2, 0.2)",
                transitionDelay: i * 0.1 + "s"
              })
            }
          }, 200)
        })
        setTimeout(() => {
          this.$emit("boxClose")
        }, 700)
      }
    }
  }
</script>

<style lang="stylus" scoped>
  .content
    position: relative
    height: 380px
    width: 600px
    margin: auto
    .text
      font-size: 24px
      color: #ffffff

  .new-box
    position: absolute
    width: 600px
    height: 310px
    margin: 30px auto
    box-sizing: border-box
    padding: 50px 0
    z-index: 2
    .number
      height: 44px
      width: 100%
      margin: auto
      text-align: center
      .number-text
        margin: 0 auto
        transform: scale(1.5, 1.5)
        transition: all 1s 1s
    .star
      height: 1px
      width: 1px
      margin: 0 auto

    .star-hide
      position: absolute
      z-index: 10
      left: 200px
      top: 30px
    .new-box-bg
      position: absolute
      background: url("../../../img/hot_activity/bg_light.png") no-repeat center
      background-size: 100% 100%
      width: 310px
      height: 310px
      top: 0
      left: 145px
      animation: lightRotate linear 5s infinite

  .circle
    position: absolute
    height: 380px
    width: 600px
    z-index: 1
    .circle-item
      position: absolute
      border-radius: 50%
      transition: all 3s

  .star-an
    position: fixed
    top: 30%
    right: 46%
    z-index: 120
    transform: scale(0.2, 0.2)
    transform-origin: 50% 50%
    transition: all 0.3s ease

  .opw-hide
    background-color: rgba(23, 2, 62, 0)

  @keyframes lightRotate
    0%
      opacity: 0.5
      transform: rotateZ(0deg) scale(1.2, 1.2)
    50%
      opacity: 1
      transform: rotateZ(180deg) scale(1.7, 1.7)
    100%
      opacity: 0.5
      transform: rotateZ(360deg) scale(1.2, 1.2)
</style>
