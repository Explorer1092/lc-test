<template lang="jade">
  .upload-container
    loading(v-if="fullPageLoading")
    pd-rule(:show="rule", @closeRule="closeRule", :type="ruleType", :acid="acid", @agree="agree")
    upload-status(v-show="uploading", :progress="progress", @uploadingClick="uploadingClick", :fail="fail", :text="uploadText")
    .back-mask(v-show="preview", @click="closePreview")
    pd-back(:title_cn="title", @backConfirm="backConfirm")
    dialog-box(v-show="showDialog", :title="backObj.title", :tips="backObj.tips", @dialogClick="dialogClick")
    .mask-shadow(v-show="!preview || !videoURL")
      .upload-box
        .local-phone
          .cell-bg(:class="mobile ? 'mobile' : 'pc'")
          .cell(v-for="(item, i) in ups", :class="'cell-' + i", @click="localOrPhone(i)") {{item}}
        .pc(v-if="!mobile", class="animated fadeInRight")
          .upload-video(v-show="!videoURL", @click="clickUpload")
            input(type="file", ref="file", @change="fileChange", accept="video/mp4,video/x-ms-wmv,video/quicktime", style="display: none" )
            .status.add(@click="videoPre")
            span 上传视频
          .upload-tips
            |视频最大可上传200M，不超过60秒。
            span.phone
            |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;横屏拍摄的视频效果更佳哦~
        .mobile(v-else)
          .qrcode-box
            qrcode-box(v-if="qrcode", class="qrcode", :value="mobileUrl", :size="140", :level="'H'")
            .mobile-tips 请用微信扫描二维码上传视频哦~
    .preview(v-if="preview && videoURL")
      .video-container
        //- img.video-img(v-if="cantDecode", src="../../img/project_demo/upload_preview.png")
        img.video-img(v-show="isVideoImgShow", :src="imgSrc")
        video(v-if="!cantDecode", :src="videoURL", ref="video2")
        .play-button(v-if="isPlayButtonShow", @click="playThisVideo")
        .frame-mask(v-if="videoMaskSelected", :style="{backgroundImage: 'url(' + videoMaskSelected + ')'}")
      .op(v-if="!videoId")
        .user-mask-selection
          .item.no-filter(@click="chooseNoMask", :class="{'selected': selectedNumber == null}")
            span 无滤镜
          .item.scene(v-for="(item, index) in videoMaskCollection", @click="chooseMask(item, index)", :class="{'selected': selectedNumber == index}")
            img(:src="item.thumbnailUrl")
        .button(@click="next")
          span 下一步
      .kid-info(v-else)
        .text-edit-box
          .title-text
            span 作品标题
            input#text(:class="{'focus':maxlengthTips}",ref="text",type="text",v-model="name",@focus="textChange",@blur="textChange('blur')",@input="textInput",autocomplete="off", maxlength="14")
            .maxlengthTips(v-show="maxlengthTips") 最多支持10个汉字
          .student
            span 作者
            .name {{studentName}}
          .certain-button(@click="confirm") 确认参赛
          .agreement
            i(@click="haveAgree=!haveAgree", :class="{'active': haveAgree}")
            span 我已阅读并同意
              a(@click.prevent="rule=!rule") 《VIPKID上传协议》

    video(style="display:none;", :src="videoURL", ref="video")
</template>
<script>
import axios from "axios"
import videoBox from "../common/vk_video.vue"
import VVOS from "vvos-js"
import qrcodeBox from "qrcode.vue"
import pdBack from "./components/pd_back.vue"
import pdRule from "./components/rule.vue"
import uploadStatus from "./components/upload_status.vue"
import dialogBox from "./components/dialog.vue"
import UPLOAD from "./js/upload.js"
import cookies from "cookies-js"
import loading from "../common/vk_loading.vue"
export default {
  mixins: [UPLOAD.ipad(), UPLOAD.pc()],
  data() {
    return {
      fullPageLoading: false,
      iconLoading: false, // iconLoding 图标标识变量
      haveAgree: false, // 是否已经同意协议
      rule: false, // 协议弹窗 显示否
      ruleType: "join", // 协议类型
      acid: 48, // acid值
      videoURL: null,
      imgSrc: null,
      qrcode: true,
      mobile: false,
      ups: ["本地上传", "手机上传"],
      uploading: false,
      progress: "0%",
      mobileUrl: "",
      showDialog: false,
      dinoTips: false,
      maxlengthTips: false,
      type: 0,
      preview: false,
      ipadImg: null,
      source: 1,
      currentMaterialId: 1,
      studentName: cookies.get("userName") || "本人",
      name: "",
      fail: false,
      uploadText: "作品上传中...",
      videoSize: null,
      prePlay: false,
      iPad: false,
      count: 0,
      videoId: "",
      isMp4: false,
      partitionId: "",
      activityType: "",
      backObj: {
        title: "退出提示",
        tips: "宝贝还差一步就完成上传啦！确定要退出吗？"
      },
      canJoin: false,
      backUrl: "",
      title: "上传作品",
      processTimer: null,
      _preview: false,
      warnTips: false,
      _name: "",
      dinoTipsText: "该视频过大，请选择其他视频",
      cantDecode: false,
      host: "https://a15-mobile.vipkid-qa.com.cn",
      videoMaskCollection: [],
      videoMaskSelected: null,
      selectedNumber: null,
      isOverlay: 2, // 1:有遮罩 2:无遮罩
      frameId: "",
      isPlayButtonShow: true,
      isVideoImgShow: cookies.get("isFromApp")
    }
  },
  components: {
    pdBack,
    pdRule,
    qrcodeBox,
    uploadStatus,
    dialogBox,
    videoBox,
    loading
  },
  mounted() {

    this.getPartition() // set手机上传URL

    this.getVideoMask() // 获取视频遮罩list, 目前只有3个

    this.checkAgreement() // 检查该学生是否同意过“用户协议”

    this.fullPageLoading = false

    // 如果从cookie拿不到userName, 则从服务端拿
    if (!cookies.get("userName") || cookies.get("userName") === "null") {
      this.getStudentName()
    } else {
      this.name = cookies.get("userName") + "的作品"
    }

    /* iPad App 兼容
     * iPad App webview
     * ipad App交互文档见: http://wiki.vipkid.com.cn/pages/viewpage.action?pageId=33134090
     */

    if (cookies.get('isFromApp')) {
      if (this.$route.params.isUserShoot) {
        // iPad原生用户拍摄模式

        //开启满屏loading
        this.fullPageLoading = true

        //初始化用户拍摄模式
        this.initVKAppBridgeInUserShootMode()

        //调起 iPad App 的 FileUpload
        this.dispatchForIpad(`vkappbridge://fileupload/video?type=3&product=pd&max_duration=60&activity_id=${this.$route.params.pdId}`)

      } else {

        this.initVKAppBridgeInChooseVideoMode()

      }

      this.heartBeat()

      setInterval(() => {

        this.heartBeat()

      }, 5000)

    }

  },
  methods: {
    getPartition() {
      axios.get(`/rest/activity/api/activity/user/activity/getPartitionByActivityIdAndStudentId/${this.$route.params.pdId}`)
        .then(res => {
          let _host
          let index = window.location.host.search("lc.vipkid.com.cn")
          if (index !== -1) {
            if (index === 0) {
              _host = "https://mobile.vipkid.com.cn"
            } else {
              if (window.location.host.search("pre") > -1) {
                _host = "https://pre-mobile.vipkid.com.cn"
              } else {
                _host = "https://a15-mobile.vipkid-qa.com.cn"
              }
            }
          }
          this.loading = false
          this.partitionId = res.data.data.id
          this.activityType = res.data.data.activityType
          this.mobileUrl = _host + `/learning-effect/prd/SelectStudent?activityId=${this.$route.params.pdId}&partitionId=${this.partitionId}`
        })
    },
    heartBeat() {
      this.dispatchForIpad('vkappbridge://ipadcommon/postHeartbeat')
    },
    getQueryString(name) {
      var result = location.search.match(new RegExp("[\?\&]" + name + "=([^\&]+)", "i"))
      if (result == null || result.length < 1) {
        return ""
      }
      return result[1]
    },
    initVKAppBridgeInUserShootMode() {
      window.VKAppBridge = {}
      window.VKAppBridge['receiveFromNative'] = (iosRes) => {
        let data = JSON.parse(iosRes)
        switch(data.data.code) {
        case 0:
          this.fullPageLoading = false
          this.videoURL = data.data.video_url
          this.isOverlay = 2 // 不需要叠加相框
          this.frameId = "" // 没有相框就没有id
          this.imgSrc = data.data.cover_url // 此时cover_url是undefined, JSON.stringify会把undefined的字段除去。逻辑是：不需要封面图，后端会合成封面图。
          this.$nextTick(() => {
            this.confirmVideoWithFrameOnIpad()
          })
          break
        case 5:
          // 这里用重定向切换到iPad本地选择视频模式: initVKAppBridgeInChooseVideoMode
          // window.location.href = `/video_upload/${this.$route.params.pdId}`
          let activityType = this.getQueryString('activityType')
          this.$router.push({path: `/work_wall/upload/${this.$route.params.pdId}/${activityType}`})
          break
        case 1:
          window.history.back()
          sa.track("learning_click", {click_id:"pc_learning_activity_workwall_ipad_user_cancel_photo_shot"})
          break
        case 2:
          this.$showToast("网络异常，请保证网络畅通")
          break
        case 3:
          this.$showToast("网络异常，请保证网络畅通")
          break
        case 4:
          this.$showToast("用户未授权相机功能")
          break
        }
      }
      this.dispatchForIpad('vkappbridge://__bridge_ready__ ')
    },
    initVKAppBridgeInChooseVideoMode() {
      window.VKAppBridge = {}
      window.VKAppBridge['receiveFromNative'] = (iosRes) => {
        let data = JSON.parse(iosRes)
        if (data.data.code === 0) {
          this.preview = true
          this.videoURL = data.data.video_url
          this.imgSrc = data.data.cover_url // 此时cover_url是undefined, JSON.stringify会把undefined的字段除去。逻辑是：不需要封面图，后端会合成封面图。
        }
      }
      this.dispatchForIpad('vkappbridge://__bridge_ready__ ')
    },
    getStudentName() {
      axios.get(`/rest/activity/api/activity/user/activity/getStudentByStudentId`).then(res => {
        this.studentName = res.data.data.englishName
        this.name = this.studentName + "的作品"
      })
    },
    confirm() {
      // 没上传作品 提示上传作品
      if (!this.videoURL) {
        this.$showToast("还没有上传视频，请先上传视频")
        return
      }
      // 没勾选协议 提示勾选协议
      if (!this.haveAgree) {
        this.$showToast("请您先同意《VIPKID 上传协议》，即可成功参赛")
        return
      }
      // canJoin 是最终控制状态
      if (!this.canJoin) {
        return
      }
      // 置为交互中状态
      this.iconLoading = true // iconloding 显示
      this.canJoin = false // 参赛按钮 不可点击
      this.$playSound("click")
      // 确认协议
      axios.post(`/rest/activity/api/activity/user/activity/setActivityStudentRulesRecordAgree`).then((res) => {
        if (res.data.code === 0) {
          // 同意协议的记录 存储成功
          if (res.data.data) {
            if (res.data) {
            // 先修改名字
              axios.post(`/rest/activity/api/activity/user/resource/renameByResourceIdAndName?resourceId=${this.videoId}&name=${this.$refs.text.value}`).then((res) => {
                this.canJoin = true // 放行
                if (res.data.data) {
                  this.join()
                } else {
                  this.$showToast(res.data.msg)
                }
              }).catch(err => {
                this.iconLoading = false // iconLoding 消失
                this.canJoin = true // 参赛按钮 active
              })
            }
          } else {
            this.$showToast("协议未上传成功，请重新确认")
            this.haveAgree = false // 协议置为未勾选
            this.iconLoading = false // iconLoding 消失
            this.canJoin = true // 放行
          }
        } else {
          this.$showToast("协议未上传成功，请重新确认")
          this.haveAgree = false // 协议置为未勾选
          this.iconLoading = false // iconLoding 消失
          this.canJoin = true // 放行
        }
      }).catch((err) => {
        this.$showToast("协议未上传成功，请重新确认")
        this.haveAgree = false // 协议置为未勾选
        this.iconLoading = false // iconLoding 消失
        this.canJoin = true // 放行
      })
    },
    join() {
      sa.track("learning_click", {
        click_id:
          "pc_learning_activity_competitionArena_competition_upload_submissionConfirmed"
      })
      axios.post(`/rest/activity/api/activity/user/resource/signUpByResourceIdAndActivityId/${this.videoId}/${this.$route.params.pdId}`).then(res => {
        if (res.data.code === 0) {
          this.$router.replace({
            path: `/pd_video/${this.videoId}/${this.$route.params.pdId}`
          })
        } else {
          this.$showToast(res.data.msg)
          setTimeout(() => {
            //由于 /project_detail 页面是keepalive，此处用重定向防止页面数据不刷新
            window.location.replace(`/project_detail/${this.$route.params.pdId}`)
          }, 2000)
        }
      })
        .catch(err => {
          this.iconLoading = false // iconLoding 消失
          this.canJoin = true // 参赛按钮 active
        })
    },
    // 获取是否同意过协议信息 data:true代表同意过
    checkAgreement() {
      axios.get(`/rest/activity/api/activity/user/activity/getActivityStudentRulesRecord`).then(res => {
        if (res.data.data) {
          this.haveAgree = true
        }
      })
    },
    textChange(key) {
      if (key === "blur") {
        this.maxlengthTips = false
        if (!this.name) {
          this.name = cookies.get("userName") + "的作品"
        }
        return
      }
      if (this.name === cookies.get("userName") + "的作品") {
        this.name = ""
      }
    },
    closePreview() {
      this.isPlayButtonShow = true // 预览视频时的播放按钮
      this.preview = false
      this.videoURL = ""
      this.videoId = ""
      this.$refs.file.value = ""
      this.imgSrc = ""
    },
    dialogClick(key) {
      this.$playSound("click")
      if (key === "cancel") {
        this.showDialog = false
      } else {
        if (this.gobackurl) {
          this.$router.push(this.gobackurl)
        } else {
          window.history.back()
        }
      }
    },
    backConfirm() {
      this.showDialog = true
    },
    playThisVideo() {
      this.$refs.video2.play()
      this.isPlayButtonShow = false
      this.isVideoImgShow = false
      this.$refs.video2.addEventListener('ended', () => {
        this.isPlayButtonShow = true
      })
    },
    textInput() {
      if (!this.checkLength(this.name)) {
        this.maxlengthTips = true
      } else {
        this.maxlengthTips = false
      }
    },
    checkLength(str) {
      let length = str.replace(/[\u0391-\uFFE5]/g, "xx").length
      if (length > 20) {
        return false
      } else {
        return true
      }
    },
    next() {
      if (cookies.get('isFromApp')) {
        this.confirmVideoWithFrameOnIpad()
      } else {
        this.uploadVideo()
      }
    },
    confirmVideoWithFrameOnIpad() {
      axios.post("/rest/activity/api/activity/user/upload/uploadComplete",
        JSON.stringify({
          mp4: true,
          videoUrl: this.videoURL,
          coverImage: this.imgSrc,
          activityId: this.$route.params.pdId,
          activityType: this.activityType,
          partitionId: this.partitionId,
          name: this.studentName + "的作品",
          resourceType: 1, // 视频为1, 图片为0
          isOverlay: this.isOverlay,
          frameId: this.frameId
        }),
        { headers: { "Content-Type": "application/json" } }
      )
        .then(res => {
        // ipad端 视频是否符合参赛标准的验证
          if (res.data && res.data.code === 0) {
            this.fail = false
            this.preview = true
            this.uploading = false
            this.videoId = res.data.data.id
            this.canJoin = true
          } else {
            this.fail = false
            this.uploading = true
            this.progress = "Oops!"
            if (res.data && res.data.code === 100027) {
              this.uploadText = "抱歉，该视频已经参加过其他大赛，请您另选一个视频参赛哦！"
            } else if (res.data && res.data.code === 100032) {
              this.uploadText = "抱歉，该视频已被其他用户上传参赛，请您另选一个视频参赛哦！"
            } else if (res.data && res.data.code === 100033) {
              this.uploadText = "抱歉，该视频之前上传过但并未通过审核，请您另选一个视频参赛哦！"
            } else {
              this.uploadText = "上传失败"
            }
          }
        })
        .catch(err => {
          this.fail = true
          this.uploading = true
          this.progress = "Oops!"
          this.uploadText = "上传失败"
        })
    },
    uploadVideo() {
      let file = this.$refs.file.files[0]
      this.uploading = true
      const getToken = "/rest/activity/api/activity/user/upload/getToken"
      const uploadComplete = "/rest/activity/api/activity/user/upload/uploadComplete"
      let upload = new VVOS({
        api: {
          gettoken: getToken,
          notifier: uploadComplete
        },
        cover: true,
        client: 'vos-js.sdk 1.0.0.0'
      })
      upload.addfiles([file])
      upload.submit({
        header: {
          status: this.cantDecode ? 1 : 0
        },
        gettoken: {
          status: this.cantDecode ? 1 : 0
        },
        notifier: {
          resourceType: 1,
          mp4: this.isMp4,
          name: cookies.get("userName") + '的作品' || 'unknow user',
          coverImage: null,
          activityId: this.$route.params.pdId,
          activityType: this.activityType,
          partitionId: this.partitionId,
          isOverlay: this.isOverlay,
          frameId: this.frameId
        }
      }, (err, data) => {
        if (err) {
          this.fail = true
          this.progress = 'Oops!'
          this.uploadText = '上传失败'
        } else if (data && data.data.code === 0) {
          this.preview = true
          this.videoId = data.data.data.id
          this.uploading = false
          this.canJoin = true
        } else if (data && data.data.code === 100027) {
          this.fail = true
          this.progress = 'Oops!'
          this.uploadText = '抱歉，该视频已经参加过其他大赛，请您另选一个视频参赛哦！'
        } else if (data && data.data.code === 100032) {
          this.fail = true
          this.progress = 'Oops!'
          this.uploadText = '抱歉，该视频已被其他用户上传参赛，请您另选一个视频参赛哦！'
        } else if (data && data.data.code === 100033) {
          this.fail = true
          this.progress = 'Oops!'
          this.uploadText = '抱歉，该视频之前上传过但并未通过审核，请您另选一个视频参赛哦！'
        } else {
          this.fail = true
          this.progress = 'Oops!'
          this.uploadText = '上传失败'
        }
      }, (err, process) => {
        if (process) {
          if (process.process) {
            this.progress = Math.floor(process.process * 100) + '%'
          } else {
            this.progress = '99%'
          }
        }
      })
    },
    getVideoMask() {
      axios.get("/rest/activity/api/activity/user/activity/getFrameList?activityId=1").then((res) => {
        this.videoMaskCollection = res.data.data.list
      })
    },
    chooseNoMask() {
      this.videoMaskSelected = null
      this.selectedNumber = null
      this.isOverlay = 2
      this.frameId = ''
    },
    chooseMask(item, index) {
      this.videoMaskSelected = item.frameUrl
      this.frameId = item.id
      this.selectedNumber = index
      this.isOverlay = 1
    },
    //点击上传按钮，iPad单独调用，PC走原生input
    clickUpload() {
      this.$playSound("click")
      if (cookies.get('isFromApp')) {
        this.dispatchForIpad(`vkappbridge://fileupload/video?type=1&product=pd&max_duration=60`)
      } else {
        this.$refs.file.click()
      }
    },
    dispatchForIpad(src) {
      let _iframe = document.createElement('iframe')
      _iframe.setAttribute('src', src)
      _iframe.setAttribute('style', 'display:none;')
      document.body.appendChild(_iframe)
      _iframe.parentNode.removeChild(_iframe)
      _iframe = null
    },
    videoPre() {
      this.preview = !this.preview
      this._preview = true
    },
    uploadingClick(i) {
      this.$playSound("click")
      if (i === 0) {
        sa.track("learning_click", {
          click_id:
            "pc_learning_activity_competitionArena_competition_upload_canceledByUser"
        })
        // 只有刷新才能打断上传
        window.location.reload(true)
      } else {
        window.location.reload(true)
      }
    },
    localOrPhone(i) {
      this.$playSound("click")
      this.mobile = i === 0 ? false : true
      if (i !== 0) {
        sa.track("learning_click", {
          click_id:
            "pc_learning_activity_competitionArena_competition_upload_QRPhone"
        })
      }
    },
    // 关闭协议
    closeRule(key) {
      if (key) {
        this.rule = false
      }
    },
    createIMG(video) {
      let scale = 0.25
      let canvas = document.createElement("canvas")
      let canvasFill = canvas.getContext('2d')
      canvas.width = video.videoWidth * scale
      canvas.height = video.videoHeight * scale
      canvasFill.drawImage(video, 0, 0, canvas.width, canvas.height)
      return canvas.toDataURL("image/jpeg")
    },
    // 本地上传文件判断以及生成缩略图
    fileChange(obj) {
      let windowURL = window.URL || window.webkitURL
      let file = obj.target.files[0]
      this.isMp4 = file.type.indexOf("mp4") > -1

      // 文件大小限制
      if (file.type.indexOf("mp4") == -1 && file.type.indexOf("wmv") == -1 && file.type.indexOf("quicktime") == -1) {
        this.$refs.file.value = ""
        this.dinoTips = true
        this.dinoTipsText = '电脑上传目前只支持.mov.mp4.wmv 三种格式，请您重新选择~'
        setTimeout(() => {
          this.dinoTips = false
        }, 3000)
        return
      }
      if (file.size > 200000000) {
        this.$refs.file.value = ""
        this.dinoTips = true
        this.dinoTipsText = '该视频过大，请选择其他视频'
        setTimeout(() => {
          this.dinoTips = false
        }, 2000)
        return
      }
      // 缩略图
      setTimeout(() => {
        this.$refs.video.addEventListener('loadeddata', () => {
          this.imgSrc = this.createIMG(this.$refs.video)
        })
        if (this.imgSrc == 'data:,') {
          this.isMp4 = false
          this.cantDecode = true
        }
      }, 200)
      // 视频URL
      this.videoURL = windowURL.createObjectURL(this.$refs.file.files[0])
      this.preview = true
    },
    agree() {
      this.haveAgree = true
      this.rule = false
    }
  }
}
</script>

<style lang="stylus" scoped>
*
  box-sizing: border-box
  -moz-user-select: none
  -webkit-user-select: none
  -ms-user-select: none
  -khtml-user-select: none
  user-select: none
  -webkit-font-smoothing: antialiased
input
  -webkit-touch-callout: text
  -webkit-user-select: text
.certain-button
  position: absolute
  top: 50%
  left: 50%
  margin: 120px 0 0 -100px
  width: 200px
  height: 50px
  background: url('../../img/project_demo/join.png') no-repeat
  background-size: 100% 100%
  display: inline-block
  font-size: 18px
  line-height: 48px
  cursor: pointer
  text-align: center
.text-edit-box
  width: 440px
  height: 160px
  background: rgba(179, 150, 255, 1)
  border-radius: 30px
  position: absolute
  top: 50%
  left: 50%
  margin: 120px 0 0 -220px
  .title-text
    width: 100%
    display: inline-block
    font-size: 20px
    margin-top: 20px
    .title-tips
      width: 62px
      height: 13px
      font-size: 10px
      position: absolute
      color: #A080E8
      background: url('../../img/project_demo/word.png')
      background-size: 100% 100%
      top: 38px
      right: 45px
    .maxlengthTips
      position: absolute
      width: 150px
      height: 20px
      background: rgba(255, 201, 165, 1)
      border-radius: 0px 0px 10px 10px
      color: #FF6600
      font-size: 12px
      left: 180px
      line-height: 20px
    span
      width: 85px
      display: inline-block
      text-align: right
  .student
    width: 100%
    font-size: 20px
    line-height: 50px
    margin-top: 20px
    span
      width: 80px
      display: inline-block
      text-align: right
    .name
      text-align: left
      padding-left: 20px
      display: inline-block
      width: 300px
      height: 50px
      background: rgba(121, 79, 181, 0.3)
      border-radius: 38px
      margin-left: 14px
.warn-tips
  width: 100%
  height: 100%
  position: absolute
  top: 0
  left: 0
  background: rgba(0, 0, 0, 0.8)
  z-index: 8
  font-family: PingFangSC
  color: #fff
  text-align: center
  font-size: 20px
  padding-top: 200px
  img
    width: 240px
.upload-container
  background: #652a8c url('../../img/project_demo/bg.png') no-repeat
  background-size: 100% auto
  color: #fff
  text-align: center
  .back-mask
    width: 120px
    height: 100px
    position: fixed
    z-index: 1000
    cursor: pointer
  .mask-shadow
    width: 100%
    height: 100%
    background: rgba(0, 0, 0, 0.5)
    position: absolute
  .upload-box
    width: 440px
    height: 580px
    position: absolute
    bottom: 50%
    left: 50%
    transform: translate(-50%, 60%)
    -webkit-transform: translate(-50%, 60%)
    @media only screen and (max-device-height: 700px)
      transform: translate(-50%, 0)
      -webkit-transform: translate(-50%, 0)
      bottom: 3vh
    .pd-tips
      right: 34%
      top: 22%
      width: 36px
      height: 36px
      z-index: 10
    .local-phone
      width: 310px
      height: 40px
      background: rgba(121, 79, 181, 1)
      border-radius: 25px
      margin: 0 auto
      position: relative
      cursor: pointer
      padding: 3px
      .cell-bg
        width: 150px
        height: 34px
        position: absolute
        border-radius: 25px
        background: url('../../img/project_demo/pc_phone.png') no-repeat
        background-size: 100% 100%
        transition-duration: 0.8s
        &.mobile
          left: 157px
        &.pc
          left: 3px
      .cell
        display: inline-block
        width: 150px
        height: 34px
        border-radius: 25px
        line-height: 34px
        position: absolute
        z-index: 1
        &.cell-0
          left: 0
        &.cell-1
          right: 0
    .upload-video
      width: 560px
      height: 315px
      background: rgba(179, 150, 255, 0.3)
      border-radius: 20px
      border: 4px dashed rgba(179, 150, 255, 1)
      margin: 51px auto 19px -57px
      color: #B396FF
      font-size: 20px
      position: relative
      cursor: pointer
      &:hover
        opacity: 0.5
      img
        height: 100%
        border-radius: 20px
      span
        display: inline-block
        margin-top: 20px
        font-weight: 400
      .status
        &.play
          width: 60px
          height: 60px
          background: url('../../img/project_demo/play_status.png') no-repeat
          background-size: 100% 100%
          position: absolute
          top: 50%
          left: 50%
          margin: -30px 0 0 -30px
        &.add
          width: 60px
          height: 60px
          background: url('../../img/project_demo/combined.png') no-repeat
          background-size: 100% 100%
          margin: 109px auto 0
    .upload-tips
      font-size: 14px
      color: #B396FF
      width: 520px
      margin-left: -40px
      span.phone
        display: inline-block
        width: 20px
        height: 14px
        background: url('../../img/project_demo/mobile_icon.png') no-repeat
        background-size: 100% 100%
        position: absolute

    .join
      position: relative
      width: 200px
      height: 50px
      background: url('../../img/project_demo/unjoin.png') no-repeat
      background-size: 100% 100%
      margin: 4vh auto
      font-size: 20px
      line-height: 50px
      cursor: pointer
      &.active
        background: url('../../img/project_demo/join.png') no-repeat
        background-size: 100% 100%
      img.icon-loading
        position: absolute
        left: 50%
        top: 50%
        transform: translate(-50%, -50%)

  .mobile
    .qrcode-box
      margin: 40px auto
      width: 320px
      height: 320px
      background: rgba(179, 150, 255, 0.3)
      border-radius: 30px 20px 20px 20px
      border: 4px dashed rgba(179, 150, 255, 1)
      .qrcode
        margin: 66px auto
        width: 180px
        height: 180px
        background: #fff
        padding-top: 20px
      .mobile-tips
        margin-top: 120px
  .agreement
    position: absolute
    top: 50%
    left: 50%
    margin: 194px 0 0 -100px
    i
      display: inline-block
      vertical-align: middle
      width: 20px
      height: 20px
      background: white
      border-radius: 12px
      border: 2px solid rgba(255, 102, 0, 1)
      &.active
        background: rgba(255, 102, 0, 1) url('../../img/project_demo/checkmark.png') no-repeat 0 0 / 16px 16px
        border-color: rgba(0, 0, 0, 0.5)
    span
      display: inline-block
      vertical-align: middle
      width: 228px
      height: 19px
      line-height: 19px
      margin-left: 7px
      font-size: 14px
      font-family: MicrosoftYaHei
      color: rgba(179, 150, 255, 1)
      & > a
        text-decoration: underline
#text
  width: 300px
  padding: 0 20px
  height: 50px
  background: rgba(255, 255, 255, 1)
  border-radius: 38px
  outline: none
  border: 2px solid transparent
  color: #777777
  margin-left: 12px
  &.focus
    border: 2px solid #FF6600
.dino-tips
  width: 330px
  height: 105px
  position: absolute
  background: url('../../img/project_demo/dino_tips.png') no-repeat
  background-size: 100% 100%
  left: 37%
  top: 42%
  color: #777
  line-height: 110px
  padding-left: 50px
  &.long
    line-height: 30px
    padding-top: 24px
#time
  position: absolute
  right: 30px
  top: 30px
  z-index: 13
#type
  position: absolute
  right: 30px
  top: 90px
  z-index: 13
#product
  position: absolute
  right: 30px
  top: 150px
  z-index: 13
.ipadImg
  width: 400px
  height: 300px
  border: 1px solid black
.retry
  width: 100px
  height: 50px
  font-size: 30px
  background: red
.video-container
  width: 672px
  height: 379px
  background: #000
  border-radius: 10px
  position: absolute
  top: 50%
  left: 50%
  margin: -305px 0 0 -335px
  .play-button
    width: 60px
    height: 60px
    background: url('../../img/project_demo/play_status.png') no-repeat
    background-size: 100% 100%
    position: absolute
    top: 50%
    left: 50%
    margin: -30px 0 0 -30px
    z-index: 10
  .frame-mask
    position: absolute
    top: 0
    left: 0
    right: 0
    bottom: 0
    width: 100%
    height: 100%
    background-repeat: no-repeat
    background-size: 100% 100%
    border-radius: 10px
  video
    max-width: 100%
    height: 100%
    border-radius: 10px
.play-status
  width: 60px
  height: 60px
  background: url('../../img/project_demo/play_status.png') no-repeat
  background-size: 100% 100%
  position: absolute
  top: 30%
  left: 49%
.op
  position: absolute
  top: 50%
  left: 50%
  margin: 162px 0 0 -298px
  .user-mask-selection
    margin-bottom: 36px
    .item
      display: inline-block
      vertical-align: middle
      margin-right: 52px
      cursor: pointer
      &.no-filter
        width: 70px
        height: 70px
        background-image url('../../img/project_demo/no_mask.png')
        background-repeat: no-repeat
        background-size: 70px
        position: relative
        background-position: 0 -70px
        &.selected
          background-position: 0 0
        span
          position: absolute
          bottom: -30px
          left: 12px
          color: #fff
          font-weight: 100
          font-size: 14px
      &.scene
        border: 4px solid white
        width: 117px
        height: 65px
        border-radius: 14px
        position: relative
        img
          width: 100%
          height: 100%
          border-radius: 10px
        &.selected
          &:before
            content: ''
            width: 26px
            height: 26px
            background-image: url('../../img/project_demo/selected.png')
            background-repeat: no-repeat
            background-size: 100% 100%
            position: absolute
            bottom: -14px
            right: -14px
  .button
    display: inline-block
    width: 140px
    height: 40px
    font-size: 18px
    line-height: 38px
    cursor: pointer
    &:first-of-type
      background: url('../../img/project_demo/upload_status_2.png') no-repeat
      background-size: 100% 100%
      margin-right: 40px
    &:last-child
      background: url('../../img/project_demo/upload_status_1.png') no-repeat
      background-size: 100% 100%
      margin-right: 0
.video-img
  position: absolute
  top: 0
  left: 0
  width: 100%
  height: 100%
  border-radius: 10px
@media screen and (max-width: 1100px)
  .video-container
    width: 480px
    height: 270px
    margin: -260px 0 0 -240px
  .text-edit-box
    margin: 55px 0 0 -220px
@media screen and (max-height: 850px)
  .video-container
    width: 480px
    height: 270px
    margin: -260px 0 0 -240px
  .text-edit-box
    margin: 55px 0 0 -220px
</style>
