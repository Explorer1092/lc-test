<template lang="jade">
  transition(name="extension",enter-active-class="animated fadeInRight",leave-active-class="animated fadeOutRight")
    .upload-container(v-if="work",style="min-height: 700px;")
      .back-plants
        .plant-1
        .plant-2
        .plant-3
        .plant-4
        .plant-5
        .plant-6
      video-box(v-if="!ipad",:videoSrc="work.demoVideo",:autoPlay="false",:playEndAction="playEndAction",:source="source",:materialId="currentMaterialId",@fullScreen="fullScreen",:pd="'border-radius: 25px 25px 0 0;margin: 0 auto;'")
      pd-back(:title_cn="work.name + ' 教学视频'")
      .ipad-video-box(v-if="ipad",style="overflow: hidden;")
        img(v-if="!ipadVideo",:src="work.coverImage2Activity")
        .play-status(v-if="!ipadVideo",@click="playVideo")
        video(v-show="ipad&&ipadVideo",:src="work.demoVideo",controls="controls",ref="video2")
      .dino-tips(v-show="dinoTips")
        span {{errorMsg}}
</template>
<script>
  import axios from 'axios'
  import pdBack from './components/pd_back.vue'
  import videoBox from './common/vk_video.vue'
  import Toolkit from './js/toolkit.js'
  import cookies from 'cookies-js'
  export default {
    mixins: [],
    data(){
      return {
        title: '',
        work: null,
        full: false,
        backUrl: '',
        liked: false,
        studentId: cookies.get('studentId'),
        count: 0,
        partitionId: '',
        currentMaterialId: "2",
        source: '23',
        dinoTips: false,
        errorMsg: '',
        ipad: false,
        ipadFullVideo: false,
        winnerType: 'default',
        ipadVideo: false,
        host: 'https://a15-mobile.vipkid.com.cn',
        voteStatus: 0, // 投票状态(0:未开始；1:进行中；2:已结束)，默认是 0
        isRedirect: false
      }
    },
    props: {
    },
    components: {
      pdBack,
      videoBox
    },
    mounted() {
      this.ipad = this.IS_IN_IPAD_APP
      this.initVideo()
    },
    updated(){
      if (this.IS_IN_IPAD_APP) {
        this.fullll()
      }
    },
    methods: {
      // 初始化
      initVideo(){
        this.getUstActivityDetailData((result) => {
          if (result) {
            this.loading = false
          }
          if (result.data.code !== -1) {
            this.work = result.data.data
          }
        })
      },
      // 获取教学视频
      getUstActivityDetailData(callback){
        axios.get(`/rest/activity/api/activity/user/activity/getUstActivity`,{
          params: {
            activityId: this.$route.params.pdId,
            unlockStatus: this.$route.query.unlockStatus
          }
        })
          .then((res) => {
            callback(res)
          })
          .catch((res) => {
            // this.netError = true
            // this.loading = false
          })
      },
      playVideo(){
        this.ipadVideo = true
        this.$refs.video2.play()
      },
      fullll(){
        let that = this
        this.$refs.video2.addEventListener("webkitfullscreenchange", function(e) {
          if (!document.webkitIsFullScreen) {
            that.ipadFullVideo = false
          }else{
            that.ipadFullVideo = true
          }
        })
      },
      playEndAction(){
      },
      fullScreen(state){
        this.full = !state
      }
    }
  }
</script>

<style lang="stylus" scoped>
  *
    box-sizing: border-box
    -moz-user-select: none
    -webkit-user-select: none
    -ms-user-select: none
    -khtml-user-select: none
    user-select: none
    -webkit-font-smoothing: antialiased
  .warning
    display: inline-block
    width: 16px
    height: 16px
    border: 1px solid #fff
  .upload-container
    background:linear-gradient(180deg,rgba(53,0,133,1) 0%,rgba(86,52,162,1) 100%)
    background-size: 100% auto
    color: #fff
    text-align: center
    padding: 120px 240px 170px 240px
    @media  only screen and (min-device-width : 768px) and (max-device-width : 1024px) and (orientation : landscape)
        padding: 130px 120px 160px 120px
    .back-plants
      position: fixed
      top: 0
      left: 0
      width: 100%
      height: 100%
      .plant-1
        position: absolute
        top: 540px
        left: 588px
        width: 50px
        height: 49px
        background: url("../../img/project_demo/unit_show_time/An asteroid@2x.png") no-repeat
        background-size: 49px
      .plant-2
        position: absolute
        top: 77px
        left: 127px
        width: 92px
        height: 90px
        background: url("../../img/project_demo/unit_show_time/An asteroid@2x.png") no-repeat
        background-size: 92px
      .plant-3
        position: absolute
        top: 510px
        right: 40px
        width: 80px
        height: 79px
        background: url("../../img/project_demo/unit_show_time/Planets in@2x.png") no-repeat
        background-size: 80px
      .plant-4
        position: absolute
        top: 102px
        left: 812px
        width: 300px
        height: 250px
        background: url("../../img/project_demo/unit_show_time/planets@2x.png") no-repeat
        background-size: 300px
      .plant-5
        position: absolute
        top: 456px
        right: 860px
        width: 300px
        height: 250px
        background: url("../../img/project_demo/unit_show_time/planets@2x.png") no-repeat
        background-size: 300px
      .plant-6
        position: absolute
        top: 0
        left: 50%
        margin-left: -300px
        width: 600px
        height: 169px
        background: url("../../img/project_demo/unit_show_time/Semicircle background@2x.png") no-repeat
        background-size: 600px
        -webkit-filter: blur(7px)
        -moz-filter: blur(7px)
        -o-filter: blur(7px)
        -ms-filter: blur(7px)
        filter: blur(7px)
    .tips
      width: 30px
      min-height: 200px
      background:rgba(255,102,0,0.8)
      border-radius: 0 16px 16px 0
      position: absolute
      right: -30px
      top: -440px
      padding-top: 20px
      padding-bottom: 20px
      @media  only screen and (min-device-width : 768px) and (max-device-width : 1024px) and (orientation : landscape)
        top: -55vh
      &.error
        background:rgba(255,0,0,0.8)
    .revoke
      width: 58px
      height: 58px
      background: url("../../img/project_demo/workwall2.png") no-repeat
      background-position: 0 0
      background-size: 155px
      position: fixed
      right: 100px
      top: 20px
      cursor: pointer
      z-index: 11
      &:after
        content:" "
        display: inline-block
        width: 58px
        height: 58px
        border-radius: 28px
        display: none
      &:hover
        &:after
          background: rgba(255,255,255,0.3)
          display: inline-block
      &:active
        &:after
          background: rgba(0,0,0,0.3)
          display: inline-block
    .share
      width: 58px
      height: 58px
      background: url("../../img/project_demo/workwall2.png") no-repeat
      background-position: -58px 0
      background-size: 155px
      position: fixed
      right: 20px
      top: 20px
      cursor: pointer
      z-index: 11
      &.unshare
        background: url("../../img/project_demo/workwall2.png") no-repeat
        background-position: 0 -116px
        background-size: 155px
      &:after
        content:" "
        display: inline-block
        width: 58px
        height: 58px
        border-radius: 28px
        display: none
      &:hover
        &:after
          background: rgba(255,255,255,0.3)
          display: inline-block
      &:active
        &:after
          background: rgba(0,0,0,0.3)
          display: inline-block
    .video-box
      width: 100%
      height: 100%
      text-align: left
      border-radius: 25px 25px 0 0
      background: #8561ED
      padding: 5px
      .video-content
        .video-mask
          display: none
    .ipad-video-box
      background: #4d308b
      width: 100%
      height: 100%
      border-radius: 25px 25px 0 0
      text-align: center
      position: relative
      margin: 0 auto
      border: 4px solid #8466e9
      video
        height: 100%
        max-width: 100%
      img
        height: 100%
      .play-status
        display: inline-block
        width: 60px
        height: 60px
        background: url("../../img/project_demo/play_status.png") no-repeat
        background-size: 100% 100%
        position: absolute
        top: 50%
        left: 50%
        cursor: pointer
        transform: translate(-50%,-50%)
        -webkit-transform: translate(-50%, -50%)
    .dino-tips
      position: absolute
      font-size: 14px
      width: 370px
      height: 110px
      left: 50%
      top: 50%
      transform: translate(-50%,-50%)
      -webkit-transform: translate(-50%, -50%)
      background: url("../../img/project_demo/dino_tips.png")
      background-size: 100% 100%
      color: #000
      span
        display: inline-block
        margin-left: 100px
        width: 260px
        margin-top: 50px
        font-size: 20px
    .video-desc
        width: 100%
        height: 60px
        margin: 0 auto
        background: #8561ed
        border-radius: 0 0 20px 20px
        position: relative
        margin-top: -1px
        text-align: left
        .ele
          display: inline-block
          position: absolute
        .avatar
          width: 40px
          height: 40px
          border-radius: 20px
          left: 20px
          top: 8px
          img
            width: 100%
            height: 100%
            border-radius: 20px
        .name
          left: 76px
          top: 8px
          font-size: 18px
          span
            display: inline-block
            width: 24px
            height: 14px
            background: url("../../img/project_demo/rank.png") no-repeat
            background-size: 70px
            background-position: -44px -44px
        .time
          left: 76px
          top: 30px
          font-size: 14px
        .model,.rank
          position: relative
          min-width: 90px
          height: 50px
          background: rgba(0,0,0,0.1)
          border-radius: 10px
          text-align: left
          line-height: 48px
          padding-left: 10px
          font-size: 14px
          cursor: pointer
          .icon
            width: 30px
            height: 38px
            display: inline-block
            position: absolute
            right: 5px
            top: 5px
        .rank
          margin-left: 15px
          .icon
            &.rank-0
              background: url("../../img/project_demo/detail.png") no-repeat
              background-size: 82px
              background-position: -30px 1px
            &.rank-1
              background: url("../../img/project_demo/detail.png") no-repeat
              background-size: 82px
              background-position: 0 -37px
            &.rank-2
              background: url("../../img/project_demo/detail.png") no-repeat
              background-size: 82px
          .pm
            font-size: 20px
            position: absolute
            right: 5px
            top: 2px
          .bubble
            width: 240px
            height: 124px
            position: absolute
            top: -122px
            left: -70px
            background: url("../../img/project_demo/bubble.png") no-repeat
            background-size: 100% 100%
            text-align: center
            h1,h2
              width: 100%
              color: #371575
              height: 20px
              margin-top: 15px
            h1
              font-weight: 700
              font-size: 20px
            h2
              font-size: 18px
        .model
          margin-left: 220px
          padding-right: 40px
          .icon
            background: url("../../img/project_demo/default.png") no-repeat
            background-size: 100% 100%
            &.icon-excellent
              background: url("../../img/project_demo/rank.png") no-repeat
              background-size: 60px
            &.icon-popular
              background: url("../../img/project_demo/rank.png") no-repeat
              background-size: 60px
        .vote
          text-decoration: underline
          right: 30px
          top: 18px
          cursor: pointer
          .bubble
            width: 240px
            height: 124px
            position: absolute
            top: -130px
            left: -80px
            background: url("../../img/project_demo/bubble.png") no-repeat
            background-size: 100% 100%
            text-align: left
            h1
              width: 100%
              color: #371575
              font-size: 18px
              padding-left: 10px
              margin: 10px 0
              @media  only screen and (min-device-width : 768px) and (max-device-width : 1024px) and (orientation : landscape)
                margin: 6px 0
              &:nth-of-type(1)
                span
                  color: red
              &:nth-of-type(2)
                span
                  color: blue
              &:nth-of-type(3)
                span
                  color: green
          .arrow
            width: 16px
            height: 16px
            display: inline-block
            background: url("../../img/project_demo/detail.png") no-repeat
            background-size: 210px
            background-position: -193px -103px
            margin-right: 3px
        .ing
          width: 100px
          height: 30px
          position: absolute
          text-align: left
          top: 16px
          .vote-heart
            display: inline-block
            width: 36px
            height: 30px
            background: url("../../img/project_demo/detail.png") no-repeat
            background-size: 145px
            background-position: -106px 0
            position: absolute
            z-index: 3
            &.liked
              background: url("../../img/project_demo/detail.png") no-repeat
              background-size: 145px
              background-position: -106px -30px
          .vote-num
            display: inline-block
            color: #fff
            position: absolute
            top: 2px
            left: 16px
            text-align: center
            width: 66px
            height: 28px
            background: url("../../img/project_demo/rectangle@3x.png")
            background-size: 100% 100%
            line-height: 28px
            padding-left: 12px
</style>

